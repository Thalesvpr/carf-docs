# KEYCLOAK

Provedor centralizado de autenticação OAuth2/OIDC para as seis aplicações CARF usando realm único "carf" com multi-tenancy dinâmico via atributos de usuário que viram claims JWT integrados com PostgreSQL RLS isolando dados por tenant automaticamente. Implementa SSO unificado entre GEOWEB REURBCAD GEOAPI GEOGIS WEBDOCS e ADMIN com seis clients pré-configurados (SPA PKCE para web, Mobile PKCE para app, Bearer-only para backend, Client credentials para plugins, Público para docs). Realm possui cinco roles RBAC (super-admin admin manager analyst field-collector) hierárquicos com protocol mappers customizados gerando tokens com tenant_id e allowed_tenants permitindo troca dinâmica de contexto via dropdown frontend e refresh token. Backend middleware extrai claims JWT e configura sessão PostgreSQL com SET app.tenant_id aplicando Row Level Security policies que filtram queries por tenant sem código adicional nas aplicações. Ver documentação técnica em arquivos numerados 01-architecture até 12-integration-testing cobrindo flows OAuth2 configuração realm docker-compose multi-tenancy RBAC token management deployment production security troubleshooting admin-console e testes E2E, além de guias práticos de integração por projeto em examples/ e runbooks operacionais em runbooks/ para criar usuários tenants rotacionar secrets backup-restore e monitoramento. Customizações específicas CARF incluem temas visuais login/account/email em português brasileiro com validação CPF/CNPJ via tscore library, Docker image personalizada com temas embedados, e scripts automação completa via Makefile permitindo quick-start ambiente desenvolvimento com make dev.

---

**Última atualização:** 2026-01-10
