# Configuração do Realm Keycloak

Realm "carf" configurado com seis clients distintos sendo geoweb reurbcad webdocs e admin como public clients habilitados para standard flow com PKCE obrigatório usando code challenge method S256 garantindo segurança mesmo em ambientes sem client secret, geoapi como bearer-only client que apenas valida tokens sem gerar novos apropriado para backend APIs REST, e geogis como confidential client com service accounts enabled para client credentials flow permitindo autenticação server-to-server usando client secret protegido. Sistema de roles hierárquicos implementa quatro níveis sendo field-collector role base com permissões de coleta criar unidades fotos documentos sem capacidade de aprovação ou deleção, analyst role composite incluindo automaticamente field-collector plus editar aprovar rejeitar unidades e gerar relatórios, admin role composite incluindo analyst plus gerenciar usuários do tenant configurar preferências visualizar audit logs, e super-admin role composite incluindo admin plus criar novos tenants transferir usuários entre tenants e acessar qualquer tenant via switcher especial sem validação de allowed_tenants. Attributes customizados de usuário incluem tenants array armazenando lista de tenant IDs aos quais usuário tem acesso e current_tenant string indicando tenant atualmente selecionado no frontend, mapeados para JWT claims via protocol mappers sendo tenant_id claim extraído de current_tenant attribute tipo String incluído em id_token access_token e userinfo endpoint, e allowed_tenants claim extraído de tenants attribute tipo JSON multivalued incluído em todos tokens permitindo frontend validar troca de contexto antes de chamar backend. Configurações de sessão definem SSO session idle timeout de trinta minutos correspondendo a mil e oitocentos segundos e max session duration de dez horas correspondendo a trinta e seis mil segundos, refresh tokens configurados com max reuse zero garantindo uso único one-time-use prevenindo replay attacks, access tokens com lifetime de cinco minutos correspondendo a trezentos segundos forçando refresh frequente reduzindo janela de exposição em caso de vazamento. Password policy enforça comprimento mínimo de oito caracteres incluindo pelo menos um dígito um caractere lowercase um uppercase um caractere especial e proibindo uso do username como senha seguindo OWASP guidelines, brute force protection configurado com máximo de cinco tentativas permitidas seguidas de bloqueio de quinze minutos prevenindo ataques de força bruta. Redirect URIs configurados para cada client incluindo geoweb com localhost porta cinco mil cento e setenta e três para desenvolvimento e domínio geoweb.carf.example.com para produção com wildcard permitindo qualquer path, reurbcad com custom scheme carf://callback para mobile OAuth redirect e exp://localhost para Expo development server, geogis com localhost e 127.0.0.1 qualquer porta suportando ambiente de desenvolvimento QGIS plugin dinâmico, webdocs com localhost desenvolvimento e GitHub Pages URL thalesvpr.github.io/carf-webdocs para publicação estática, admin com localhost porta três mil desenvolvimento e admin.carf.example.com produção. Web origins configurados como plus symbol indicando auto-fill baseado em redirect URIs permitindo requisições CORS apenas de origens registradas prevenindo XSS cross-site scripting attacks. Client roles específicos definidos para admin client incluindo manage-users permitindo CRUD de usuários via Admin API, manage-tenants permitindo CRUD de tenants, e view-audit-logs permitindo acesso read-only a logs de auditoria do sistema.

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Pronto
