# Role Permissions Matrix (Matriz de Permiss√µes por Papel)

Sistema implementa controle de acesso baseado em pap√©is (RBAC - Role-Based Access Control) estabelecendo 5 n√≠veis hier√°rquicos de autoriza√ß√£o onde cada role possui conjunto espec√≠fico de permiss√µes at√¥micas permitindo execu√ß√£o de a√ß√µes no sistema sendo SUPER_ADMIN papel com acesso irrestrito a todas funcionalidades incluindo configura√ß√µes cr√≠ticas de tenant e manipula√ß√£o de dados de auditoria, ADMIN papel de administrador de tenant com acesso amplo exceto configura√ß√µes de sistema cr√≠ticas podendo gerenciar usu√°rios times comunidades e configura√ß√µes operacionais, MANAGER papel de gestor de projetos de regulariza√ß√£o com permiss√µes de aprova√ß√£o de unidades processos de legitima√ß√£o e gera√ß√£o de certid√µes mas sem acesso a configura√ß√µes administrativas, ANALYST papel de analista t√©cnico ou jur√≠dico com permiss√µes de revis√£o valida√ß√£o e recomenda√ß√£o de aprova√ß√£o mas sem poder aprovar definitivamente requerendo dupla verifica√ß√£o por manager, e FIELD_AGENT papel de t√©cnico de campo respons√°vel por coleta de dados cadastramento de unidades e titulares com permiss√µes limitadas a cria√ß√£o e edi√ß√£o de rascunhos sem poder aprovar ou rejeitar. Permiss√µes s√£o organizadas em dom√≠nios funcionais incluindo autentica√ß√£o e sess√µes controlando login logout e gerenciamento de tokens, gest√£o de usu√°rios e times permitindo criar convidar editar desativar usu√°rios e atribuir membros a equipes, gest√£o de comunidades abrangendo cria√ß√£o edi√ß√£o aprova√ß√£o e exclus√£o de comunidades al√©m de atribui√ß√£o de autoriza√ß√µes de acesso por time ou usu√°rio individual, gest√£o de unidades habitacionais cobrindo ciclo completo desde cadastro em rascunho at√© aprova√ß√£o final ou rejei√ß√£o com estados intermedi√°rios de an√°lise e corre√ß√£o, gest√£o de titulares incluindo cadastro valida√ß√£o de CPF/CNPJ vincula√ß√£o a unidades e defini√ß√£o de percentuais de propriedade, processos de legitima√ß√£o fundi√°ria controlando cria√ß√£o an√°lise t√©cnica e jur√≠dica publica√ß√£o de editais gest√£o de contesta√ß√µes e emiss√£o de certid√µes oficiais, documentos e anexos permitindo upload visualiza√ß√£o download e exclus√£o de fotografias plantas t√©cnicas documentos pessoais e certid√µes, relat√≥rios e dashboards autorizando gera√ß√£o visualiza√ß√£o e exporta√ß√£o de relat√≥rios gerenciais mapas de calor estat√≠sticas de progresso e indicadores de desempenho, configura√ß√µes e par√¢metros do sistema incluindo ajustes de tenant customiza√ß√£o de formul√°rios defini√ß√£o de valores padr√£o e ativa√ß√£o de features experimentais, auditoria e logs concedendo acesso a registros de a√ß√µes de usu√°rios eventos de sistema altera√ß√µes em dados sens√≠veis e troubleshooting de problemas, sincroniza√ß√£o offline controlando quais usu√°rios podem baixar dados localmente para trabalho em campo e realizar sincroniza√ß√£o bidirecional com resolu√ß√£o de conflitos, e opera√ß√µes de GIS e mapas permitindo desenho de geometrias importa√ß√£o de shapefiles an√°lise espacial de sobreposi√ß√µes e c√°lculos de √°rea e per√≠metro. Matriz de permiss√µes estabelece que SUPER_ADMIN possui todas 147 permiss√µes at√¥micas do sistema sem restri√ß√µes permitindo inclusive opera√ß√µes perigosas como exclus√£o f√≠sica de dados resetar senhas de qualquer usu√°rio e modificar logs de auditoria devendo ser atribu√≠do apenas a equipe t√©cnica de infraestrutura e desenvolvimento, ADMIN possui 118 permiss√µes excluindo apenas opera√ß√µes cr√≠ticas de sistema como modificar configura√ß√µes de multi-tenancy editar logs de auditoria excluir dados permanentemente e acessar credenciais de integra√ß√£o sendo papel adequado para gestores de TI do √≥rg√£o p√∫blico respons√°vel, MANAGER possui 67 permiss√µes focadas em opera√ß√µes de neg√≥cio incluindo aprovar unidades habitacionais gerenciar processos de legitima√ß√£o emitir certid√µes gerar relat√≥rios gerenciais e configurar par√¢metros operacionais mas sem acesso a gest√£o de usu√°rios ou configura√ß√µes de sistema sendo papel adequado para coordenadores de projetos de regulariza√ß√£o, ANALYST possui 42 permiss√µes limitadas a an√°lise e recomenda√ß√£o incluindo revisar unidades cadastradas validar documenta√ß√£o anexada adicionar anota√ß√µes e coment√°rios solicitar corre√ß√µes e elaborar pareceres t√©cnicos ou jur√≠dicos mas sem poder aprovar definitivamente unidades ou processos exigindo aprova√ß√£o posterior por manager implementando segrega√ß√£o de responsabilidades, e FIELD_AGENT possui 23 permiss√µes m√≠nimas necess√°rias para trabalho de campo incluindo cadastrar unidades em rascunho cadastrar titulares capturar fotografias desenhar geometrias no mapa sincronizar dados offline e visualizar pr√≥prias unidades criadas mas sem acesso a dados de outras equipes ou unidades j√° aprovadas garantindo isolamento de dados entre times. Permiss√µes espec√≠ficas por m√≥dulo estabelecem que autentica√ß√£o permite a todos roles realizar login e logout mas apenas ADMIN e SUPER_ADMIN podem for√ßar logout de outros usu√°rios ou revogar tokens de sess√£o, gest√£o de usu√°rios restringe cria√ß√£o e edi√ß√£o a ADMIN e SUPER_ADMIN sendo MANAGER capaz apenas de visualizar usu√°rios de seu tenant e convidar novos usu√°rios mas n√£o editar roles ou desativar contas, gest√£o de times permite MANAGER criar times e adicionar membros mas apenas ADMIN pode excluir times ou transferir propriedade de comunidades entre times, gest√£o de comunidades autoriza MANAGER a criar e editar comunidades mas ADMIN deve aprovar comunidades antes de ficarem vis√≠veis para atribui√ß√£o a times sendo SUPER_ADMIN capaz de excluir comunidades com todas unidades associadas mediante confirma√ß√£o expl√≠cita, gest√£o de unidades permite FIELD_AGENT criar e editar em estado DRAFT sendo ANALYST respons√°vel por transi√ß√£o para PENDING_ANALYSIS e IN_REVIEW enquanto apenas MANAGER pode aprovar rejeitar ou solicitar corre√ß√µes implementando workflow de dupla verifica√ß√£o, gest√£o de titulares permite FIELD_AGENT e ANALYST cadastrar e editar mas valida√ß√µes de CPF duplicado e verifica√ß√£o de certid√µes negativas de propriedade s√£o executadas automaticamente pelo sistema sem interven√ß√£o manual, processos de legitima√ß√£o requerem MANAGER para protocolar solicita√ß√£o e emitir certid√£o enquanto ANALYST elabora pareceres t√©cnicos e jur√≠dicos sendo publica√ß√£o de edital e registro de contesta√ß√µes tarefas administrativas executadas por ADMIN, documentos permitem upload por todos roles mas exclus√£o de documentos anexados a unidades aprovadas ou processos protocolados requer justificativa e aprova√ß√£o de ADMIN sendo registrada em auditoria, relat√≥rios gerenciais s√£o acess√≠veis por MANAGER e superiores enquanto relat√≥rios de auditoria e compliance s√£o restritos a ADMIN e SUPER_ADMIN protegendo dados sens√≠veis de rastreabilidade, configura√ß√µes de tenant como logo marca cores do tema e textos customizados s√£o edit√°veis por ADMIN enquanto configura√ß√µes de integra√ß√£o com Keycloak servidores WMS e credenciais de APIs externas requerem SUPER_ADMIN, auditoria de logs permite MANAGER visualizar logs de a√ß√µes em unidades e processos de suas comunidades mas apenas ADMIN visualiza logs completos de todas a√ß√µes de todos usu√°rios do tenant sendo SUPER_ADMIN capaz de exportar logs para an√°lise forense, sincroniza√ß√£o offline √© autorizada para FIELD_AGENT e ANALYST permitindo download de dados de comunidades atribu√≠das a seus times mas quantidade de comunidades sincroniz√°veis simultaneamente √© limitada por role sendo FIELD_AGENT restrito a 3 comunidades ANALYST a 10 comunidades e MANAGER sem limite, e opera√ß√µes GIS como importa√ß√£o de shapefiles an√°lise de sobreposi√ß√£o em lote e rec√°lculo de √°reas de m√∫ltiplas unidades s√£o restritas a ANALYST e superiores prevenindo sobrecarga de sistema por opera√ß√µes massivas n√£o autorizadas. Permiss√µes compostas e condicionais estabelecem que alguns recursos exigem combina√ß√£o de m√∫ltiplas permiss√µes at√¥micas como emitir certid√£o de legitima√ß√£o requerendo units.approve legitimation.approve e documents.generate simultaneamente garantindo que apenas usu√°rios com perfil completo de gestor possam executar opera√ß√£o cr√≠tica, visualiza√ß√£o de dados sens√≠veis como CPF completo de titulares hist√≥rico de altera√ß√µes em unidades e logs de sincroniza√ß√£o offline requer permiss√£o expl√≠cita de data.view_sensitive adicional ao acesso ao m√≥dulo correspondente implementando camada extra de prote√ß√£o para dados pessoais conforme LGPD, opera√ß√µes de exclus√£o s√£o divididas em soft delete permitido por creator da entidade dentro de 24 horas e hard delete permitido apenas por ADMIN mediante justificativa sendo hard delete de unidades aprovadas ou processos com certid√£o emitida bloqueado permanentemente mesmo para SUPER_ADMIN preservando integridade de dados hist√≥ricos, e opera√ß√µes em lote como aprovar 50 unidades simultaneamente importar 200 titulares via CSV ou exportar shapefile de comunidade inteira requerem permiss√£o bulk_operations adicional evitando que usu√°rios sem treinamento adequado executem a√ß√µes massivas que podem corromper dados ou sobrecarregar sistema. Atribui√ß√£o de roles segue pol√≠tica de menor privil√©gio onde novos usu√°rios criados recebem inicialmente role FIELD_AGENT devendo ser promovidos explicitamente por ADMIN ap√≥s treinamento e valida√ß√£o de compet√™ncia, promo√ß√£o de FIELD_AGENT para ANALYST requer aprova√ß√£o de MANAGER e conclus√£o de curso de capacita√ß√£o em an√°lise t√©cnica ou jur√≠dica de regulariza√ß√£o fundi√°ria, promo√ß√£o de ANALYST para MANAGER requer aprova√ß√£o de ADMIN e hist√≥rico m√≠nimo de 6 meses no sistema com taxa de aprova√ß√£o de unidades superior a 95% e taxa de rejei√ß√£o por erros inferior a 5%, atribui√ß√£o de role ADMIN √© restrita a funcion√°rios efetivos do √≥rg√£o p√∫blico respons√°vel pelo tenant com v√≠nculo empregat√≠cio comprovado e aprova√ß√£o de gestor hier√°rquico superior, e atribui√ß√£o de role SUPER_ADMIN √© exclusiva de equipe t√©cnica do fornecedor do sistema para suporte infraestrutura e troubleshooting sendo revogada automaticamente ap√≥s encerramento de contrato de manuten√ß√£o. Auditoria de uso de permiss√µes cr√≠ticas registra em log imut√°vel todas execu√ß√µes de a√ß√µes sens√≠veis incluindo timestamp identifica√ß√£o do usu√°rio IP de origem role no momento da a√ß√£o par√¢metros da opera√ß√£o e resultado de sucesso ou falha, opera√ß√µes de aprova√ß√£o ou rejei√ß√£o de unidades processos e certid√µes registram adicionalmente justificativa textual obrigat√≥ria fornecida pelo usu√°rio e refer√™ncias a documentos ou pareceres que embasaram decis√£o permitindo rastreabilidade completa e presta√ß√£o de contas, tentativas de acesso negado por falta de permiss√£o s√£o registradas em log separado de security events com alertas autom√°ticos para ADMIN quando mesmo usu√°rio tenta acessar recursos n√£o autorizados mais de 5 vezes em 1 hora indicando poss√≠vel tentativa de escala√ß√£o de privil√©gios ou acesso indevido, e modifica√ß√µes em roles de usu√°rios s√£o registradas com before e after values identificando quem concedeu ou revogou permiss√£o quando e qual justificativa administrativa foi fornecida garantindo accountability em toda cadeia de autoriza√ß√£o.

**5 Roles hier√°rquicos:**

1. **SUPER_ADMIN** - Acesso irrestrito (147 permiss√µes)
2. **ADMIN** - Administrador tenant (118 permiss√µes)
3. **MANAGER** - Gestor projetos (67 permiss√µes)
4. **ANALYST** - Analista t√©cnico/jur√≠dico (42 permiss√µes)
5. **FIELD_AGENT** - T√©cnico campo (23 permiss√µes)

**Permiss√µes por dom√≠nio:**

| Dom√≠nio | SUPER_ADMIN | ADMIN | MANAGER | ANALYST | FIELD_AGENT |
|---------|-------------|-------|---------|---------|-------------|
| Autentica√ß√£o | ‚úÖ Todas | ‚úÖ For√ßa logout | ‚úÖ Login/logout | ‚úÖ Login/logout | ‚úÖ Login/logout |
| Usu√°rios | ‚úÖ Todas | ‚úÖ CRUD completo | üî∏ Visualizar + convidar | üî∏ Visualizar | ‚ùå Sem acesso |
| Times | ‚úÖ Todas | ‚úÖ CRUD completo | üî∏ Criar + editar | üî∏ Visualizar | üî∏ Visualizar pr√≥prio |
| Comunidades | ‚úÖ Todas | ‚úÖ Aprovar + excluir | üî∏ Criar + editar | üî∏ Visualizar atribu√≠das | üî∏ Visualizar atribu√≠das |
| Unidades | ‚úÖ Todas | ‚úÖ Todas | ‚úÖ Aprovar/rejeitar | üî∏ Revisar + recomendar | üî∏ CRUD rascunhos |
| Titulares | ‚úÖ Todas | ‚úÖ Todas | ‚úÖ CRUD completo | üî∏ CRUD + validar | üî∏ CRUD b√°sico |
| Legitima√ß√£o | ‚úÖ Todas | ‚úÖ Publicar edital | ‚úÖ Protocolar + emitir certid√£o | üî∏ Pareceres t√©cnicos | ‚ùå Sem acesso |
| Documentos | ‚úÖ Todas | ‚úÖ Excluir com justificativa | üî∏ Upload + visualizar | üî∏ Upload + visualizar | üî∏ Upload + visualizar |
| Relat√≥rios | ‚úÖ Todos | ‚úÖ Gerenciais + auditoria | üî∏ Gerenciais | üî∏ Operacionais | ‚ùå Sem acesso |
| Configura√ß√µes | ‚úÖ Sistema + tenant | üî∏ Tenant operacional | üî∏ Par√¢metros operacionais | ‚ùå Sem acesso | ‚ùå Sem acesso |
| Auditoria | ‚úÖ Todas + exportar | ‚úÖ Visualizar + exportar | üî∏ Logs de comunidades | üî∏ Logs pr√≥prios | ‚ùå Sem acesso |
| Sincroniza√ß√£o | ‚úÖ Todas | ‚úÖ For√ßar sync | ‚úÖ Ilimitado | üî∏ 10 comunidades | üî∏ 3 comunidades |
| GIS | ‚úÖ Todas | ‚úÖ Opera√ß√µes lote | üî∏ Opera√ß√µes lote | üî∏ Importar + analisar | üî∏ Desenhar b√°sico |

**Permiss√µes compostas cr√≠ticas:**

- **Emitir certid√£o**: units.approve + legitimation.approve + documents.generate (MANAGER+)
- **Dados sens√≠veis**: M√≥dulo + data.view_sensitive (ADMIN+)
- **Hard delete**: Entidade + admin.delete_permanent + justificativa (ADMIN+)
- **Opera√ß√µes lote**: M√≥dulo + bulk_operations + >50 registros (ANALYST+)

**Pol√≠tica de menor privil√©gio:**

- Novo usu√°rio: FIELD_AGENT (padr√£o)
- FIELD_AGENT ‚Üí ANALYST: Aprova√ß√£o MANAGER + curso capacita√ß√£o
- ANALYST ‚Üí MANAGER: Aprova√ß√£o ADMIN + 6 meses + taxa aprova√ß√£o >95%
- Atribuir ADMIN: Funcion√°rio efetivo + aprova√ß√£o gestor superior
- Atribuir SUPER_ADMIN: Equipe t√©cnica fornecedor (revogado ao fim contrato)

**Auditoria de permiss√µes:**

- A√ß√µes sens√≠veis: Log imut√°vel (timestamp, user, IP, role, par√¢metros, resultado)
- Aprova√ß√µes/rejei√ß√µes: Justificativa textual obrigat√≥ria + refer√™ncias documentos
- Acesso negado: Security events, alerta ap√≥s 5 tentativas/hora
- Modifica√ß√£o roles: Before/after values, quem concedeu, quando, justificativa

**Relacionamento com Domain Model:**

- Implementa: `DOMAIN-MODEL/VALUE-OBJECTS/04-user-role.md` (5 roles enum)
- Valida: `DOMAIN-MODEL/ENTITIES/08-account.md` (role field)
- Eventos: `DOMAIN-MODEL/EVENTS/21-role-changed-event.md` (auditoria mudan√ßas)
- Permiss√µes: Verificadas em cada endpoint antes de executar a√ß√£o

**Implementa√ß√µes por projeto:**

- Backend .NET: `PROJECTS/GEOAPI/LAYERS/APPLICATION/AUTHORIZATION/PermissionMatrix.cs`
- Backend .NET: `PROJECTS/GEOAPI/LAYERS/APPLICATION/AUTHORIZATION/RolePermissions.cs`
- Frontend React: `PROJECTS/GEOWEB/AUTH/permissions-config.ts`
- Frontend React: `PROJECTS/GEOWEB/AUTH/usePermissions.hook.ts`

---

**√öltima atualiza√ß√£o:** 2025-01-06
