# Holder Validation Rules

Regras de validação aplicadas a entity Holder (titular de unidade habitacional) garantindo integridade dados pessoais unicidade de identificação e consistência de vínculos com Units através de UnitHolder estabelecendo compliance com LGPD e requisitos legais de regularização fundiária. Validação de identificação estabelece que cpf quando preenchido (Holder pessoa física) deve ser válido conforme algoritmo de dígitos verificadores padrão Receita Federal impedindo cadastro de CPFs manifestamente inválidos (sequências repetidas como 111.111.111-11 ou dígitos verificadores incorretos), cpf deve ser único por tenant prevenindo duplicação de mesmo titular em múltiplos cadastros (query verifica existência de Holder com mesmo cpf e tenant_id rejeitando criação se encontrado), cnpj quando preenchido (Holder pessoa jurídica) deve ser válido conforme algoritmo de dígitos verificadores padrão Receita Federal, cnpj deve ser único por tenant similar a restrição de CPF, exatamente um dos campos cpf ou cnpj deve estar preenchido não ambos nem nenhum garantindo identificação clara de tipo de pessoa (física ou jurídica), e rg quando preenchido deve seguir formato válido de documento de identidade brasileiro permitindo variações estaduais mas validando estrutura básica. Validação de dados pessoais requer full_name obrigatório com mínimo de 2 palavras separadas por espaço representando ao menos nome e sobrenome rejeitando nomes incompletos ou inválidos (exemplo apenas um nome ou string vazia), email quando preenchido deve ser válido conforme RFC 5322 usando validação de formato padrão impedindo emails malformados, phone_number quando preenchido deve seguir formato brasileiro com DDD validando que área code está entre códigos válidos (11 a 99 conforme lista oficial de DDDs) e number tem 8 ou 9 dígitos conforme padrão telefonia móvel ou fixa, date_of_birth quando preenchido deve ser data passada (não pode ser futura) e pessoa deve ter idade mínima configurável (exemplo 18 anos para titular principal mas permite menores como dependentes), e address quando preenchido deve ter campos mínimos como logradouro e municipio garantindo localização básica mesmo se endereço completo não estiver disponível. Validação de vínculo com Units via UnitHolder estabelece que ao menos um UnitHolder deve existir vinculando Holder a Unit antes de Unit poder transicionar para status aprovado ou iniciar processo de legitimação garantindo que toda propriedade tem titular identificado, soma de ownership_percentage de todos UnitHolders vinculados a mesma Unit não pode exceder 100% prevenindo propriedade mais que integral (query soma percentuais verificando total ≤100), exatamente um UnitHolder por Unit deve ter is_primary_holder true identificando titular principal responsável por comunicações oficiais e documentação legal, relationship_type deve ser válido conforme enum definido (OWNER POSSESSOR OCCUPANT SPOUSE HEIR) descrevendo natureza de vínculo jurídico com propriedade, e datas de vínculo (started_at ended_at) quando preenchidas devem ser cronologicamente consistentes (started_at < ended_at) e ended_at se presente indica histórico não vínculo atual. Validação de documentos anexados via Documents polimórficos verifica que ao menos um documento identificação (DOC_CPF ou DOC_RG ou DOC_CNH) está anexado antes de aprovar Unit vinculada garantindo comprovação de identidade, foto do titular (DOC_PHOTO_HOLDER) é recomendada mas não obrigatória exceto para modalidades específicas de REURB, comprovante de residência (DOC_RESIDENCE_PROOF) quando requerido por modalidade de legitimação deve ter data recente (exemplo últimos 3 meses) validando atualidade de vínculo com imóvel, e documentos de estado civil (certidão de casamento união estável) quando cônjuge está listado como UnitHolder tipo SPOUSE devem estar presentes comprovando vínculo familiar. Validação de elegibilidade para REURB-S (interesse social) quando aplicável verifica que declared_income se preenchido não excede limite configurável (tipicamente 3 salários mínimos federais) qualificando beneficiário como baixa renda, ausência de propriedade anterior em nome do titular consultando bases de dados de registros imobiliários ou mediante declaração (verificação pode ser manual ou integrada se API disponível), e situação de moradia indica ocupação efetiva (não especulação imobiliária) validando através de comprovante de residência testemunhos ou visita técnica registrada em Annotation de Unit. Validação de duplicatas detecta potenciais cadastros duplicados do mesmo titular comparando CPF (match exato indica duplicata certa), nome usando algoritmo de similaridade fuzzy (Levenshtein distance ou similar) detectando variações de grafia ou erros de digitação (José Silva vs Jose da Silva), data de nascimento combinada com nome parcial aumentando confiança de match, e endereço via proximidade geográfica (Holders com endereços muito próximos <50m e nomes similares podem ser mesma pessoa), sistema exibe alertas de duplicata potencial permitindo analista decidir se são realmente mesma pessoa (merge) ou pessoas distintas (manter separadas) ou falso positivo (ignorar). Validação de compliance LGPD garante consentimento explícito do titular para tratamento de dados pessoais registrado em campo consent boolean ou documento de consentimento anexado, minimização de dados coletando apenas informações estritamente necessárias para finalidade de regularização fundiária sem solicitar dados irrelevantes, e direito de acesso retificação e exclusão implementado através de funcionalidades permitindo titular solicitar visualização correção ou remoção de dados pessoais (exceto quando retenção é obrigatória por lei para processo de legitimação em andamento). Validação em modo offline (aplicativo mobile) executa subset de validações possíveis sem conectividade como formato de CPF estrutura de email e consistência de datas permitindo feedback imediato ao técnico de campo, marca registros com flag pending_full_validation indicando que validações completas (unicidade de CPF consulta a duplicatas) serão executadas durante sincronização com servidor, e servidor executa validações completas durante push de sincronização rejeitando ou marcando para correção registros que falham em validações não executáveis offline. Erros de validação geram mensagens específicas orientando usuário sobre problema detectado e ação corretiva necessária (exemplo CPF inválido verifique digitação ou CPF já cadastrado possível duplicata verificar ID XXX) facilitando correção, são registrados em logs de validação para troubleshooting e análise de qualidade de dados permitindo identificar campos problemáticos ou padrões de erro, e bloqueiam operações críticas (aprovação de Unit início de legitimação) até serem sanados mas permitem salvar Holder em modo draft para correção posterior não perdendo trabalho já realizado.

**Relacionado:**
- Entities: Holder, Unit, UnitHolder, Document
- Value Objects: Cpf, Cnpj, Email, PhoneNumber, Address, DocumentType
- Workflows: field-data-collection-workflow.md, analyst-validation-workflow.md

---

**Última atualização:** 2025-01-05
**Status do arquivo**: Review
