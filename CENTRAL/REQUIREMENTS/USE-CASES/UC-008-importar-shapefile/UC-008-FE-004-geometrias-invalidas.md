---
modules: [GEOGIS]
epic: scalability
---

# UC-008-FE-004: Geometrias Inválidas

Fluxo de exceção do UC-008 Importar Shapefile ocorrendo no passo 10.2 durante validação de geometria quando worker processa cada feature extraída do Shapefile lê geometria binária do .shp converte para formato PostGIS e executa validação topológica usando ST_IsValid(geometry) retornando false indicando problemas estruturais como auto-interseções (polígono cruza a si próprio formando figura-oito ou laços), anéis não fechados (primeiro vértice diferente do último violando definição de polígono fechado), anéis externos e internos sobrepostos (buraco no polígono toca ou cruza borda externa), vértices duplicados consecutivos criando spike degenerado, ou coordenadas inválidas (NaN Infinity ou valores fora de range válido para SRID), tipicamente causado por digitalização manual incorreta em CAD ou GIS onde operador clicou vértices duplicados ou muito próximos gerando topologia mal formada, operações booleanas de geoprocessamento (união interseção diferença) que produziram resultados degenerados não validados antes de exportar, conversão entre formatos com precisão numérica diferente introduzindo erros de arredondamento que violaram tolerâncias topológicas, ou corrupção de dados durante transferência ou edição, sistema ao detectar invalidade via ST_IsValid registra warning incluindo feature_index e motivo específico retornado por ST_IsValidReason que descreve problema exato como "Self-intersection[123.456 -45.678]" indicando coordenadas do ponto problemático, tenta correção automática usando PostGIS ST_MakeValid(geometry) que aplica heurísticas para reparar topologia removendo spikes colapsando vértices duplicados separando componentes de auto-interseção em MultiPolygon válido preservando máximo de área e forma original possível, executa ST_IsValid novamente na geometria corrigida verificando se repair bem-sucedido retornando true, se correção bem-sucedida worker continua importação usando geometria reparada ao invés da original inserindo em units com geometry corrigida adicionando flag was_repaired=true e observação automática "Geometria corrigida automaticamente durante importação - revisar" alertando para revisão posterior, se ST_MakeValid também falha (casos extremos de corrupção severa onde nem algoritmo de correção consegue produzir geometria válida) worker pula registro completamente não criando unidade adicionando erro em import_errors com severity=ERROR code="INVALID_GEOMETRY_UNFIXABLE" message incluindo output de ST_IsValidReason, continua processando próximos registros sem abortar job, relatório final separa estatísticas Importadas 230, Geometrias Corrigidas 15 com ícone amarelo, Geometrias Inválidas Ignoradas 5 com vermelho, log CSV inclui coluna acao_tomada indicando CORRECTED ou SKIPPED e coluna motivo_invalidade copiando ST_IsValidReason, usuário pode baixar log identificar features problemáticas pela feature_index correspondendo a FID do Shapefile original abrir em QGIS carregar Shapefile fonte usar ferramenta Check Validity localizar exatamente polígonos inválidos e corrigir manualmente redesenhando ou usando Fix Geometries tool garantindo ST_IsValid=true antes de reimportar subset corrigido.

**Ponto de Desvio:** Passo 10.2 do UC-008 (validação topológica falha)

**Retorno:** Tentativa de correção com ST_MakeValid, se sucesso importa corrigida, se falha pula registro

---

**Última atualização:** 2025-12-30
**Status do arquivo**: Review
