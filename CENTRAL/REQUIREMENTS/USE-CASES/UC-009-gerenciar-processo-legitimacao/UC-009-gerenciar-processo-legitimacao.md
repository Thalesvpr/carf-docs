---
modules: [GEOWEB]
epic: scalability
---

# UC-009: Gerenciar Processo de Legitimação Fundiária

Caso de uso permitindo usuários autorizados (ANALYST com permissão legitimation.create para criar e preparar processos administrativos, MANAGER com legitimation.approve para aprovar e deferir, ADMIN com acesso total ao tenant) criarem e acompanharem processos de legitimação fundiária de unidades habitacionais conforme Lei 13.465/2017 regulamentando REURB (Regularização Fundiária Urbana) modalidades Social e de Interesse Específico após autenticação e seleção de unidade aprovada com titular principal vinculado, onde fluxo principal inicia com acesso aos detalhes de unidade específica exibindo página completa com tabs mostrando Dados Cadastrais Titulares Fotos Documentos Timeline, sistema exibe seção Legitimação Fundiária no tab Processos mostrando status atual "Nenhum processo iniciado" com botão Iniciar Processo de Legitimação habilitado apenas se unidade possui status=APPROVED e exists titular com is_primary=true validando pré-condições de negócio, usuário clica disparando abertura de modal de criação exibindo formulário estruturado com campos obrigatórios e opcionais incluindo Número do Processo gerado automaticamente usando padrão LEGITIM-{year}-{sequence} (ex: LEGITIM-2025-00123) incrementando sequence por tenant ou permitindo input manual para processos migrados de sistema legado, dropdown Tipo de Legitimação oferecendo opções REURB-S (Regularização de Interesse Social para população baixa renda), REURB-E (Regularização de Interesse Específico para outros casos), Legitimação de Posse (Lei 13.465 Art. 23 convertendo posse em propriedade após 5 anos), radio buttons Modalidade selecionando Individual (processo único para 1 unidade) ou Coletiva (processo consolidado para múltiplas unidades adjacentes tratadas em lote), dropdown Beneficiário Principal listando todos titulares da unidade via query SELECT * FROM holders JOIN unit_holders WHERE unit_id = $id permitindo selecionar quem receberá título, date picker Data de Protocolo registrando quando processo foi aberto oficialmente no órgão competente, input text Órgão Responsável informando qual secretaria ou departamento municipal responsável (ex: "Secretaria de Habitação - SEHAB", "Departamento de Regularização Fundiária"), e textarea Observações para notas gerais, usuário preenche dados selecionando tipo modalidade beneficiário definindo datas e clica Criar Processo disparando validação verificando número_processo único via constraint UNIQUE, beneficiário_id não null, tipo e modalidade selecionados, se validação passa sistema cria registro em tabela legitimation_processes inserindo com status=EM_ANALISE indicando fase inicial de preparação de documentação, exibe tela de detalhes do processo renderizando layout completo com header mostrando número do processo tipo modalidade status colorido (amarelo para Em Análise) e informações do beneficiário, seção central exibe checklist de documentos obrigatórios dinamicamente gerado baseado em tipo de legitimação onde REURB-S requer Declaração de Posse assinada pelo beneficiário, RG e CPF frente e verso digitalizados, Comprovante de Residência (conta luz água telefone) com data recente <90 dias, Memorial Descritivo técnico da unidade com área e confrontantes, Planta da Unidade desenho técnico cotado com ART de responsável técnico, enquanto REURB-E adiciona também Certidão de Inteiro Teor do imóvel emitida por cartório comprovando titularidade ou ausência de registro, cada item da checklist exibe checkbox status (pendente concluído) ícone de upload e nome do arquivo anexado se presente, usuário clica em item expandindo painel de upload permitindo arrastar arquivo PDF ou imagem JPEG PNG, ao fazer upload sistema valida tamanho <10MB e tipo MIME permitido, salva binário em object storage gerando URL presigned, cria registro em process_documents table com foreign key process_id document_type uploaded_by uploaded_at, marca checkbox do item como concluído exibindo ícone verde checkmark e nome do arquivo clicável para preview ou download, quando todos documentos obrigatórios anexados verificando checklist 100% completa botão Submeter para Aprovação habilita no rodapé, usuário clica atualizando status do processo de DOCUMENTACAO_PENDENTE para AGUARDANDO_APROVACAO enviando notificação ao MANAGER responsável, MANAGER acessa menu Processos Pendentes listando todos legitimation_processes WHERE status=AGUARDANDO_APROVACAO do tenant ordenados por data de submissão, seleciona processo específico abrindo tela de revisão exibindo mesmos dados com documentos anexados renderizados inline permitindo visualizar PDFs em iframe e imagens em lightbox facilitando análise sem baixar arquivos, revisa conformidade verificando se documentos atendem requisitos legais estão legíveis assinados datados, decide entre três ações usando botões no rodapé: Aprovar atualizando status=APROVADO registrando approved_by=manager_id approved_at=NOW() adicionando entry em timeline disparando notificação ao ANALYST criador, Solicitar Correções abrindo modal para adicionar comentário obrigatório descrevendo problemas encontrados (ex: "Comprovante de residência com data superior a 90 dias - anexar documento recente") atualizando status=DOCUMENTACAO_PENDENTE enviando notificação ao criador com comentários destacados retornando processo para ajustes, ou Indeferir abrindo modal com textarea de justificativa obrigatória explicando motivo legal de indeferimento atualizando status=INDEFERIDO marcando archived=true impedindo edições futuras registrando deferred_by deferred_at deferred_reason em tabela para auditoria e histórico, se aprovado sistema exibe novo botão Gerar Termo de Legitimação na tela de detalhes permitindo produzir documento oficial, usuário clica disparando worker que busca dados completos do processo unidade beneficiário titulares executando queries com JOINs, renderiza template HTML de Termo usando Handlebars preenchendo automaticamente campos como número do processo nome completo do beneficiário CPF endereço da unidade área m² confrontantes descrição legal do imóvel data de emissão assinatura digital do gestor municipal, converte HTML para PDF usando Puppeteer com formatação A4 margens oficiais headers e footers com logo da prefeitura e brasão municipal, salva PDF gerado em object storage com chave term_{process_id}_{timestamp}.pdf, exibe preview inline permitindo revisão antes de baixar, usuário baixa PDF clicando botão Download salvando localmente com nome Termo_Legitimacao_LEGITIM-2025-00123.pdf pronto para impressão assinatura física e registro em cartório, após emissão e entrega do termo físico ao beneficiário usuário atualiza status do processo para CONCLUIDO marcando concluded_at=NOW() encerrando workflow e movendo processo para histórico permitindo consulta futura mas impedindo modificações garantindo integridade de registros arquivísticos. Fluxos alternativos incluem processo coletivo vinculando múltiplas unidades ao mesmo processo (UC-009-FA-001) e assinatura digital do termo via integração com plataforma DocuSign ou D4Sign (UC-009-FA-002). Fluxos de exceção cobrem unidade sem titular principal impedindo criação (UC-009-FE-001), documentação incompleta bloqueando submissão (UC-009-FE-002), e processo indeferido sendo arquivado definitivamente (UC-009-FE-003).

**Fluxos Alternativos:**
- UC-009-FA-001: Processo coletivo (múltiplas unidades)
- UC-009-FA-002: Assinatura digital do termo

**Fluxos de Exceção:**
- UC-009-FE-001: Unidade sem titular principal
- UC-009-FE-002: Documentação incompleta
- UC-009-FE-003: Processo indeferido

**Regras de Negócio:**
- RN-001: Apenas unidades com status=APPROVED podem ter processo de legitimação iniciado
- RN-002: Checklist de documentos varia dinamicamente por tipo de legitimação (REURB-S vs REURB-E)
- RN-003: Processo indeferido não pode ser reaberto nem editado (criar novo processo se necessário)
- RN-004: Termo de legitimação só pode ser gerado após status=APROVADO validado via permissão
- RN-005: Número de processo deve ser único dentro do tenant validado via constraint UNIQUE

**Rastreabilidade:**
- RF-172, RF-173, RF-174, RF-175, RF-176, RF-177, RF-179, RF-180
- US-078, US-080, US-081

---

**Última atualização:** 2025-12-30
