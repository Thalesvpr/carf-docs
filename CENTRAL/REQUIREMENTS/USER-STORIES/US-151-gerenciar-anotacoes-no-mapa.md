---
modules: [GEOAPI, GEOWEB, REURBCAD, GEOGIS]
epic: compatibility
---

# US-151: Gerenciar Anotacoes no Mapa

Como Analista quero criar e listar anotacoes no mapa para que possa marcar pontos de interesse ou observacoes durante analise espacial registrar problemas identificados como sobreposicoes irregularidades e inconsistencias cadastrais e colaborar com equipe atraves de comentarios geograficamente contextualizados, onde o endpoint implementado em GEOAPI expoe a rota /api/annotations permitindo operacoes GET para listagem paginada POST para criacao PUT para atualizacao e DELETE para exclusao de anotacoes, garantindo validacao de permissoes baseada em roles onde usuarios com role Analyst ou superior podem criar e gerenciar anotacoes, incluindo validacao de dados de entrada onde anotacao deve conter geometria tipo Point LineString ou Polygon titulo descricao e opcionalmente categoria problema conflito observacao melhoria, permitindo filtragem da listagem por communityId para anotacoes de uma comunidade especifica, category para filtrar por tipo, status para filtrar por OPEN IN_PROGRESS RESOLVED CLOSED, assignedTo para anotacoes atribuidas a usuario especifico, createdBy para anotacoes criadas por usuario e dateRange para filtrar por periodo de criacao, onde a resposta da listagem inclui paginacao com page size totalCount e array de objetos Annotation contendo id title description category status geometry communityId communityName createdBy createdByName assignedTo assignedToName priority repliesCount attachmentsCount createdAt updatedAt resolvedAt, garantindo rastreabilidade ao requisito funcional RF-133 que especifica ferramentas de anotacao colaborativa em mapas, incluindo relacionamento com entidades Community User createdBy assignedTo e opcionalmente Unit Plot Block quando anotacao esta vinculada a elemento cadastral especifico, permitindo que o frontend GEOWEB exiba mapa interativo com anotacoes renderizadas como markers poligonos ou linhas coloridos conforme categoria e status com popup mostrando titulo descricao e acoes, onde criacao de anotacao requer payload JSON com propriedades title description category geometry em formato GeoJSON communityId opcional assignedTo ID do usuario responsavel por resolver, priority nivel de prioridade LOW MEDIUM HIGH CRITICAL e attachments array de IDs de documentos fotos ou croquis anexados, garantindo validacao geometrica onde sistema verifica que geometria da anotacao e valida nao possui auto-intersecoes e opcionalmente esta contida dentro dos limites da comunidade especificada, incluindo suporte a desenho de geometrias no mapa onde frontend permite que usuario trace ponto linha ou poligono diretamente no mapa capturando coordenadas e gerando GeoJSON automaticamente, permitindo notificacao automatica ao usuario assignedTo quando anotacao for criada ou reatribuida via email e push notification incluindo link direto para visualizar anotacao no mapa, onde alteracao de status de OPEN para RESOLVED requer preenchimento de campo resolutionNotes descrevendo como problema foi solucionado e opcionalmente anexo de documentos comprobatorios, garantindo que apenas usuario assignedTo ou usuarios com role Manager podem resolver anotacoes impedindo que outros usuarios marquem como resolvido sem autorizacao, incluindo sistema de comentarios onde usuarios podem adicionar replies a anotacoes criando thread de discussao contextualizada geograficamente facilitando colaboracao entre analistas topografos e gerentes, permitindo subscricao a anotacoes onde usuario interessado recebe notificacoes automaticas quando novos comentarios sao adicionados status e alterado ou anotacao e resolvida, onde a implementacao em GEOAPI armazena geometria em coluna geometry do PostGIS permitindo queries espaciais como anotacoes dentro de bounding box anotacoes proximas a ponto e anotacoes que intersectam geometria de unidade, garantindo soft delete de anotacoes onde registro e marcado como inativo preservando historico mas ocultando de listagens ativas, incluindo dashboard de anotacoes mostrando metricas agregadas como total por categoria total por status tempo medio de resolucao anotacoes vencidas e ranking de usuarios com mais anotacoes resolvidas, permitindo export de anotacoes em formatos GeoJSON KML Shapefile e CSV para uso em sistemas GIS externos e relatorios gerenciais, onde testes unitarios validam regras de negocio incluindo validacao de geometria validacao de transicoes de status e calculo de metricas agregadas com datasets mock, garantindo testes de integracao que verificam criacao listagem atualizacao resolucao queries espaciais e notificacoes de anotacoes em banco de dados PostgreSQL com PostGIS.

---

**Ultima atualizacao:** 2025-12-30
