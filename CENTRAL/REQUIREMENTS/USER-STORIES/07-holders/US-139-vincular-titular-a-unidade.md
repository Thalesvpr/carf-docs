---
modules: [GEOAPI, GEOWEB]
epic: compatibility
---

# US-139: Vincular Titular a Unidade

Como Analista quero associar um titular a uma unidade para que possa registrar posse ou propriedade estabelecendo relacao juridica entre pessoa fisica ou juridica e unidade habitacional, onde o endpoint implementado em GEOAPI expoe a rota /api/units/{id}/holders/{holderId} com metodo PUT para criar vinculo entre unidade e titular, garantindo validacao de permissoes baseada em roles onde apenas usuarios com role Manager ou superior podem vincular titulares a unidades, incluindo tratamento de erros 404 Not Found quando ID da unidade ou titular nao existe, 403 Forbidden quando usuario nao possui permissao e 409 Conflict quando vinculo ja existe, permitindo payload JSON opcional com propriedades linkType indicando tipo de vinculo OWNER POSSESSOR TENANT HEIR CO_OWNER, linkDate data de inicio do vinculo, isMainResidence booleano indicando se e residencia principal, sharePercentage percentual de propriedade em casos de co-propriedade e documents array de IDs de documentos comprobatorios anexados, onde validacao de regras de negocio impede vinculacao quando unidade esta em status DRAFT ou REJECTED retornando erro 422 Unprocessable Entity com mensagem descritiva, garantindo rastreabilidade ao requisito funcional RF-091 que especifica gerenciamento de titularidade, incluindo validacao de unicidade onde sistema permite multiplos titulares por unidade em casos de co-propriedade mas impede duplicacao de vinculo entre mesmo titular e mesma unidade, permitindo que em casos de co-propriedade a soma de sharePercentage de todos os titulares nao exceda 100% com validacao automatica ao criar novo vinculo, onde a criacao de vinculo dispara evento de dominio HolderLinkedToUnit publicado no message bus permitindo atualizacao de indices de busca invalidacao de cache e notificacao de workflows downstream, garantindo registro de auditoria automatico capturando usuario responsavel timestamp IP address e documentos comprobatorios para fins de compliance e rastreabilidade juridica, incluindo validacao de documentacao obrigatoria configuravel por tipo de vinculo onde OWNER requer escritura ou contrato de compra e venda enquanto POSSESSOR pode aceitar declaracao de posse, permitindo que o frontend GEOWEB exiba formulario modal com campos para selecao de titular tipo de vinculo data de inicio checkbox de residencia principal slider de percentual e upload de documentos comprobatorios, onde a implementacao em GEOAPI utiliza transacao de banco de dados garantindo atomicidade onde vinculo e criado junto com registros de auditoria e atualizacao de campos derivados na unidade como mainHolderId, garantindo soft delete de vinculos onde desvincular titular marca registro como inativo sem remocao fisica preservando historico de titularidade ao longo do tempo, incluindo notificacao automatica por email ou SMS ao titular quando vinculacao for efetivada informando codigo da unidade endereco e proximos passos no processo de regularizacao, onde testes unitarios validam regras de negocio incluindo validacao de sharePercentage unicidade de vinculo e validacao de documentacao obrigatoria com mocks de repositorio, garantindo testes de integracao que verificam criacao de vinculo em banco de dados PostgreSQL publicacao de evento no RabbitMQ e registro de auditoria na tabela audit_logs, incluindo validacao de cenarios complexos como transferencia de titularidade onde novo titular e vinculado e anterior e desvinculado em mesma transacao garantindo consistencia.

---

**Ultima atualizacao:** 2025-12-30
**Última atualização:** 2026-01-15
**Status do arquivo**: Review
