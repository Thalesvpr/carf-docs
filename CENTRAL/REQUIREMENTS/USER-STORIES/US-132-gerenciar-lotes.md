---
modules: [GEOAPI, GEOWEB]
epic: compatibility
---

# US-132: Gerenciar Lotes

Como Analista quero listar e criar lotes para que possa subdividir quadras em lotes menores conforme parcelamento do solo do assentamento, onde o endpoint implementado em GEOAPI expoe a rota /api/plots permitindo operacoes GET para listagem paginada e POST para criacao de novos lotes, garantindo validacao de permissoes baseada em roles onde usuarios com role Analyst ou superior podem listar lotes mas apenas Managers podem criar novos, incluindo validacao de dados de entrada onde codigo do lote deve ser unico dentro da quadra e geometria deve ser um poligono valido em formato GeoJSON contido dentro da geometria da quadra pai, permitindo filtragem da listagem por blockId para exibir apenas lotes de uma quadra especifica, communityId para lotes de uma comunidade e status para filtrar por DRAFT PENDING APPROVED, onde a resposta da listagem inclui paginacao com page size totalCount e array de objetos Plot contendo id code name geometry area status blockId blockCode communityId communityName createdAt updatedAt, garantindo rastreabilidade ao requisito funcional RF-079 que especifica gerenciamento de parcelamento do solo, incluindo relacionamento com entidade Block onde cada lote pertence a exatamente uma quadra e relacionamento com entidade Unit onde cada lote pode conter multiplas unidades habitacionais, permitindo que o frontend GEOWEB exiba mapa interativo com poligonos dos lotes renderizados em camada vetorial com cores diferenciadas por status, onde a criacao de lote requer payload JSON com propriedades code name blockId e geometry em formato GeoJSON Polygon ou MultiPolygon, garantindo validacao topologica onde sistema verifica que geometria do lote esta completamente contida dentro da geometria da quadra pai usando operacao ST_Within do PostGIS, incluindo validacao de sobreposicao onde sistema impede criacao de lotes com geometrias que se sobrepoem a lotes existentes da mesma quadra usando operacao ST_Overlaps, incluindo calculo automatico de area do poligono em metros quadrados armazenado na propriedade area do modelo Plot, onde a implementacao em GEOAPI utiliza biblioteca NetTopologySuite para operacoes geometricas incluindo validacao de poligonos calculo de area deteccao de sobreposicao e teste de containment, permitindo soft delete de lotes onde registro e marcado como inativo sem remocao fisica do banco de dados garantindo rastreabilidade historica, garantindo que exclusao de lote seja bloqueada caso existam unidades habitacionais associadas retornando erro 409 Conflict com mensagem descritiva, incluindo testes unitarios que validam regras de negocio incluindo unicidade de codigo validacao de geometria calculo de area e validacao de containment dentro da quadra, garantindo testes de integracao que verificam criacao listagem atualizacao e exclusao de lotes em banco de dados PostgreSQL com PostGIS validando corretude de operacoes espaciais.

---

**Ultima atualizacao:** 2025-12-30
