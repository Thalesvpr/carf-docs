---
modules: [GEOAPI, GEOWEB, GEOGIS]
epic: performance
---

# US-134: Obter Geometria de Lote

Como Analista quero obter poligono geoespacial do lote para que possa exibir limites do lote no mapa de forma otimizada sem carregar metadados desnecessarios reduzindo payload e melhorando performance de rendering, onde o endpoint implementado em GEOAPI expoe a rota /api/plots/{id}/geometry retornando exclusivamente a geometria GeoJSON do lote para uso em camadas vetoriais de mapas web, garantindo validacao de permissoes baseada em roles onde usuarios autenticados podem acessar geometrias de lotes do seu tenant, incluindo tratamento de erro 404 Not Found quando ID do lote nao existe e 403 Forbidden quando usuario tenta acessar lote de outro tenant, permitindo resposta leve otimizada para rendering em mapas contendo apenas objeto GeoJSON com type coordinates properties crs sem metadados administrativos, onde o sistema de referencia espacial CRS retornado e EPSG:4326 WGS84 compativel com bibliotecas de mapa web Leaflet OpenLayers Mapbox GL e Google Maps, garantindo rastreabilidade ao requisito funcional RF-081 que especifica visualizacao de elementos de parcelamento, incluindo suporte a content negotiation onde cliente pode requisitar geometry em formatos alternativos incluindo WKT Well-Known Text WKB Well-Known Binary e KML atraves de header Accept, permitindo que o frontend GEOWEB utilize este endpoint para carregar geometrias sob demanda quando usuario faz zoom no mapa ou seleciona lote especifico reduzindo payload inicial da aplicacao e melhorando tempo de carregamento, onde a implementacao em GEOAPI projeta query de banco de dados para selecionar apenas coluna geometry da tabela plots evitando overhead de carregar todas as propriedades da entidade Plot, garantindo cache de geometrias no lado servidor com estrategia LRU Least Recently Used e invalidacao automatica quando geometria do lote for atualizada via evento de dominio, incluindo compressao gzip e brotli da resposta para reduzir trafego de rede especialmente importante para poligonos complexos com centenas ou milhares de vertices, permitindo parametro de query simplify com valor numerico de tolerancia em metros para simplificacao topologica do poligono usando algoritmo Douglas-Peucker reduzindo quantidade de vertices mantendo forma geral do poligono, garantindo que simplificacao preserva topologia nao gerando auto-intersecoes ou poligonos invalidos atraves de validacao pos-simplificacao, incluindo suporte a parametro transform para reprojetar geometria para sistemas de referencia alternativos como UTM SIRGAS2000 SAD69 atraves de especificacao de EPSG code, onde testes unitarios validam serializacao correta de geometrias incluindo Polygon MultiPolygon e casos edge como poligonos com furos inner rings, garantindo testes de integracao que verificam corretude da geometria retornada comparando hash MD5 com geometria armazenada no banco PostGIS e validando que simplificacao e reprojecao nao corrompem dados geoespaciais.

---

**Ultima atualizacao:** 2025-12-30
