---
modules: [GEOAPI, GEOWEB, REURBCAD]
epic: compatibility
---

# US-153: Comentar em Anotacao

Como Analista quero adicionar comentarios a anotacoes para que possa discutir observacoes com equipe fornecer atualizacoes sobre investigacao de problemas colaborar na resolucao de conflitos cadastrais e documentar decisoes tomadas de forma contextualizada geograficamente, onde o endpoint implementado em GEOAPI expoe a rota /api/annotations/{id}/replies com metodo POST para adicionar comentario a anotacao existente, garantindo validacao de permissoes baseada em roles onde usuarios autenticados podem comentar em anotacoes do seu tenant, incluindo tratamento de erros 404 Not Found quando ID da anotacao nao existe e validacao de ownership garantindo que usuario nao comente em anotacoes de outros tenants, permitindo payload JSON com propriedades content texto do comentario em formato plain text ou markdown, attachments array opcional de IDs de documentos anexados ao comentario e mentions array de IDs de usuarios mencionados no comentario para acionar notificacoes, onde validacao de conteudo verifica que comentario nao esta vazio tem tamanho minimo de 10 caracteres e maximo de 5000 caracteres rejeitando conteudo invalido, garantindo rastreabilidade ao requisito funcional RF-135 que especifica colaboracao atraves de comentarios em anotacoes, incluindo suporte a formatacao markdown permitindo que usuarios utilizem negrito italico listas links e code blocks para estruturar comentarios de forma clara e legivel, permitindo que criacao de comentario dispare notificacoes automaticas aos usuarios subscribers da anotacao usuario assignedTo usuario createdBy e usuarios mentioned via email e push notification incluindo preview do comentario e link direto para anotacao, onde comentarios sao ordenados cronologicamente em ordem crescente formando thread de discussao facilitando acompanhamento da evolucao da resolucao do problema, garantindo que cada comentario registra timestamp usuario autor avatar conteudo e opcionalmente attachments permitindo rastreabilidade completa de quem disse o que e quando, incluindo deteccao automatica de mencoes onde sistema parseia conteudo identificando padroes @username e extrai lista de usuarios mencionados para envio de notificacoes direcionadas, permitindo edicao de comentarios onde usuario autor pode editar conteudo dentro de janela de tempo configuravel tipicamente 15 minutos apos criacao com marcacao de edited timestamp, garantindo que exclusao de comentarios e soft delete marcando como inativo mas preservando na thread com indicacao deleted by author ou deleted by moderator conforme caso, incluindo possibilidade de moderacao onde usuarios com role Manager podem excluir comentarios inapropriados ou off-topic protegendo qualidade das discussoes, permitindo reacoes a comentarios onde usuarios podem adicionar emojis like thumbs up heart conforme suporte a engagement rapido sem necessidade de escrever resposta completa, onde a implementacao em GEOAPI utiliza Repository pattern para persistir comentarios e Event pattern para publicar evento ReplyAdded acionando sistema de notificacoes, garantindo validacao de rate limiting onde usuario nao pode adicionar mais de X comentarios por minuto configuravel tipicamente 10 prevenindo spam e abuse, incluindo filtragem de conteudo ofensivo onde sistema utiliza lista de palavras proibidas e opcionalmente servico de moderacao automatica tipo Perspective API para detectar toxicidade, permitindo que comentarios incluam codigo de formatacao especial como menção a elementos cadastrais tipo #UNIT-001 ou #PLOT-042 que sao automaticamente convertidos em links clicaveis para navegacao, onde frontend GEOWEB exibe thread de comentarios com avatar do autor nome timestamp conteudo renderizado com markdown attachments e botoes de acao editar excluir reagir conforme permissoes, garantindo atualizacao em tempo real da thread de comentarios via WebSocket onde usuarios visualizando mesma anotacao recebem novos comentarios instantaneamente sem necessidade de refresh, incluindo campo de entrada de comentario com suporte a autocomplete de mencoes sugerindo usuarios conforme digitacao facilita menção correta, onde testes unitarios validam parsing de mencoes formatacao markdown validacao de tamanho e deteccao de conteudo ofensivo com datasets mock, garantindo testes de integracao que verificam criacao de comentario em banco de dados publicacao de evento envio de notificacoes e atualizacao de contador de replies na anotacao.

---

**Ultima atualizacao:** 2025-12-30
