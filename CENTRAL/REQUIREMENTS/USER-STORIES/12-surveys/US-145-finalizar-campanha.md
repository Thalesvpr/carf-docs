---
modules: [GEOAPI, GEOWEB, REURBCAD, GEOGIS]
epic: performance
---

# US-145: Finalizar Campanha

Como Gerente quero finalizar campanha de levantamento para que possa processar dados coletados executar ajustamento topografico consolidar resultados e liberar equipe para proxima campanha, onde o endpoint implementado em GEOAPI expoe a rota /api/surveying/campaigns/{id}/complete com metodo POST para encerrar campanha e processar dados finais, garantindo validacao de permissoes baseada em roles onde apenas usuarios com role Manager ou superior podem finalizar campanhas, incluindo tratamento de erros 404 Not Found quando ID da campanha nao existe, 403 Forbidden quando usuario nao possui permissao e 422 Unprocessable Entity quando campanha nao atende criterios minimos para finalizacao, permitindo que operacao execute transicao automatica de status de ACTIVE para COMPLETED acionando workflows de processamento pos-coleta, onde validacao pre-finalizacao verifica criterios minimos incluindo quantidade minima de pontos coletados ausencia de medicoes pendentes de validacao fechamento de poligonais abertas e aprovacao de relatorio de campo pelo responsavel tecnico, garantindo rastreabilidade ao requisito funcional RF-159 que especifica gerenciamento de ciclo de vida de campanhas, incluindo payload JSON opcional com propriedades completionNotes comentarios finais do gerente sobre a campanha, actualEndDate data efetiva de termino que pode diferir de endDate planejada, adjustmentRequired booleano indicando se ajustamento topografico deve ser executado automaticamente e exportFormats array de formatos para export automatico dos dados como SHAPEFILE GEOJSON KML LANDXML, onde finalizacao dispara processamento assincrono incluindo validacao de fechamento de poligonais calculo de precisoes estatisticas deteccao de outliers execucao de ajustamento topografico se adjustmentRequired for true e geracao de relatorio tecnico consolidado, garantindo que ajustamento automatico utiliza metodo dos minimos quadrados MMQ com pontos de controle fixos definidos no inicio da campanha aplicando correcoes sistematicas e distribuindo erros residuais conforme pesos das observacoes, incluindo atualizacao automatica das geometrias das unidades habitacionais vinculadas aos pontos topograficos da campanha aplicando coordenadas ajustadas e recalculando areas perimetros e indices de forma, permitindo que finalizacao gere snapshot imutavel dos dados da campanha incluindo medicoes brutas coordenadas ajustadas relatorios e metadados arquivados em storage de longo prazo tipo S3 ou Azure Blob para compliance e auditoria, onde evento de dominio CampaignCompleted e publicado no message bus acionando workflows downstream como atualizacao de dashboards gerenciais notificacao a stakeholders liberacao de equipamentos topograficos e disponibilizacao da equipe para novas campanhas, garantindo registro de auditoria detalhado capturando usuario responsavel timestamp metricas finais da campanha quantidade de pontos coletados precisao media area coberta e tempo total de execucao, incluindo notificacao automatica ao responsavel tecnico e membros da equipe informando conclusao da campanha com link para relatorio final e metricas de performance individual, permitindo que o frontend GEOWEB exiba wizard de finalizacao com checklist interativo validando cada criterio obrigatorio preview do relatorio tecnico e confirmacao final antes de processar, onde a implementacao em GEOAPI utiliza Saga pattern para orquestrar sequencia de operacoes de finalizacao garantindo rollback automatico se qualquer etapa falhar preservando consistencia, garantindo que campanhas finalizadas se tornam read-only impedindo edicao de medicoes pontos ou configuracoes protegendo integridade dos dados oficiais, incluindo possibilidade de reabrir campanha finalizada atraves de acao administrativa especifica reopen que requer justificativa e aprovacao de nivel superior retornando campanha para status ACTIVE, onde testes unitarios validam cada validacao pre-finalizacao isoladamente logica de transicao de status e construcao de relatorio tecnico com datasets mock, garantindo testes de integracao que verificam fluxo completo de finalizacao incluindo execucao de ajustamento atualizacao de geometrias publicacao de evento arquivamento de dados e envio de notificacoes utilizando infraestrutura real.

---

**Ultima atualizacao:** 2025-12-30
**Última atualização:** 2026-01-15
**Status do arquivo**: Pronto
