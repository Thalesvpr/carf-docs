---
modules: [GEOAPI, GEOWEB]
epic: security
---

# US-113: Remover Role Específica de Usuário

Como administrador necessitando ajustar permissões de forma cirúrgica, quero remover uma role específica de usuário sem afetar demais roles atribuídos para que ajustar permissões granularmente seja possível, permitindo revogação seletiva de privilégios quando usuário muda de função parcialmente (exemplo: deixa de ser validador mas continua como editor), responder rapidamente a incidentes de segurança removendo permissões comprometidas, ou implementar acesso temporário revogando role específica após período determinado. A funcionalidade deve implementar operação DELETE direcionada a combinação específica de user_id e role_id permitindo remoção cirúrgica de uma única role mantendo intactas todas as demais permissões do usuário, diferenciando-se de operação de remoção em massa que afetaria múltiplas roles simultaneamente. O sistema deve validar consistência antes de executar remoção verificando se usuário possui a role a ser removida (evitando operação sem efeito), se remoção não viola regras de negócio críticas (exemplo: remover última role ADMIN de tenant), e se usuário executor da operação possui permissão administrativa adequada para modificar roles do usuário alvo. A operação deve ser executada transacionalmente garantindo atomicidade onde remoção é completamente efetivada ou completamente revertida em caso de erro, sem estados intermediários inconsistentes, e registrada em audit log incluindo identificação do administrador que executou remoção, timestamp preciso da operação, role específica removida, e justificativa quando fornecida. O sistema deve propagar efeito da remoção imediatamente invalidando tokens de autenticação ativos do usuário afetado forçando re-autenticação que refletirá novo conjunto de permissões, ou no mínimo aplicando mudanças no próximo refresh de token conforme política de segurança. Os critérios de aceitação incluem endpoint implementado aceitando DELETE /api/accounts/{id}/roles/{roleId} com validação de existência da atribuição, validação rigorosa de permissões garantindo que apenas administradores possam remover roles e com restrições adicionais para roles críticos, tratamento adequado de erros incluindo role não atribuída ao usuário, violação de regras de negócio ou operação não autorizada, documentação OpenAPI descrevendo semântica da operação e códigos de status HTTP retornados, e testes unitários e de integração validando remoção seletiva, preservação de demais roles, regras de validação e registro em audit log. Esta User Story está relacionada ao RF-023 e é implementada através do endpoint DELETE /api/accounts/{id}/roles/{roleId} no backend GEOAPI com controle transacional e invalidação de sessões, e interface administrativa no frontend GEOWEB com confirmação de remoção, pertencendo ao Epic 11: Administração. O status atual é proposed, com endpoint existente mas documentação formal criada posteriormente.

---

**Última atualização:** 2025-12-30
