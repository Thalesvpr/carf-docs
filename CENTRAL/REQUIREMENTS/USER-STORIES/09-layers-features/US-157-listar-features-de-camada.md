---
modules: [GEOAPI, GEOWEB, REURBCAD, GEOGIS]
epic: scalability
---

# US-157: Listar Features de Camada

Como Analista quero listar geometrias de uma camada para que possa visualizar features no mapa filtrar por atributos exportar dados e realizar analises espaciais sobre conjunto de geometrias tematicas, onde o endpoint implementado em GEOAPI expoe a rota /api/layers/{id}/features retornando lista paginada de features da camada especificada com suporte a filtragem espacial filtragem por atributos e ordenacao, garantindo validacao de permissoes baseada em roles onde usuarios autenticados podem listar features de camadas PUBLIC e camadas PRIVATE ou RESTRICTED as quais possuem acesso, incluindo tratamento de erro 404 Not Found quando ID da camada nao existe e 403 Forbidden quando usuario nao possui permissao para acessar camada, permitindo filtragem atraves de query parameters incluindo bbox bounding box para filtrar features que intersectam area especificada, within geometry em GeoJSON para features contidas em poligono, intersects geometry para features que intersectam geometria, attributeFilters objeto JSON com filtros por propriedades como status equals ACTIVE area greaterThan 100, search busca textual em propriedades configuradas e sortBy para ordenacao por propriedade area createdAt name, onde a resposta e GeoJSON FeatureCollection contendo type features array de objetos Feature com type properties geometry e bbox para cada feature, garantindo rastreabilidade ao requisito funcional RF-133 que especifica consulta e visualizacao de dados geoespaciais por camada, incluindo paginacao implementada via query parameters page size com response headers incluindo totalCount totalPages e links para previousPage nextPage facilitando navegacao, permitindo que o frontend GEOWEB utilize este endpoint para carregar features sob demanda conforme usuario faz pan e zoom no mapa implementando estrategia de viewport-based loading carregando apenas features visiveis na tela, onde parametro bbox e especificado como minLon comma minLat comma maxLon comma maxLat em coordenadas WGS84 correspondendo ao viewport atual do mapa, garantindo queries espaciais otimizadas onde sistema utiliza indice GIST do PostGIS executando ST_Intersects ou ST_Within conforme filtro espacial aplicado, incluindo suporte a simplificacao de geometrias onde parametro simplify com valor de tolerancia em metros aplica algoritmo Douglas-Peucker reduzindo complexidade de poligonos para melhorar performance de rendering em escalas de zoom distantes, permitindo projecao de propriedades onde parametro fields comma separated list especifica quais propriedades incluir na resposta reduzindo payload quando apenas subset de atributos e necessario, onde validacao de attributeFilters verifica que propriedades filtradas existem no schema da camada e valores sao compativeis com tipos definidos rejeitando filtros invalidos, garantindo suporte a operadores de comparacao em attributeFilters incluindo equals notEquals greaterThan lessThan greaterOrEqual lessOrEqual in notIn startsWith endsWith contains para strings, incluindo possibilidade de combinar multiplos filtros com logica AND e OR atraves de estrutura nested de attributeFilters permitindo consultas complexas como status equals ACTIVE AND area greaterThan 100 OR priority equals HIGH, permitindo ordenacao por multiplos campos simultaneamente atraves de sortBy aceitando valores como area desc comma createdAt asc, onde a implementacao em GEOAPI utiliza QueryBuilder pattern para construir SQL dinamico baseado em filtros aplicados garantindo queries seguras contra SQL injection usando parametrizacao, garantindo que geometrias retornadas estao em sistema de referencia EPSG:4326 WGS84 com possibilidade de reprojecao atraves de parametro srs especificando EPSG code alternativo, incluindo campo computado adicional em cada feature como area calculada em metros quadrados perimetro em metros centroid coordenadas do centroide facilitando analises sem necessidade de calculo client-side, permitindo export direto da listagem filtrada em formatos GeoJSON Shapefile KML CSV atraves de parametro format com streaming de response para datasets grandes evitando timeout, onde response headers incluem metadados agregados como totalArea totalCount averageArea minArea maxArea calculados sobre features filtradas facilitando exibicao de estatisticas sem requisicao adicional, garantindo cache de respostas de listagem com invalidacao baseada em mudancas nas features da camada utilizando ETags e Last-Modified headers para cache condicional, incluindo suporte a clustering onde parametro cluster equals true retorna features agrupadas por proximidade geografica util para visualizacao de grandes datasets com markers agrupados em diferentes niveis de zoom, onde testes unitarios validam construcao de queries dinamicas validacao de filtros aplicacao de simplificacao e calculo de campos computados com datasets mock, garantindo testes de integracao que verificam listagem paginada com filtros espaciais e por atributos queries espaciais usando indices GIST performance de queries com milhares de features e validacao de isolamento de acesso baseado em permissions da camada.

---

**Ultima atualizacao:** 2025-12-30
**Última atualização:** 2026-01-15
**Status do arquivo**: Pronto
