---
modules: [GEOAPI, GEOWEB, GEOGIS]
epic: performance
---

# US-155: Gerenciar Camadas Vetoriais

Como Analista quero listar e criar camadas GIS para que possa organizar dados geoespaciais em layers tematicas separar unidades habitacionais de infraestrutura urbana de areas de risco e configurar estilos de renderizacao customizados por camada, onde o endpoint implementado em GEOAPI expoe a rota /api/layers permitindo operacoes GET para listagem paginada POST para criacao PUT para atualizacao e DELETE para exclusao de camadas vetoriais, garantindo validacao de permissoes baseada em roles onde usuarios com role Analyst ou superior podem listar camadas mas apenas Managers podem criar editar ou excluir, incluindo validacao de dados de entrada onde nome da camada deve ser unico dentro do tenant geometryType deve ser valido POINT LINESTRING POLYGON MULTIPOINT MULTILINESTRING MULTIPOLYGON e schema deve definir propriedades das features com tipos de dados, permitindo filtragem da listagem por communityId para camadas de uma comunidade especifica, geometryType para filtrar por tipo de geometria, visibility para filtrar por PUBLIC PRIVATE RESTRICTED e category para filtrar por tematica CADASTRAL INFRASTRUCTURE RISK ENVIRONMENTAL, onde a resposta da listagem inclui paginacao com page size totalCount e array de objetos Layer contendo id name description geometryType schema style visibility category communityId featuresCount createdAt updatedAt, garantindo rastreabilidade ao requisito funcional RF-127 que especifica gerenciamento de camadas vetoriais customizadas, incluindo relacionamento com entidade Community quando camada e especifica de uma comunidade e relacionamento com entidade Feature onde cada camada agrupa multiplas geometrias tematicas, permitindo que o frontend GEOWEB exiba gerenciador de camadas com lista hierarquica checkbox de visibilidade slider de opacidade configuracao de estilo e botoes de acao criar editar exportar excluir, onde criacao de camada requer payload JSON com propriedades name description geometryType schema objeto JSON Schema definindo propriedades das features como nome tipo color area, style objeto contendo configuracoes de renderizacao como fillColor strokeColor strokeWidth iconUrl markerSize, visibility nivel de visibilidade PUBLIC acessivel a todos PRIVATE apenas criador RESTRICTED lista de usuarios com acesso e category classificacao tematica, garantindo validacao de schema onde sistema verifica que e JSON Schema valido com propriedades tipadas corretamente permitindo apenas tipos suportados string number boolean date geometry, incluindo validacao de estilo onde sistema verifica que cores sao validas em formato hexadecimal strokeWidth e numero positivo e iconUrl aponta para URL acessivel de imagem, permitindo que criacao de camada gere estrutura de tabela dinamica no PostGIS para armazenar features com colunas baseadas em schema definido utilizando extension hstore ou JSONB para propriedades customizadas, onde a implementacao em GEOAPI utiliza schema migration dinamico criando tabela features_layer_{layerId} com colunas id geometry e properties JSONB para flexibilidade, garantindo indices espaciais automaticos onde sistema cria indice GIST na coluna geometry de cada camada criada melhorando performance de queries espaciais, incluindo suporte a estilos avancados onde usuarios podem definir regras de renderizacao condicionais como cor baseada em valor de propriedade tamanho de icone baseado em escala de zoom ou visibilidade baseada em filtro, permitindo clonagem de camadas onde usuario pode duplicar camada existente incluindo schema estilo e opcionalmente features criando nova camada baseada em template, garantindo soft delete de camadas onde registro e marcado como inativo mas estrutura de dados permanece preservando features historicas, incluindo validacao de dependencias onde sistema impede exclusao de camada se outras camadas ou visualizacoes dependem dela retornando erro 409 Conflict com lista de dependencias, permitindo export de camada em formatos GeoJSON Shapefile KML GeoPackage incluindo schema metadata estilo e todas as features, onde import de camadas permite upload de arquivo Shapefile GeoJSON ou GeoPackage com parsing automatico de schema inferencia de tipos de propriedades e preview antes de confirmacao, garantindo controle de versao de schema onde alteracoes em schema de camada existente sao versionadas permitindo rollback e migracao de features para nova versao de schema, onde testes unitarios validam validacao de schema validacao de estilo unicidade de nome e logica de clonagem com datasets mock, garantindo testes de integracao que verificam criacao listagem atualizacao exclusao migracao dinamica de schema e criacao de indices espaciais em banco de dados PostgreSQL com PostGIS.

---

**Ultima atualizacao:** 2025-12-30
**Última atualização:** 2026-01-15
**Status do arquivo**: Review
