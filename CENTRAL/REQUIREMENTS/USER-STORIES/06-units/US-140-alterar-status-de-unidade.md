---
modules: [GEOAPI, GEOWEB]
epic: compatibility
---

# US-140: Alterar Status de Unidade

Como Gerente quero alterar status de uma unidade incluindo transicoes entre DRAFT PENDING APPROVED e REJECTED para que possa gerenciar workflow de aprovacao de cadastro de unidades habitacionais conforme processo de regularizacao fundiaria, onde o endpoint implementado em GEOAPI expoe a rota /api/units/{id}/status com metodo PATCH para atualizar status da unidade, garantindo validacao de permissoes baseada em roles onde usuarios com role Analyst podem submeter unidades alterando de DRAFT para PENDING mas apenas Managers podem aprovar alterando de PENDING para APPROVED ou rejeitar alterando para REJECTED, incluindo tratamento de erros 404 Not Found quando ID da unidade nao existe, 403 Forbidden quando usuario nao possui permissao para transicao especifica e 422 Unprocessable Entity quando transicao de status nao e permitida conforme maquina de estados, permitindo payload JSON com propriedades newStatus valor do novo status, comment comentario obrigatorio explicando motivo da alteracao e attachments array opcional de IDs de documentos anexados como evidencia da decisao, onde validacao de maquina de estados implementa regras de transicao permitindo DRAFT para PENDING, PENDING para APPROVED, PENDING para REJECTED, REJECTED para DRAFT mas impedindo transicoes invalidas como APPROVED diretamente para REJECTED sem passar por PENDING, garantindo rastreabilidade ao requisito funcional RF-069 que especifica workflow de aprovacao de unidades, incluindo validacao de completude cadastral onde sistema impede transicao de DRAFT para PENDING se unidade nao possui geometria titular endereco e documentos minimos obrigatorioes retornando erro 422 com lista de campos faltantes, permitindo que transicao para APPROVED dispare validacoes adicionais incluindo verificacao de sobreposicao geometrica com outras unidades aprovadas da mesma comunidade e validacao de limites dentro do lote ou quadra pai, onde alteracao de status dispara evento de dominio UnitStatusChanged publicado no message bus permitindo workflows downstream como envio de notificacoes ao titular geracao de documentos oficiais e atualizacao de dashboards gerenciais, garantindo registro de auditoria detalhado capturando usuario responsavel timestamp status anterior status novo comentario e attachments para compliance e rastreabilidade de decisoes gerenciais, incluindo notificacao automatica ao analista responsavel pelo cadastro quando unidade for aprovada ou rejeitada via email com comentario do gerente e orientacoes sobre proximos passos, permitindo que o frontend GEOWEB exiba formulario modal com dropdown de status habilitando apenas transicoes validas conforme permissoes do usuario, textarea obrigatoria para comentario e area de upload de documentos comprobatorios, onde a implementacao em GEOAPI utiliza State pattern para encapsular logica de transicoes de status e Strategy pattern para aplicar validacoes especificas de cada transicao garantindo codigo manutentavel e extensivel, garantindo rollback automatico de transacao se qualquer validacao falhar ou evento de dominio nao puder ser publicado preservando consistencia entre estado da unidade e sistemas integrados, incluindo metricas de observabilidade onde sistema registra quantidade de aprovacoes rejeicoes tempo medio de aprovacao e taxa de rejeicao por analista para monitoramento de qualidade do processo, onde testes unitarios validam maquina de estados com tabela de transicoes validas e invalidas validacao de campos obrigatorios e aplicacao de regras de negocio especificas de cada status, garantindo testes de integracao que verificam alteracao de status em banco de dados publicacao de evento de dominio registro de auditoria e envio de notificacoes utilizando infraestrutura real de messaging e email.

---

**Ultima atualizacao:** 2025-12-30
**Última atualização:** 2026-01-15
**Status do arquivo**: Review
