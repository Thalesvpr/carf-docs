---
modules: [GEOAPI, GEOWEB, GEOGIS]
epic: performance
---

# US-136: Obter Geometria de Unidade

Como Analista quero obter geometria geoespacial de uma unidade para que possa exibir poligono no mapa de forma otimizada sem carregar metadados desnecessarios melhorando performance de rendering e reduzindo consumo de banda, onde o endpoint implementado em GEOAPI expoe a rota /api/units/{id}/geometry retornando exclusivamente a geometria GeoJSON da unidade habitacional para uso em camadas vetoriais de mapas web, garantindo validacao de permissoes baseada em roles onde usuarios autenticados podem acessar geometrias de unidades do seu tenant, incluindo tratamento de erro 404 Not Found quando ID da unidade nao existe e 403 Forbidden quando usuario tenta acessar unidade de outro tenant, permitindo resposta leve otimizada para rendering em mapas contendo apenas objeto GeoJSON com type coordinates properties crs e opcionalmente style hints para renderizacao customizada, onde o sistema de referencia espacial CRS retornado e EPSG:4326 WGS84 compativel com bibliotecas de mapa web Leaflet OpenLayers Mapbox GL Google Maps e ArcGIS JavaScript API, garantindo rastreabilidade ao requisito funcional RF-066 que especifica visualizacao de unidades habitacionais em mapa, incluindo suporte a content negotiation onde cliente pode requisitar geometry em formatos alternativos incluindo WKT Well-Known Text WKB Well-Known Binary KML Keyhole Markup Language e TopoJSON atraves de header Accept, permitindo que o frontend GEOWEB utilize este endpoint para carregar geometrias sob demanda quando usuario faz zoom no mapa seleciona unidade ou aplica filtros reduzindo payload inicial da aplicacao e melhorando tempo de first contentful paint, onde a implementacao em GEOAPI projeta query de banco de dados para selecionar apenas coluna geometry da tabela units evitando overhead de carregar todas as propriedades da entidade Unit com seus relacionamentos, garantindo cache agressivo de geometrias no lado servidor usando Redis com estrategia LRU Least Recently Used TTL de 1 hora e invalidacao automatica quando geometria da unidade for atualizada via evento de dominio publicado no message bus, incluindo compressao gzip e brotli da resposta HTTP para reduzir trafego de rede especialmente importante para poligonos complexos com centenas de vertices ou edificacoes com multiplos pavimentos representados como MultiPolygon, permitindo parametro de query simplify com valor numerico de tolerancia em metros para simplificacao topologica do poligono usando algoritmo Douglas-Peucker reduzindo quantidade de vertices de 500 para 50 em niveis de zoom distantes mantendo forma geral reconhecivel, garantindo que simplificacao preserva topologia nao gerando auto-intersecoes poligonos invalidos ou perda de furos internos atraves de validacao pos-simplificacao usando IsValid do NetTopologySuite, incluindo suporte a parametro transform para reprojetar geometria para sistemas de referencia alternativos como UTM zone 23S SIRGAS2000 SAD69 WGS84/Pseudo-Mercator atraves de especificacao de EPSG code utilizando biblioteca ProjNet, permitindo parametro buffer com valor em metros para gerar buffer ao redor da geometria util para analises de proximidade e visualizacao de areas de influencia, onde testes unitarios validam serializacao correta de geometrias incluindo Point Polygon MultiPolygon LineString casos edge como poligonos com furos inner rings e geometrias degeneradas, garantindo testes de integracao que verificam corretude da geometria retornada comparando coordenadas e area calculada com geometria armazenada no banco PostGIS validando que simplificacao reprojecao e buffer nao corrompem dados geoespaciais criticos.

---

**Ultima atualizacao:** 2025-12-30
**Última atualização:** 2026-01-15
**Status do arquivo**: Review
