---
modules: [GEOAPI, GEOWEB]
epic: performance
---

# US-154: Resolver Anotacao

Como Gerente quero marcar anotacao como resolvida para que possa indicar que observacao foi tratada problema foi solucionado conflito cadastral foi regularizado e documentar resolucao para auditoria e rastreabilidade, onde o endpoint implementado em GEOAPI expoe a rota /api/annotations/{id}/resolve com metodo POST para alterar status da anotacao de OPEN ou IN_PROGRESS para RESOLVED, garantindo validacao de permissoes baseada em roles onde apenas usuario assignedTo ou usuarios com role Manager ou superior podem resolver anotacoes, incluindo tratamento de erros 404 Not Found quando ID da anotacao nao existe, 403 Forbidden quando usuario nao possui permissao para resolver e 422 Unprocessable Entity quando anotacao nao esta em status permitido para resolucao, permitindo payload JSON com propriedades resolutionNotes descricao obrigatoria explicando como problema foi resolvido acao tomada ou motivo da resolucao, attachments array opcional de IDs de documentos comprobatorios evidenciando resolucao como fotos apos correcao relatorios ou aprovacoes e notifySubscribers booleano para controlar envio de notificacoes aos usuarios inscritos, onde validacao de conteudo verifica que resolutionNotes nao esta vazio tem tamanho minimo de 20 caracteres descrevendo adequadamente a resolucao rejeitando resolucoes sem justificativa apropriada, garantindo rastreabilidade ao requisito funcional RF-135 que especifica gerenciamento de ciclo de vida de anotacoes, incluindo transicao automatica de status de OPEN ou IN_PROGRESS para RESOLVED com registro de timestamp resolvedAt e usuario responsavel resolvedBy para auditoria, permitindo que resolucao dispare notificacoes automaticas ao usuario createdBy original da anotacao e todos os subscribers via email e push notification incluindo resolutionNotes e link para visualizar anotacao resolvida, onde alteracao de status para RESOLVED torna anotacao read-only impedindo edicao de propriedades principais mas permitindo adicao de comentarios para discussao pos-resolucao, garantindo que anotacoes resolvidas sao removidas de listagens ativas por padrao mas podem ser consultadas atraves de filtro status equals RESOLVED ou includeResolved equals true, incluindo possibilidade de reabrir anotacao resolvida atraves de acao reopen disponivel para usuario createdBy assignedTo ou Manager quando resolucao for contestada ou problema reaparecer retornando status para IN_PROGRESS, permitindo fechamento definitivo de anotacao atraves de acao close disponivel apenas para Managers alterando status de RESOLVED para CLOSED impedindo reabertura e marcando como arquivada permanentemente, onde a implementacao em GEOAPI utiliza State Machine pattern para gerenciar transicoes de status validando que apenas transicoes permitidas sao executadas, garantindo registro de auditoria detalhado capturando usuario responsavel timestamp resolutionNotes attachments e snapshot do estado da anotacao antes da resolucao, incluindo metricas de qualidade onde sistema calcula tempo de resolucao timeToResolve diferenca entre createdAt e resolvedAt para monitorar SLA e performance da equipe, permitindo dashboard de anotacoes resolvidas mostrando total resolvido por periodo tempo medio de resolucao por categoria ranking de usuarios com mais resolucoes e principais tipos de problemas resolvidos, onde evento de dominio AnnotationResolved e publicado no message bus permitindo workflows downstream como atualizacao de dashboards geracao de relatorios e integracao com sistemas externos de ticketing, garantindo que resolucao de anotacao vinculada a elemento cadastral pode disparar atualizacao automatica de status do elemento como marcar unidade para revalidacao apos correcao de sobreposicao, incluindo template de resolutionNotes sugerido conforme categoria da anotacao facilitando preenchimento rapido e padronizado tipo para categoria OVERLAP template Sobreposicao corrigida ajustando geometria da unidade UNIT-XXX conforme levantamento topografico, onde frontend GEOWEB exibe formulario modal de resolucao com textarea para resolutionNotes area de upload de attachments checkbox de notificacao e botao de confirmacao com preview do estado final, garantindo validacao client-side que impede submissao de resolucao sem resolutionNotes preenchido exibindo mensagem de erro clara, onde testes unitarios validam transicoes de status validacao de resolutionNotes calculo de timeToResolve e construcao de evento de dominio com datasets mock, garantindo testes de integracao que verificam fluxo completo de resolucao incluindo alteracao de status registro de auditoria publicacao de evento e envio de notificacoes utilizando infraestrutura real.

---

**Ultima atualizacao:** 2025-12-30
**Última atualização:** 2026-01-15
**Status do arquivo**: Review
