---
modules: [GEOWEB]
epic: security
---

# RNF-016: Autenticação OAuth2

Toda autenticação no sistema GEOMAP5 deve utilizar o protocolo OAuth2 através do servidor de identidade Keycloak, garantindo um mecanismo padronizado, seguro e centralizadamente gerenciado para controle de acesso aos diferentes módulos da plataforma. Este requisito aplica-se a todos os módulos do sistema incluindo GEOAPI, GEOWEB, REURBCAD e GEOGIS, onde cada módulo implementa o fluxo OAuth2 apropriado para seu contexto de uso. Os critérios de aceitação especificam que os módulos GEOWEB e REURBCAD, sendo aplicações com interface de usuário que rodam em ambientes potencialmente não-confiáveis como navegadores web e dispositivos móveis, devem implementar o fluxo Authorization Code com PKCE (Proof Key for Code Exchange), que adiciona uma camada adicional de segurança contra ataques de interceptação do código de autorização ao utilizar um code verifier e code challenge gerados dinamicamente pelo cliente, sendo este o fluxo recomendado pelas melhores práticas atuais de OAuth2 para aplicações públicas. O módulo GEOGIS, sendo uma aplicação servidora ou script que roda em ambiente confiável e não possui interface de usuário interativa, deve utilizar o fluxo Client Credentials que permite autenticação direto entre serviços através de client ID e client secret sem envolvimento de usuário humano, sendo apropriado para integrações máquina-a-máquina e processos automatizados. Adicionalmente, todos os tokens JWT (JSON Web Tokens) emitidos pelo Keycloak devem ser assinados utilizando o algoritmo RS256 (RSA Signature with SHA-256), que utiliza criptografia assimétrica onde tokens são assinados com chave privada pelo servidor de autorização e validados com chave pública pelos resource servers, garantindo que tokens não possam ser forjados e permitindo validação distribuída sem necessidade de comunicação constante com o servidor de autenticação. Este requisito segue rigorosamente os padrões RFC 6749 que define o framework OAuth2 e RFC 7636 que define a extensão PKCE, garantindo interoperabilidade e aderência às melhores práticas de segurança reconhecidas pela indústria. Este requisito é classificado como Must-have porque autenticação adequada é fundamental para segurança do sistema, protegendo dados sensíveis de regularização fundiária e garantindo que apenas usuários devidamente autorizados possam acessar e modificar informações. A implementação deve considerar configuração adequada do Keycloak incluindo realms, clients, roles e mappers apropriados para cada módulo, implementação de bibliotecas OAuth2 certificadas e mantidas ativamente ao invés de implementações customizadas propensas a vulnerabilidades, armazenamento seguro de tokens em clientes web usando memória ou session storage ao invés de local storage para mitigar riscos de XSS, implementação de logout que invalida tokens tanto localmente quanto no servidor de autenticação, e renovação automática de tokens expirados usando refresh tokens para manter sessões ativas sem requerer re-autenticação frequente do usuário.
