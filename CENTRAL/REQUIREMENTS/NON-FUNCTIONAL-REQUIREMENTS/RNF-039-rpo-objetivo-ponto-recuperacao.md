---
modules: [GEOAPI, GEOWEB, REURBCAD, GEOGIS]
epic: performance
---

# RNF-039: RPO (Recovery Point Objective)

O sistema deve manter um Recovery Point Objective (RPO) de no máximo 1 hora, definindo a quantidade máxima aceitável de perda de dados em caso de falha catastrófica, garantindo que alterações feitas ao banco de dados nas últimas 60 minutos possam ser recuperadas através de mecanismos de continuous archiving e replicação. O WAL (Write-Ahead Logging) archiving deve ser habilitado no PostgreSQL, configurando o parâmetro archive_mode como 'on' e archive_command para copiar segmentos WAL para storage durável (S3, GCS ou similar) a cada vez que um segmento de 16MB é preenchido ou a cada minuto através de archive_timeout, garantindo que todas as transações confirmadas sejam preservadas mesmo se o servidor primário falhar antes do próximo backup incremental. A replicação entre servidores pode ser configurada como síncrona ou assíncrona dependendo dos requisitos de performance e disponibilidade, onde replicação síncrona garante que transações só são confirmadas após serem escritas em pelo menos um standby server, oferecendo RPO próximo a zero mas com impacto potencial na latência de escrita, enquanto replicação assíncrona permite melhor performance mas pode resultar em perda de algumas transações recentes se o servidor primário falhar antes da replicação se completar, ainda assim respeitando o limite de 1 hora através do WAL archiving contínuo. A métrica de RPO menor ou igual a 1 hora significa que, no pior cenário de disaster recovery, o sistema seria restaurado para um estado consistente de no máximo 60 minutos antes da falha, utilizando a combinação do último backup base disponível com a aplicação de todos os segmentos WAL arquivados até o momento da falha. Os critérios de aceitação incluem a verificação de que WAL archiving está configurado e funcionando corretamente com archive_timeout de 60 segundos, que segmentos WAL são copiados para storage durável em menos de 5 minutos após serem criados, que existe infraestrutura de replicação (síncrona ou assíncrona) para um servidor standby ou que WAL archiving sozinho garante o RPO de 1 hora, que testes de point-in-time recovery são realizados trimestralmente validando a capacidade de restaurar para qualquer momento nas últimas 24 horas, e que métricas de lag de replicação e idade do último WAL arquivado são monitoradas continuamente com alertas quando excederem thresholds. Este requisito é classificado como should-have pois, embora importante para minimizar perda de dados, o custo e complexidade de implementar RPO muito baixo podem não justificar o benefício para todos os ambientes, sendo essencial principalmente para ambientes de produção de alta criticidade enquanto ambientes de staging e desenvolvimento podem operar com RPOs mais relaxados, permitindo trade-offs entre proteção de dados e custos operacionais de acordo com o contexto de cada deployment.
