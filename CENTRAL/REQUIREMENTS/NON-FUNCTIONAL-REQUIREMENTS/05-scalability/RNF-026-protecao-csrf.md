---
modules: [GEOAPI, GEOWEB, REURBCAD]
epic: scalability
---

# RNF-026: Proteção contra CSRF

Os endpoints de mutação (POST, PUT, PATCH, DELETE) do sistema GEOAPI e formulários do GEOWEB devem implementar proteção robusta contra ataques de Cross-Site Request Forgery (CSRF), impedindo que websites maliciosos realizem ações não autorizadas em nome de usuários autenticados através de requisições forjadas. A implementação deve utilizar padrão de double submit cookie, onde o servidor gera um token CSRF aleatório e criptograficamente seguro que é enviado ao cliente tanto como cookie HTTP quanto como valor separado acessível por JavaScript, sendo que o cliente deve incluir esse token em um header customizado (X-CSRF-Token) em todas as requisições de mutação, permitindo que o servidor valide que ambos os valores coincidem antes de processar a operação. O cookie contendo o token CSRF deve ser configurado com atributo SameSite=Strict ou SameSite=Lax, aproveitando proteções nativas do navegador que impedem envio do cookie em requisições cross-site, oferecendo camada adicional de defesa especialmente em navegadores modernos que suportam esse atributo. Formulários HTML no GEOWEB devem incluir o token CSRF como campo hidden gerado automaticamente por componentes de formulário, garantindo que submissões tradicionais (não-AJAX) também sejam protegidas. A validação do token deve ocorrer em middleware no pipeline de requisições do GEOAPI, rejeitando com código HTTP 403 (Forbidden) qualquer tentativa de mutação que não inclua token válido ou onde os tokens do cookie e header não coincidam. Tokens CSRF devem ter tempo de vida razoável (por exemplo, mesma duração da sessão ou token de acesso) e serem regenerados periodicamente para limitar janela de oportunidade caso um token seja interceptado. A implementação deve considerar que aplicações mobile (REURBCAD) e integrações server-to-server (GEOGIS) não são vulneráveis a CSRF no mesmo modelo que aplicações web, podendo ser isentas dessa validação quando autenticadas via métodos apropriados como Client Credentials OAuth2. Exceções para verificação de CSRF devem ser cuidadosamente documentadas e limitadas apenas a endpoints seguros que não realizam operações sensíveis. Este requisito é classificado como Should-have pois, embora CSRF seja uma vulnerabilidade real, a arquitetura do sistema utilizando APIs REST stateless com tokens JWT e SameSite cookies já oferece proteção significativa, tornando a implementação adicional de tokens CSRF uma medida de defesa em profundidade recomendada mas não absolutamente crítica para lançamento inicial.
