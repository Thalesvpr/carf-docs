---
modules: [GEOAPI, GEOWEB, REURBCAD, GEOGIS]
epic: performance
---

# RNF-024: Auditoria de Ações

O sistema GEOAPI deve manter um registro completo e imutável de todas as ações críticas realizadas por usuários e processos automatizados, armazenando informações detalhadas em logs de auditoria que permitam rastreabilidade total, investigação de incidentes de segurança e conformidade com requisitos regulatórios como a LGPD. Eventos de autenticação, incluindo tentativas de login bem-sucedidas e falhadas com registro de timestamp, endereço IP de origem, user agent e identificador do usuário, devem ser persistidos permitindo detecção de padrões suspeitos como múltiplas tentativas de login falhadas ou acessos de localizações geográficas incomuns. Operações de logout, tanto explícitas quanto por timeout de sessão, devem ser registradas para permitir auditoria de duração de sessões e padrões de uso. Todas as operações de criação, edição e exclusão de dados de domínio, incluindo unidades habitacionais, titulares, comunidades e documentos anexados, devem gerar entradas de auditoria contendo o tipo de operação (CREATE, UPDATE, DELETE), identificador do recurso afetado, valores anteriores e novos para campos modificados (exceto dados sensíveis que devem ser mascarados), usuário responsável pela ação e timestamp preciso com timezone. Mudanças em permissões e roles de usuários, que afetam diretamente a segurança do sistema, devem ser auditadas com detalhes especialmente rigorosos incluindo quem realizou a mudança, qual usuário foi afetado, permissões anteriores e novas, e justificativa quando disponível. A implementação deve utilizar tabela de auditoria append-only no banco de dados PostgreSQL, onde registros nunca são atualizados ou deletados mas apenas inseridos, garantindo imutabilidade dos logs mesmo que um atacante obtenha acesso privilegiado ao banco. Para performance, a gravação de logs de auditoria deve ser assíncrona sempre que possível, utilizando filas de mensagens para não impactar a latência de operações críticas dos usuários. Os logs devem ser estruturados em formato JSON ou campos relacionais bem definidos, permitindo queries eficientes para buscar ações específicas de um usuário, operações em um recurso particular ou eventos em um período de tempo. Retenção de logs deve seguir políticas de compliance, mantendo dados de auditoria por no mínimo 5 anos com arquivamento em storage de menor custo após períodos de acesso frequente. Este requisito é Must-have pois logs de auditoria são essenciais para investigação de incidentes de segurança, demonstração de compliance com LGPD e outras regulamentações, e estabelecimento de accountability das ações dos usuários no sistema.
