---
modules: [GEOAPI, GEOWEB]
epic: reliability
---

# RNF-051: Undo/Redo

O sistema GEOWEB deve implementar mecanismos de confirmação e reversão para ações destrutivas, reduzindo ansiedade dos usuários ao realizar operações que modificam ou deletam dados e permitindo recuperação rápida de erros acidentais sem necessidade de restauração de backups. O modal de confirmação para exclusões deve ser exibido sempre que usuário tentar deletar registros importantes como unidades habitacionais, titulares, comunidades ou documentos, apresentando diálogo que claramente descreve o que será deletado como "Tem certeza que deseja excluir a unidade habitacional #12345 localizada na Rua das Flores, 123?", alertando sobre consequências irreversíveis como "Esta ação não pode ser desfeita. Todos os dados associados serão permanentemente removidos, incluindo X fotos e Y documentos", com botões de ação claramente diferenciados onde botão de confirmar usa cor de destaque (tipicamente vermelho para ações destrutivas) e texto explícito como "Sim, excluir permanentemente" enquanto botão de cancelar é menos proeminente com texto "Não, manter registro", e implementando proteção adicional como requerer digitação de texto de confirmação para exclusões em massa ou de recursos críticos. O toast com opção "Desfazer" para ações reversíveis oferece experiência mais fluída para operações que podem ser revertidas rapidamente, aparecendo imediatamente após ações como mover item para lixeira, arquivar documento, atualizar status de registro ou reordenar elementos, mostrando mensagem como "Unidade movida para lixeira" com botão proeminente "Desfazer" que ao ser clicado reverte a operação antes que seja permanentemente aplicada, com timeout típico de 5-10 segundos durante o qual a operação é mantida em estado pendente e pode ser cancelada, e após timeout a operação é confirmada permanentemente através de requisição ao backend, balanceando usabilidade (permitir undo rápido) com consistência de dados (não manter estados pendentes indefinidamente). O histórico navegável deve ser implementado onde aplicável, particularmente em editores de geometrias ou formulários complexos que passam por múltiplas iterações, mantendo stack de estados anteriores que pode ser navegado via botões "Desfazer" (Ctrl+Z) e "Refazer" (Ctrl+Shift+Z) ou ícones de setas na toolbar, implementado através de padrão Command ou Memento que encapsula cada mudança de estado em objeto serializável, limitando histórico a número razoável de operações (tipicamente 20-50) para evitar consumo excessivo de memória, e limpando histórico ao salvar definitivamente ou sair da tela de edição. As diferentes estratégias devem ser aplicadas conforme criticidade e reversibilidade da operação, onde exclusões permanentes de dados críticos sempre requerem modal de confirmação explícito, operações facilmente reversíveis como mover para lixeira ou mudar status usam toast com undo, e edições incrementais em editores complexos oferecem histórico completo de undo/redo, evitando tanto solicitar confirmação excessiva para operações triviais (causando alert fatigue) quanto permitir ações destrutivas sem salvaguardas. Os critérios de aceitação incluem a exibição de modal de confirmação antes de executar exclusões permanentes de registros importantes com descrição clara da ação e suas consequências, a implementação de toast com botão "Desfazer" para operações reversíveis como mover para lixeira ou arquivar, a disponibilização de funcionalidade de undo/redo via atalhos de teclado (Ctrl+Z / Ctrl+Shift+Z) em editores complexos mantendo pelo menos 20 níveis de histórico, a verificação de que ações destrutivas requerem dois passos (confirmação + execução) prevenindo exclusões acidentais por clique único, e testes de usabilidade confirmando que usuários entendem claramente quais ações são reversíveis e como desfazê-las. Este requisito é should-have por melhorar significativamente confiança e conforto dos usuários ao interagir com o sistema, reduzindo medo de cometer erros irreversíveis e permitindo exploração mais livre da interface, especialmente importante em sistema de cadastro onde erros podem ter consequências sérias mas onde também é razoável que usuários ocasionalmente mudem de ideia ou cometam enganos, embora implementação completa de undo/redo com histórico navegável adicione complexidade de estado que pode não ser justificada para todas as partes do sistema.
