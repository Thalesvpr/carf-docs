---
modules: [GEOAPI, GEOWEB, REURBCAD, GEOGIS]
epic: reliability
---

# RNF-065: Rollback de Deploy

Os deploys dos módulos GEOAPI e GEOWEB devem ser completamente revertíveis em menos de 5 minutos caso sejam identificados problemas críticos na nova versão implantada, garantindo que incidentes causados por deploys defeituosos possam ser rapidamente mitigados restaurando a versão anterior que funcionava corretamente. Esta capacidade de rollback rápido deve ser alcançada através do versionamento adequado de todas as imagens Docker geradas, onde cada build de CI/CD produz uma imagem com tag única correspondente ao commit SHA ou número de versão, e essas imagens são armazenadas em um registry confiável permitindo que qualquer versão histórica possa ser rapidamente recuperada e reimplantada. O orquestrador de containers Kubernetes deve ser utilizado para gerenciar os deployments, mantendo automaticamente histórico de revisões de deployment que podem ser consultadas e revertidas através de comandos simples como kubectl rollout undo, permitindo que a equipe de operações reverta para a versão anterior imediatamente sem necessitar reconstruir imagens ou executar processos complexos de deployment. As migrações de banco de dados devem ser projetadas de forma reversível sempre que possível, incluindo scripts de downgrade que desfazem as mudanças de schema introduzidas pela migração correspondente, garantindo que rollbacks de aplicação possam ser acompanhados de rollbacks de banco de dados quando necessário, embora reconhecendo que algumas migrações envolvendo perda de dados (como remoção de colunas) podem não ser completamente reversíveis e requerem estratégias alternativas como manter dados por período de carência antes de remoção permanente. O processo de deploy deve incluir verificações automáticas de saúde (health checks) que validam se a nova versão está respondendo corretamente antes de direcionar tráfego de produção para ela, e deve implementar estratégias de deployment como rolling updates ou blue-green deployments que permitem reverter mudanças sem downtime perceptível para usuários. Documentação de runbooks deve incluir procedimentos claros e testados para realizar rollbacks, especificando exatamente quais comandos executar, quais verificações fazer antes e depois do rollback, como comunicar o incidente para stakeholders e como investigar a causa raiz do problema que necessitou o rollback. A capacidade de fazer rollback rapidamente reduz drasticamente o risco associado a deploys, permitindo que a equipe implante mudanças com mais confiança, aumenta a disponibilidade do sistema ao minimizar o tempo que problemas afetam usuários, e permite cultura de deploys mais frequentes sabendo que problemas podem ser rapidamente revertidos. Este requisito é classificado como must-have, sendo absolutamente crítico para operação segura do sistema em produção, permitindo que a equipe responda rapidamente a incidentes, minimize impacto em usuários quando problemas ocorrem, e mantenha alta disponibilidade mesmo quando deploys ocasionalmente introduzem defeitos não detectados em ambientes de teste.
