---
modules: [GEOAPI]
epic: security
---

# RNF-034: SQL Injection Prevention

O sistema GEOAPI deve implementar proteção abrangente contra ataques de SQL injection através do uso exclusivo de Object-Relational Mapping (ORM) com Entity Framework Core e prepared statements parametrizadas, eliminando concatenação direta de strings de usuário em comandos SQL que é a causa primária dessa vulnerabilidade crítica. O Entity Framework Core deve ser utilizado como camada de abstração para todas as operações de banco de dados, onde queries são construídas através de LINQ (Language Integrated Query) que o framework traduz automaticamente para SQL parametrizado, garantindo que valores fornecidos por usuários sejam sempre tratados como dados e nunca como código executável. Quando queries dinâmicas ou complexas que não podem ser expressas facilmente através de LINQ forem absolutamente necessárias, o uso de FromSqlRaw ou ExecuteSqlRaw do Entity Framework Core deve seguir rigorosamente padrão de parametrização, onde placeholders como {0}, {1} ou @param são utilizados no SQL string e valores são passados como argumentos separados que o framework automaticamente escapa e parametriza. Consultas a views ou funções de banco de dados customizadas devem igualmente utilizar parâmetros através do mecanismo do ORM, nunca interpolando valores diretamente em strings de SQL. A validação de inputs implementada conforme RNF-020 fornece camada adicional de defesa, onde dados são verificados para conformidade com formatos esperados antes mesmo de chegarem à camada de persistência, rejeitando inputs que contenham caracteres ou padrões suspeitos, embora a parametrização no nível de SQL seja a proteção fundamental que deve funcionar independentemente de validações upstream. Ferramentas de análise estática de código (SAST) devem ser integradas no pipeline de CI/CD para detectar usos potencialmente inseguros de SQL, alertando desenvolvedores sobre concatenações de strings em contextos de query ou uso incorreto de APIs de banco de dados. Testes de segurança automatizados devem incluir payloads de SQL injection comuns nos inputs de API, verificando que o sistema rejeita ou neutraliza adequadamente tentativas de injeção sem executar comandos maliciosos ou revelar estrutura do banco de dados através de mensagens de erro. Logs de erros de banco de dados devem ser cuidadosamente sanitizados antes de serem apresentados a usuários ou gravados em sistemas de logging acessíveis, evitando que mensagens de erro detalhadas do PostgreSQL revelem nomes de tabelas, colunas ou estrutura de schema que auxiliem atacantes em refinar seus ataques. Acesso direto ao banco de dados deve ser restrito através de princípio de menor privilégio, onde a credencial utilizada pela aplicação GEOAPI deve ter apenas permissões necessárias (SELECT, INSERT, UPDATE, DELETE em tabelas específicas) sem permissões administrativas como DROP, CREATE ou ALTER que poderiam ser exploradas em caso de SQL injection bem-sucedida. Este requisito é Must-have pois SQL injection consistentemente aparece no OWASP Top 10 de vulnerabilidades mais críticas, permitindo que atacantes leiam dados sensíveis, modifiquem ou deletem informações, escalem privilégios ou até executem comandos no sistema operacional do servidor de banco de dados em casos severos.
**Última atualização:** 2026-01-15
**Status do arquivo**: Review
