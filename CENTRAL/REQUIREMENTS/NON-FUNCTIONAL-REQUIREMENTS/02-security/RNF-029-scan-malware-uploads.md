---
modules: [GEOAPI]
epic: security
---

# RNF-029: Scan de Malware em Uploads

O sistema GEOAPI deve implementar verificação automática de malware em todos os arquivos recebidos através de endpoints de upload, protegendo tanto a infraestrutura do sistema quanto usuários downstream que possam fazer download desses arquivos, através de integração com engines de antivírus como ClamAV ou serviços comerciais de análise de ameaças. Quando um arquivo é enviado pelo usuário através de interfaces GEOWEB ou REURBCAD, ele deve ser temporariamente armazenado em área de quarentena antes de ser escaneado de forma assíncrona, evitando que o processo de verificação bloqueie a resposta ao usuário mas garantindo que o arquivo não se torne acessível antes de ser validado como seguro. A integração com ClamAV deve ocorrer através de daemon clamd executando como container separado na infraestrutura Kubernetes, onde o GEOAPI envia arquivos para verificação via socket ou API REST, recebendo resultado da análise que indica se o arquivo está limpo, infectado ou suspeito. Arquivos identificados como infectados devem ser imediatamente rejeitados e removidos do sistema, com notificação clara ao usuário que o upload falhou devido a detecção de conteúdo malicioso, sem revelar detalhes técnicos específicos da detecção que possam ajudar atacantes a evitar detecção em tentativas futuras. Arquivos considerados suspeitos mas não definitivamente maliciosos devem ser movidos para quarentena estendida onde podem ser mantidos para análise manual por administradores de segurança, sem serem disponibilizados para download por usuários comuns. Assinaturas de vírus do ClamAV devem ser atualizadas automaticamente através de freshclam executando diariamente, garantindo que o sistema possa detectar ameaças recentemente identificadas pela comunidade de segurança. Para arquivos muito grandes que possam causar timeout durante scanning, o processo deve ser completamente assíncrono com notificação ao usuário quando o scan for completado e o arquivo aprovado ou rejeitado. Logs detalhados de todas as detecções de malware devem ser mantidos incluindo hash do arquivo, usuário que fez upload, timestamp e tipo de ameaça detectada, permitindo análise de padrões de ataque e identificação de usuários ou fontes comprometidas. Este requisito é classificado como Should-have pois, embora proteção contra malware seja importante, validações de tipo MIME, restrições de extensões de arquivo e outras medidas já oferecem proteção básica, tornando scanning antivírus uma camada adicional de defesa recomendada especialmente para sistemas que aceitam uploads de documentos complexos como PDFs que podem conter código executável.
**Última atualização:** 2026-01-15
**Status do arquivo**: Review
