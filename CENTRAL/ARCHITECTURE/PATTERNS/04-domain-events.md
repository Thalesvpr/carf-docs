# Domain Events

Domain Events desacoplam side effects (enviar email, invalidar cache, atualizar read model, integrar sistemas externos) da lógica negócio permitindo adicionar handlers sem modificar aggregates. Events imutáveis record classes (UnitCreatedEvent, HolderLinkedEvent, ApprovalCompletedEvent) contendo dados essenciais (AggregateId, TenantId, OccurredAt, propriedades relevantes), coletados em aggregate root via AddDomainEvent method armazenando lista temporária, e disparados após SaveChanges bem-sucedido garantindo consistência (só dispara se commit funcionou). MediatR.Publish processa handlers assíncronos em paralelo (EmailNotificationHandler, CacheInvalidationHandler, AuditLogHandler, WebhookDispatcherHandler) cada um independente podendo falhar sem afetar outros, retry policy configurado para handlers críticos (3 tentativas exponential backoff), e dead letter queue capturando falhas persistentes para processamento manual posterior. Events vs Integration Events: domain events ficam no processo (in-memory MediatR), integration events publicados no RabbitMQ cruzam bounded contexts (UnitApproved publicado para sistema externo cartório), serialização JSON com schema versionado garantindo backward compatibility, e outbox pattern garante exactly-once delivery (salvar event em tabela transacionalmente, worker polling publica e marca processed). Auditoria automática via GenericAuditHandler logando todos events em audit_log table rastreando who/when/what, compliance LGPD documentando processamento de dados, e troubleshooting facilitado reconstruindo state via event history.

---

**Última atualização:** 2025-12-30
**Status do arquivo**: Pronto
