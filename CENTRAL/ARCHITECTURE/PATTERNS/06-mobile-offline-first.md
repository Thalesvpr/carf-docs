# Mobile Offline-First

Padrões offline-first do REURBCAD React Native garantindo funcionamento sem conectividade e sincronização eventual. Local storage via WatermelonDB (SQLite wrapper) com schema reactive sincronizado com componentes React, queries observáveis reagem automaticamente a mudanças locais, e migrations versionadas evoluindo schema sem perder dados usuário. Sync protocol implementa three-way merge comparando estado local, servidor, e last-synced baseline detectando conflitos (usuário editou unidade offline enquanto outro aprovou no servidor), conflict resolution strategies (server-wins para campos críticos, client-wins para rascunhos, manual merge para geometrias), e watermark-based incremental sync (last_sync_timestamp filtrando apenas mudanças recentes reduzindo payload). Queue system gerencia operações pendentes (criar unidade, editar titular, upload foto) persistidas em sync_queue table marcadas needs_sync=true, retried em ordem FIFO quando conectividade retornar, exponential backoff para falhas transitórias, e manual retry para erros permanentes (validação falhou servidor). Offline detection via NetInfo listener reage a mudanças conectividade, UI feedback mostra badge "Modo Offline" alertando usuário, botões sync manual forçam tentativa, e contador "5 alterações pendentes" motiva sincronizar. Conflict UI exibe diff visual lado-a-lado (versão local vs servidor) com campos conflitantes destacados, permitindo escolher campo-a-campo ou aceitar tudo de uma fonte, e salvando decisão como precedente para conflitos similares futuros. GPS tracking captura posição contínua em background (foreground service Android, background location iOS) armazenando trilha localmente, reduz precisão se bateria baixa, e sincroniza geometrias quando WiFi disponível economizando dados móveis.

---

**Última atualização:** 2025-12-30
**Status do arquivo**: Review
