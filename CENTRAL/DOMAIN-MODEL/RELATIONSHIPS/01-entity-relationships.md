# Entity Relationships

Mapeamento completo de relacionamentos entre entidades do domínio especificando cardinalidades direções navegações e regras de integridade referencial de forma agnóstica a tecnologia. Relacionamentos principais incluem Community 1:N Units onde uma comunidade agrupa múltiplas unidades mas unidade pertence a apenas uma comunidade, relacionamento obrigatório em Unit, deletar Community deve validar ou cascade soft delete Units. Unit N:N Holders via UnitHolder entidade associativa armazenando tipo de vínculo (proprietário cônjuge morador) e percentual de propriedade, relacionamento bidirecional navegável, Unit pode ter múltiplos Holders e Holder pode estar em múltiplas Units, ao menos um vínculo obrigatório antes de aprovar Unit. Community 1:N Blocks hierarquia espacial opcional onde comunidade pode ser subdividida em quadras urbanas, Block pertence a uma Community, relacionamento opcional pode não existir em áreas rurais. Block 1:N Plots onde quadra contém múltiplos lotes individuais, Plot pertence a um Block, relacionamento opcional usado em áreas organizadas. Unit N:1 Plot opcional onde unidade pode estar vinculada a lote específico, relacionamento frequente em áreas urbanas regulares mas ausente em ocupações informais. Unit 1:N Documents polimórfico onde unidade possui anexos de fotos plantas PDFs, Document tem EntityType UNIT e EntityId referenciando Unit.Id, cascade delete Documents ao deletar Unit. Unit 1:N Annotations polimórfico onde unidade tem observações notas issues, Annotation tem EntityType UNIT e EntityId, soft delete preferencial. Holder 1:N Documents polimórfico documentos pessoais RG CPF, EntityType HOLDER. Team N:N Account via TeamMember entidade associativa com Role (LEADER MEMBER) e JoinedAt, relacionamento bidirecional. Community N:N Team OU N:N Account via CommunityAuthorization entidade controle de acesso, Authorization tem TeamId OU AccountId mutuamente exclusivo, campos CanRead CanCreate CanEdit, validação antes de operações em Community ou Units. SurveyPoint N:1 Community pontos topográficos pertencem a comunidade, 1:N SurveyProcessing histórico de processamentos GPS, 1:1 Monograph documentação técnica. LegitimationRequest N:1 Unit solicitação para unidade, 1:N LegitimationResponse pareceres múltiplos ao longo do processo, LegitimationResponse 1:1 LegitimationCertificate certidão emitida após aprovação. DescriptiveMemorial N:1 Unit memorial descritivo, nullable FK CertificateId vinculando a certidão. LegitimationPlan N:1 Unit planta técnica, FKs MemorialId e nullable CertificateId. Todos relacionamentos N:1 obrigatórios devem validar existência de FK antes de criar, relacionamentos opcionais permitem null, cascade delete deve ser cuidadoso usando soft delete quando possível, e navegações bidirecionais devem manter consistência em ambos lados.

---

**Última atualização:** 2025-01-05
**Status do arquivo**: Pronto
