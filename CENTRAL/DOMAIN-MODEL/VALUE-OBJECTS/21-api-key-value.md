# ApiKeyValue (Valor de Chave API)

Value object imutável representando formato e validação de chave API usada para autenticação de integrações externas plugins GIS e automações garantindo que apenas clientes autorizados acessem endpoints protegidos da API REST. Formato conceitual segue padrão prefixado `geoapi_sk_{random}` onde `geoapi` identifica sistema de origem, `sk` indica secret key diferenciando de public keys se existirem, e `{random}` é string aleatória de 32 caracteres alfanuméricos gerados criptograficamente garantindo unicidade global e impossibilidade de adivinhação por força bruta. Caracteres válidos em porção aleatória incluem letras maiúsculas e minúsculas (A-Z a-z) e dígitos (0-9) totalizando 62 caracteres possíveis por posição gerando espaço de busca de 62^32 combinações (aproximadamente 2^190 ou 1.6×10^57 possibilidades) tornado impraticável descobrir chave válida por tentativa e erro mesmo com recursos computacionais massivos. Regras de validação estabelecem que chave completa deve ter exatamente 43 caracteres (10 do prefixo geoapi_sk_ + 1 underscore separador + 32 caracteres aleatórios), deve iniciar obrigatoriamente com prefixo `geoapi_sk_` permitindo identificação rápida de tipo de credencial e origem quando múltiplos sistemas compartilham mesmo ambiente, porção aleatória deve conter apenas caracteres alfanuméricos [A-Za-z0-9] rejeitando símbolos especiais que podem causar problemas em URLs ou headers HTTP, e validação de formato não verifica existência da chave em banco de dados (isso é responsabilidade de camada de autenticação) apenas garante estrutura correta. Geração de nova chave utiliza gerador de números aleatórios criptograficamente seguro (CSPRNG) ao invés de gerador pseudo-aleatório comum garantindo imprevisibilidade e distribuição uniforme de valores, seleciona 32 bytes aleatórios do gerador convertendo para base62 (alfanumérico) produzindo string de 32 caracteres, concatena prefixo `geoapi_sk_` com string aleatória formando chave completa, verifica unicidade consultando banco de dados garantindo que chave gerada não existe (colisão improvável mas verificação defensiva), e retorna ApiKeyValue imutável pronto para armazenamento em ApiKey entity. Armazenamento seguro em banco de dados nunca salva chave em plaintext armazenando apenas hash criptográfico (bcrypt ou argon2 com salt) permitindo verificação de chave fornecida sem expor valor original, chave completa é exibida ao usuário apenas uma vez imediatamente após criação com aviso explícito para copiar e armazenar em local seguro pois não poderá ser recuperada posteriormente, e sistema não implementa funcionalidade de "mostrar chave novamente" forçando regeneração de nova chave se original for perdida garantindo que credenciais comprometidas não podem ser reutilizadas. Uso típico inclui administrador criando nova ApiKey para integração específica (plugin GIS script de automação sistema externo) gerando ApiKeyValue e configurando permissões de acesso, sistema exibindo chave completa em modal de criação com botão "Copiar para clipboard" e aviso "Guarde esta chave em local seguro, não será exibida novamente", usuário copiando chave e armazenando em gerenciador de senhas ou arquivo de configuração da integração, cliente externo incluindo chave em header HTTP (Authorization: Bearer geoapi_sk_abc123...) ou query parameter (?api_key=geoapi_sk_abc123...) em requisições à API, servidor extraindo chave do header/parameter parseando formato validando estrutura e consultando hash em banco de dados para autenticar requisição, e bloqueando requisição imediatamente se chave não segue formato esperado economizando consulta desnecessária ao banco. Sistema pode implementar rotação automática de chaves alertando usuário quando chave tem mais de 90 dias sugerindo regeneração preventiva reduzindo janela de exposição se chave foi comprometida sem conhecimento, rate limiting mais rigoroso para requisições autenticadas por API key comparado com OAuth2 humano (1000 req/min para usuário interativo vs 10000 req/min para API key de sistema confiável) permitindo throughput maior para automações, e logging detalhado de uso de API keys rastreando quantas requisições cada chave faz por endpoint facilitando auditoria de acesso e detecção de uso anômalo indicando possível comprometimento. Revogação de chave marca ApiKey como inactive em banco de dados fazendo hash da chave revogada falhar em autenticação futura, sistema pode manter lista de "chaves queimadas" (revogadas recentemente) em cache de memória acelerando rejeição de tentativas com chaves conhecidamente inválidas sem consulta ao banco, e notificação automática por email quando chave é revogada alertando proprietário caso revogação tenha sido acidental ou maliciosa permitindo ação corretiva imediata.

**Módulos:** GEOAPI, GEOWEB, REURBCAD, GEOGIS

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Pronto
