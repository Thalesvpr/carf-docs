# EntityType (Tipo de Entidade para Polimorfismo)

Value object enum representando tipo de entidade do sistema usado em relacionamentos polimórficos permitindo que Document e Annotation se vinculem a qualquer entidade sem criar tabelas junction específicas para cada tipo. Valores possíveis incluem UNIT representando unidade habitacional, HOLDER representando titular pessoa física, COMMUNITY representando comunidade ou assentamento, BLOCK representando quadra urbana, PLOT representando lote individual, LEGITIMATION_REQUEST representando processo de legitimação fundiária, LEGITIMATION_RESPONSE representando parecer técnico ou jurídico, LEGITIMATION_CERTIFICATE representando certidão oficial emitida, SURVEY_POINT representando ponto topográfico GPS coletado, SURVEYOR representando topógrafo profissional cadastrado, WMS_SERVER representando servidor de mapas WMS configurado, TEAM representando equipe de trabalho, e potencialmente outros tipos conforme sistema evolui sem quebrar estrutura existente. Regras de uso estabelecem que em Document entity_type indica qual tipo de entidade possui aquele documento (se UNIT então entity_id referencia Unit.id, se HOLDER então entity_id referencia Holder.id), em Annotation entity_type indica qual entidade está sendo anotada seguindo mesma lógica de referência polimórfica, constraint de banco de dados pode validar combinação válida de entity_type com entity_id usando triggers ou validações aplicativas (impedir entity_type=UNIT com entity_id que não existe na tabela units), e adicionar novo tipo requer apenas estender enum sem modificar schema de banco ou estrutura de tabelas existentes (extensibilidade). Validação em camada de aplicação verifica que entity_id corresponde a registro existente do tipo especificado antes de criar Document ou Annotation prevenindo referências órfãs, queries para buscar todos documentos de uma entidade filtram por entity_type e entity_id retornando lista polimórfica independente de tipo, e serialização JSON inclui entity_type facilitando desserialização no frontend que pode rotear para componente apropriado conforme tipo (documentos de Unit exibidos diferente de documentos de LegitimationRequest). Alternativa a polimorfismo seria criar tabelas junction separadas (UnitDocument, HolderDocument, etc) mas isso gera explosão de tabelas e duplicação de lógica, abordagem polimórfica centraliza Document em tabela única com type discriminator simplificando queries de auditoria (listar todos uploads de usuário X independente de entidade) e gestão de storage (quota única de documentos por tenant sem segmentar por tipo de entidade). Sistema suporta adição de novos tipos sem migração de dados apenas estendendo enum e atualizando validações, tipos removidos ou deprecados podem ser mantidos no enum para compatibilidade com dados históricos mas bloqueados em novas criações via validação de negócio, e nomenclatura segue padrão SCREAMING_SNAKE_CASE alinhado com convenções de enums em múltiplas linguagens facilitando mapeamento cross-platform. Futuramente sistema pode ter metadados por tipo definindo comportamentos específicos (tipos que permitem múltiplos documentos vs tipos que permitem apenas um, tipos que requerem aprovação de upload vs tipos de livre anexação, tipos que expiram documentos automaticamente após período) armazenados em configuração ou tabela auxiliar referenciada por EntityType.

**Módulos:** GEOAPI, GEOWEB, REURBCAD, GEOGIS

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Pronto
