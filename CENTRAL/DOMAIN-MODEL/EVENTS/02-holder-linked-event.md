# HolderLinkedEvent

Domain event emitido por Unit aggregate root quando titular pessoa física é vinculado a unidade habitacional através de relacionamento UnitHolder representando fato que ownership ou ocupação foi estabelecida permitindo rastreamento de vínculos e notificação de partes envolvidas no processo de regularização. Payload do evento contém identificador da unidade ao qual holder foi vinculado, identificador do holder titular vinculado, tipo de relacionamento estabelecido (PROPRIETARIO CONJUGE MORADOR HERDEIRO etc) especificando natureza jurídica do vínculo, percentual de propriedade atribuído ao holder útil para calcular direitos de cada titular, flag indicando se holder é titular primário principal responsável pela unidade, identificador do tenant para isolamento multi-tenant, identificador do Account que executou vinculação rastreando responsabilidade administrativa, e timestamp UTC quando vinculação ocorreu para ordenação cronológica de mudanças de titularidade. Event handlers subscribers processam evento executando side effects desacoplados como enviar notificação ao holder informando que foi vinculado a unidade com link para visualizar detalhes, atualizar índices de busca permitindo localizar unidades por CPF de titular facilitando queries, invalidar cache de listagem de holders da unidade e de unidades do holder forçando refresh bidirecional, registrar em audit trail completo de mudanças de titularidade para compliance legal especialmente importante em processos de legitimação fundiária, validar assincronamente se soma de percentuais de propriedade não excede 100% disparando alerta se regra violada, verificar duplicação de CPF em múltiplas unidades sinalizando possível inconsistência que requer revisão manual, e disparar workflow de validação de documentos do holder caso ainda não tenha documentação completa anexada. Motivação do evento permite agregados Unit e Holder manterem-se desacoplados onde vinculação não requer carregar entidade Holder completa apenas referenciar por ID, facilita rastreabilidade de histórico de titularidade onde todos vínculos passados são preservados em event store mesmo após desvínculo posterior, habilita eventual consistency onde estatísticas de holders por comunidade ou município são recalculadas assincronamente sem bloquear operação principal, e suporta integrações externas onde sistemas de cartório ou registro de imóveis são notificados sobre novos vínculos estabelecidos. Regras de processamento estabelecem que evento é despachado após SaveChanges garantindo que UnitHolder foi realmente persistido, handlers podem consultar Unit e Holder via repositories para obter dados completos se necessário mas evento carrega dados essenciais, falha em handler de notificação não reverte vinculação mas registra erro para retry posterior, e processamento idempotente previne duplicação de side effects caso evento seja reprocessado em cenário de retry.

**Implementações por projeto:**
- Backend .NET: `PROJECTS/GEOAPI/LAYERS/DOMAIN/EVENTS/holder-linked-event.cs`
- Frontend React: Não se aplica (eventos backend)
- Mobile React Native: Sync queue conceito similar
- Plugin GIS: Não se aplica

---

**Última atualização:** 2025-01-06
