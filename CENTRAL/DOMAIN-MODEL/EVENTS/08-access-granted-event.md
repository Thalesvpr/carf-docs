# AccessGrantedEvent

Domain event emitido por Community aggregate root quando nova CommunityAuthorization é concedida a Team ou Account individual representando fato que permissão de acesso foi estabelecida permitindo usuários ou equipes visualizarem editarem ou gerenciarem comunidade específica e controlando escopo de sincronização offline em aplicação mobile. Payload do evento contém identificador da comunidade para qual acesso foi concedido, identificador de CommunityAuthorization entity criada referenciando autorização completa, identificador de Team que recebeu acesso se autorização é coletiva permitindo todos membros da equipe acessarem comunidade, identificador de Account que recebeu acesso se autorização é individual concedendo permissão específica a usuário, flags de permissões concedidas (can_read can_create can_edit can_delete) especificando granularidade de acesso, identificador do Account que concedeu acesso rastreando quem tem autoridade de gerenciar permissões, identificador do tenant para isolamento multi-tenant em handlers, e timestamp UTC quando acesso foi concedido para auditoria de mudanças de permissão. Event handlers subscribers processam evento executando side effects como enviar notificação ao Account ou membros de Team informando que nova comunidade foi atribuída com link direto para visualização no mapa, invalidar cache de listagem de comunidades acessíveis forçando refresh de queries que determinam quais comunidades usuário pode ver, atualizar configuração de sincronização offline no mobile adicionando comunidade ao escopo de sync permitindo field agents baixarem dados localmente, registrar em audit trail concessão de acesso para compliance e rastreabilidade especialmente importante para segregação de dados por município ou região, incrementar contador de membros com acesso em dashboard de gestão de equipes atualizando métricas de distribuição de trabalho, disparar recalculo de estatísticas de cobertura geográfica por equipe agregando áreas de todas comunidades atribuídas, validar assincronamente que Account ou Team possui role adequado para permissões concedidas detectando configuração inconsistente onde FIELD_AGENT recebe can_delete quando deveria ter apenas can_create can_edit, e disparar webhook para sistemas externos integrados notificando sobre nova atribuição de área de trabalho para sincronização de responsabilidades. Motivação do evento permite multi-tenancy onde diferentes equipes trabalham em diferentes comunidades com isolamento completo de dados mesmo compartilhando mesma infraestrutura, facilita controle de acesso dinâmico onde gestor pode atribuir e revogar acesso sem modificar código ou configuração de aplicação, habilita sincronização offline seletiva onde mobile baixa apenas comunidades autorizadas economizando espaço de armazenamento local e bandwidth, e suporta auditoria de segurança rastreando quem concedeu acesso a quem e quando permitindo investigação de vazamento de dados ou acesso não autorizado. Regras de processamento estabelecem que evento é despachado após SaveChanges garantindo que CommunityAuthorization foi persistida com validação de constraints (OU team_id OU account_id não ambos), handlers podem consultar Team ou Account via repository para obter lista completa de membros afetados se necessário para notificações, falha em handler de notificação não reverte concessão de acesso mas registra warning para retry posterior garantindo entrega eventual, e idempotência é requerida pois mesmo AccessGranted pode ser processado múltiplas vezes em cenário de retry exigindo deduplicação por authorization_id em handlers de invalidação de cache.

**Módulos:** GEOAPI, GEOWEB, REURBCAD, GEOGIS

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Review
