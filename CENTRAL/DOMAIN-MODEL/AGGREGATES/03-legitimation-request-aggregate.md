# LegitimationRequest Aggregate

Aggregate pattern do Domain-Driven Design estabelecendo LegitimationRequest como aggregate root controlando boundaries de consistência e enforcement de invariantes para processo completo de legitimação fundiária conforme Lei 13465/2017 coordenando múltiplas entities e value objects relacionados a solicitação análise e emissão de certidão de regularização. Aggregate boundary inclui LegitimationRequest como root representando processo principal, LegitimationResponses pareceres técnicos e jurídicos formando trail de decisão, LegitimationCertificate certidão oficial emitida ao aprovar processo, DescriptiveMemorial memorial descritivo técnico com coordenadas e descrição de perímetro, LegitimationPlan planta técnica gráfica mostrando imóvel, Contestations objeções de terceiros durante período de publicidade, Documents anexos polimórficos vinculados ao processo (fotos comprovantes plantas laudos), e Annotations anotações ou issues rastreando pendências, onde todas operações que modificam entities dentro do boundary devem passar pelo aggregate root garantindo transição válida de status workflow e validação de requisitos legais e técnicos. Invariantes fundamentais estabelecem que LegitimationRequest não pode ser aprovado sem documentação obrigatória completa validando presença de memorial descritivo planta técnica documentos do titular e fotos do imóvel conforme modalidade REURB-S ou REURB-E, status do processo deve seguir workflow de 11 estados com transições válidas impedindo saltos inválidos (não pode ir direto de DRAFT para APPROVED sem passar por análises), não pode emitir LegitimationCertificate antes de processo estar em status APPROVED garantindo que apenas processos aprovados geram certidões, Contestations recebidas durante CONTESTATION_PERIOD devem ser resolvidas antes de aprovar processo exigindo LegitimationResponse para cada contestação com Decision justificada, prazo de 120 dias desde SUBMITTED não pode ser ultrapassado sem justificativa formal rastreando atrasos e compliance com Lei 13465/2017, requester_cpf quando pessoa física deve ser válido conforme algoritmo de validação de CPF, modalidade REURB-S (interesse social) não pode cobrar taxa validando gratuidade conforme lei, área do imóvel deve respeitar limites da modalidade (≤250sqm para REURB-S ≤500sqm para REURB-E) conforme definido em legislação, e LegitimationRequest deletado deve manter registro em auditoria para rastreabilidade mesmo após soft delete. Operations expostas pelo aggregate incluem SubmitRequest transicionando de DRAFT para SUBMITTED validando documentação obrigatória e criando protocolo único, AssignAnalyst atribuindo Account responsável por análise validando role adequado (ANALYST ou superior), AddResponse criando LegitimationResponse vinculado ao processo com response_type justification e decision atualizando status do processo conforme decision (APPROVED avança NEEDS_CORRECTION retorna para correções REJECTED finaliza), ApproveRequest transicionando para APPROVED após validar que todas análises foram concluídas favoravelmente e contestações resolvidas, RejectRequest transicionando para REJECTED com justificativa obrigatória impedindo reversão sem intervenção administrativa, IssueCertificate criando LegitimationCertificate vinculado ao processo aprovado gerando número único de certidão e data de emissão, AddContestation durante CONTESTATION_PERIOD criando Contestation submetida por terceiro com fundamentação legal, ResolveContestation criando LegitimationResponse específica para contestação com Decision (UPHELD mantém objeção REJECTED rejeita objeção PARTIALLY_UPHELD aceita parcialmente) influenciando aprovação final, RequestCorrections retornando processo para NEEDS_CORRECTION com lista de pendências a serem sanadas pelo requerente, ExtendDeadline estendendo prazo de 120 dias com justificativa registrada em Annotation rastreando motivos de atraso, AttachDocument adicionando Document ao processo validando tipo apropriado para estágio atual do workflow, e ArchiveRequest marcando processo finalizado (aprovado ou rejeitado) como arquivado após registro em cartório. Domain events emitidos pelo aggregate notificam outras partes do sistema incluindo RequestSubmittedEvent disparado ao submeter processo notificando analistas de novo trabalho disponível e iniciando contagem de prazo de 120 dias, ResponseAddedEvent disparado ao adicionar parecer técnico atualizando dashboards de progresso e notificando gestores de decisões importantes, RequestApprovedEvent disparado ao aprovar processo permitindo geração de relatórios de aprovações e atualização de estatísticas consolidadas, CertificateIssuedEvent disparado ao emitir certidão notificando requerente via email ou SMS e registrando marco importante do processo, ContestationReceivedEvent disparado ao receber objeção de terceiro notificando analista responsável e pausando workflow até resolução, DeadlineApproachingEvent disparado quando faltam 15 dias para prazo de 120 dias alertando gestores sobre risco de descumprimento legal, RequestRejectedEvent disparado ao rejeitar processo notificando requerente com justificativa e encerrando workflow, e CorrectionRequestedEvent disparado ao solicitar correções notificando requerente com lista detalhada de pendências e permitindo resubmissão. Consistency boundaries garantem que transições de status mudanças em documentação e emissão de certidão dentro do mesmo aggregate são transacionais e atômicas onde aprovar processo criar certidão e atualizar status ocorrem em transação única garantindo que falha reverte todas operações preservando consistência, queries para Unit vinculada ao processo não requerem transação do aggregate pois Unit pertence a aggregate separado (Unit Aggregate) mantendo boundaries desacoplados mas referência via unit_id permite navegação, e validações complexas como verificar sobreposição de área reivindicada com outras units ou áreas públicas são executadas antes de aprovar garantindo compliance legal. Aggregate root LegitimationRequest expõe apenas operações que preservam invariantes e transições válidas de workflow encapsulando regras complexas da Lei 13465/2017 e prevenindo estados inconsistentes, coordena validações que envolvem múltiplas entities como verificar que DescriptiveMemorial e LegitimationPlan são consistentes em área e perímetro, serve como ponto de entrada único para modificações garantindo auditoria completa através de LegitimationResponses que formam timeline de decisões, e implementa lógica de negócio complexa como cálculo de prazo considerando dias úteis feriados e suspensões justificadas mantendo compliance com legislação. Motivação para aggregate boundary escolhido baseia-se em coesão funcional onde todos components representam partes de processo único de legitimação com forte acoplamento temporal e lógico, transactional consistency onde decisões aprovações e emissão de certidão devem ser atômicas para garantir validade legal do processo, bounded context onde legitimação é domínio separado de cadastro de units permitindo evoluir regras de workflow independentemente de outras partes do sistema, e auditability onde aggregate preserva histórico completo de decisões através de LegitimationResponses imutáveis permitindo reconstruir estado do processo em qualquer momento passado para compliance legal e defesa em recursos ou contestações judiciais.

**Módulos:** GEOAPI, GEOWEB, REURBCAD, GEOGIS

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Review
