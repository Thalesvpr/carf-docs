# Document (Anexo Polimórfico)

Entidade polimórfica representando arquivo anexado a qualquer entidade do sistema (Unit Holder Community LegitimationRequest etc) armazenando metadados do arquivo sem conteúdo binário permitindo rastreabilidade e gestão de documentos. Campos conceituais incluem identificador único global, entity_type enum indicando tipo da entidade pai (UNIT HOLDER COMMUNITY LEGITIMATION_REQUEST SURVEY_POINT etc) permitindo relacionamento polimórfico, entity_id identificador da entidade específica à qual documento pertence, document_type enum classificando tipo do documento (PHOTO_FRONT PHOTO_BACK PHOTO_INTERIOR DOC_CPF DOC_RG DOC_MARRIAGE_CERTIFICATE PLANT_DWG PLANT_PDF MEMORIAL_DESCRITIVO CERTIDAO_LEGITIMACAO etc) definindo propósito e requisitos, file_name nome original do arquivo preservado para download com nome reconhecível, file_size_bytes tamanho em bytes para validação de quota e exibição, mime_type tipo MIME do arquivo (image/jpeg application/pdf application/dwg) validado no upload para segurança, storage_path caminho interno onde arquivo está armazenado em sistema de arquivos ou storage em nuvem (não exposto ao usuário final), sha256_hash hash criptográfico do conteúdo do arquivo prevenindo duplicações e garantindo integridade, uploaded_by_account_id referenciando usuário que fez upload para auditoria e responsabilização, uploaded_at timestamp de upload, e opcionalmente thumbnail_path para pré-visualização de imagens. Relacionamentos são polimórficos conectando via entity_type + entity_id a múltiplas entidades diferentes (Unit 1:N Documents, Holder 1:N Documents, Community 1:N Documents, etc), e relaciona-se com Account através de uploaded_by rastreando quem anexou documento. Regras de negócio estabelecem que tamanho máximo de arquivo é validado no upload (configurável por tenant, tipicamente 10MB para fotos e 50MB para plantas técnicas), mime_type deve estar em lista permitida evitando upload de executáveis ou scripts maliciosos (aceita image/* application/pdf application/dwg text/plain), document_type define obrigatoriedade por contexto (LegitimationRequest em modalidade REURB-S requer DOC_CPF de todos holders, CERTIDAO_LEGITIMACAO é gerada pelo sistema e anexada automaticamente), hash SHA256 é calculado no upload e verificado no download detectando corrupção ou modificação não autorizada, duplicação é prevenida checando se hash já existe para mesma entidade (permite mesmo arquivo em entidades diferentes mas avisa se usuário tenta anexar arquivo idêntico duas vezes), storage_path nunca é exposto via API (downloads usam presigned URLs temporárias com expiração de 15 minutos garantindo segurança), e soft delete é obrigatório pois exclusão física de documentos legais viola requisitos de auditoria e LGPD (arquivos podem ser marcados como deletados mas permanecem no storage para recuperação se necessário). Workflow típico de upload inicia com usuário selecionando arquivo em interface, validação client-side de tamanho e tipo, envio via multipart/form-data para endpoint dedicado, backend valida novamente mime_type e tamanho, calcula hash SHA256 verificando duplicação, move arquivo para storage definitivo gerando storage_path único, cria registro Document com metadados, e retorna ao cliente ID do documento criado. Download inicia com requisição ao endpoint incluindo document_id, backend verifica permissões do usuário para acessar entidade pai (se usuário pode ver Unit, pode baixar seus Documents), gera URL temporária assinada (presigned URL) com expiração de 15 minutos, retorna URL ao cliente, e cliente baixa arquivo diretamente do storage via URL temporária. Sistema suporta tipos especializados como DOC_CPF requerendo validação adicional (arquivo PDF deve ser legível, imagem deve ter resolução mínima), PLANT_DWG aceito apenas para usuários com role SURVEYOR ou superior, e PHOTO_* gerando thumbnails automaticamente via processamento assíncrono para exibição em galerias. Compliance LGPD exige que dados sensíveis em documentos (CPF RG) sejam protegidos com criptografia em repouso, acessos sejam logados em AuditLog, e titular possa solicitar exclusão via direito de portabilidade (soft delete + remoção do storage após período de retenção legal).

**Módulos:** GEOAPI, GEOWEB, REURBCAD, GEOGIS

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Review
