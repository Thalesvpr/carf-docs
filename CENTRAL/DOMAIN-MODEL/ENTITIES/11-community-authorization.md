# CommunityAuthorization (Autorização de Acesso à Comunidade)

Entidade representando permissão granular de acesso a uma comunidade específica concedida a uma equipe ou usuário individual controlando operações permitidas (leitura criação edição exclusão). Campos conceituais incluem identificador único global, community_id referenciando comunidade sendo autorizada, team_id nullable referenciando equipe autorizada (se autorização é para equipe inteira), account_id nullable referenciando usuário individual autorizado (se autorização é pessoal e não via equipe), flags booleanos de permissão can_read permitindo visualizar dados da comunidade, can_create permitindo cadastrar novas unidades e holders, can_edit permitindo modificar registros existentes, can_delete permitindo exclusão lógica de registros, data de criação para auditoria, e metadados de quem concedeu autorização (granted_by_account_id) rastreando responsável. Relacionamentos incluem referencia obrigatoriamente uma Community (N:1 definindo qual comunidade está sendo autorizada), referencia opcionalmente uma Team (N:1 quando autorização é para equipe inteira), referencia opcionalmente um Account (N:1 quando autorização é individual), e possui constraint garantindo que exatamente um de team_id ou account_id está preenchido (não ambos nem nenhum, validação CHECK (team_id IS NOT NULL AND account_id IS NULL) OR (team_id IS NULL AND account_id IS NOT NULL)). Regras de negócio estabelecem que autorização via team_id concede permissões a todos os membros da equipe automaticamente (herança de permissões), autorização via account_id é individual e sobrescreve ou complementa permissões de equipe (permitindo exceções como "este usuário específico pode deletar mesmo que sua equipe não possa"), sistema valida permissões antes de cada operação CRUD verificando se usuário tem can_read antes de retornar dados e can_edit antes de permitir modificação, mobile offline sync baixa apenas comunidades onde usuário tem can_read=true (via equipes ou autorizações individuais) reduzindo volume de dados sincronizados, flags de permissão permitem controle fino onde usuário pode ler mas não editar (analista revisor) ou criar mas não deletar (field agent), e remoção de CommunityAuthorization revoga acesso imediatamente (próxima requisição falhará com erro de permissão). Workflow típico inicia com MANAGER ou ADMIN atribuindo comunidade a uma equipe criando CommunityAuthorization com team_id e definindo flags de permissão conforme responsabilidades da equipe (equipe de campo geralmente can_read can_create can_edit, equipe de análise can_read can_edit), membros da equipe herdam acesso automaticamente e podem começar trabalho, opcionalmente ADMIN cria autorização individual via account_id para casos especiais (topógrafo externo contratado temporariamente precisa acesso específico sem integrar equipe permanente), e field agents sincronizam mobile recebendo apenas comunidades autorizadas. Sistema suporta revogação de acesso deletando CommunityAuthorization (soft delete opcional para auditoria), modificação de permissões atualizando flags can_* sem recriar registro, e queries complexas calculando permissões efetivas de usuário considerando autorizações via equipes e individuais (união de permissões, can_edit=true se qualquer autorização concede).

**Módulos:** GEOAPI, GEOWEB, REURBCAD, GEOGIS

---

**Última atualização:** 2026-01-10
