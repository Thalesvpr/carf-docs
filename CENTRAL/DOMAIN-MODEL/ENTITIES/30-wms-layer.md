# WmsLayer (Camada WMS Individual)

Entidade representando camada individual de mapa servida por WmsServer configurada para exibição em interfaces GIS com controles de opacidade ordem de renderização e permissões de visualização. Campos conceituais incluem identificador único global, wms_server_id referenciando servidor WMS que contém esta camada, layer_name identificador técnico da camada exatamente como aparece em GetCapabilities do servidor (exemplo: ortofoto_comunidade_abc_2024 ou satellite_planetscope_202501), display_name nome amigável exibido em interfaces para usuários não técnicos (Ortofoto Drone Comunidade ABC Janeiro 2024), opacity valor decimal de 0.0 (transparente) a 1.0 (opaco) controlando transparência da camada permitindo ver layers abaixo, z_index inteiro definindo ordem de empilhamento onde valores maiores são renderizados acima (z_index 100 para ortofoto de base, 200 para camadas vetoriais, 300 para annotations), visible_by_default booleano indicando se camada deve estar visível ao abrir mapa ou oculta requerendo ativação manual via toggle, visible_to_roles JSON array de roles permitidos a visualizar esta camada implementando controle de acesso granular (camada sensível visível apenas para ADMIN e MANAGER, camada pública visível para todos), bbox_json bounding box da camada em formato JSON contendo coordenadas min/max definindo extensão geográfica (usado para zoom automático e validação de que camada cobre área de interesse), srs array de sistemas de referência de coordenadas suportados pela camada (EPSG:4326 WGS84, EPSG:3857 Web Mercator, EPSG:31983 SIRGAS2000 UTM23S), attribution texto de crédito obrigatório a ser exibido conforme licença da camada (© Empresa Topografia XYZ 2024, Imagery © Planet Labs), e metadados de configuração. Relacionamentos incluem pertence a WmsServer (N:1), pode estar associada a Community específica via configuração indicando que layer é ortofoto daquela comunidade (N:1 opcional), e indiretamente é consumida por analistas e field agents visualizando mapas. Regras de negócio estabelecem que layer_name deve existir em capabilities do WmsServer validado comparando com capabilities_cache (sistema alerta se layer configurada não está mais disponível em servidor), visible_to_roles vazio ou NULL significa visível para todos os roles sem restrição, validação de permissão verifica role do usuário autenticado contra visible_to_roles antes de incluir layer em GetMap request (layer restrita a ADMIN não é carregada para FIELD_AGENT protegendo dados sensíveis), z_index controla ordem de renderização onde layers de base (ortofotos mapas base) têm índices baixos e overlays (boundaries annotations) têm índices altos garantindo visualização correta, opacity permite combinar múltiplas layers criando composições visuais (ortofoto 100% opaca como base, mapa de zoneamento 50% opaco sobreposto permitindo ver ambos), e bbox_json otimiza carregamento validando que camada intersecta área visível do mapa antes de fazer request (skip layers que estão completamente fora da viewport economizando bandwidth). Workflow típico de configuração inicia após ADMIN cadastrar WmsServer e executar GetCapabilities descobrindo layers disponíveis, ADMIN seleciona layer relevante (ortofoto recente da área de atuação) e cria WmsLayer preenchendo layer_name exatamente conforme capabilities, define display_name amigável para exibição em interface (Ortofoto Drone - Comunidade ABC - Jan/2024), configura opacity inicial (1.0 para ortofoto de base totalmente opaca), define z_index baixo (10 ou 100) para renderizar como background, marca visible_by_default true para layer aparecer automaticamente, opcionalmente restringe visible_to_roles se layer contém dados sensíveis, e salva configuração tornando layer disponível para uso. Usuários vendo mapa no frontend ou plugin GIS sistema carrega WmsLayer ativas aplicando filtros de role (se usuário é FIELD_AGENT skip layers restritas a MANAGER), ordena layers por z_index crescente para definir ordem de renderização, constrói URL de GetMap para cada layer incluindo layer_name bbox width height format e srs apropriados, aplica opacity configurada ao renderizar tiles recebidos, e exibe controles de layer (toggle visibilidade, slider de opacity) permitindo usuário customizar visualização conforme necessidade. Associação de WmsLayer a Community específica permite filtros inteligentes onde ao abrir Community X sistema automaticamente ativa WmsLayer de ortofoto daquela community e desativa layers de outras communities reduzindo clutter visual, zoom automático ajusta viewport para bbox da WmsLayer associada garantindo que ortofoto relevante está visível, e validação de cobertura alerta se Community não tem WmsLayer associada sugerindo que ortofoto seja configurada para melhorar qualidade de validação. Sistema suporta múltiplas WmsLayers ativas simultaneamente permitindo comparações (ortofoto de 2023 vs 2024 para detectar mudanças, imagem de satélite vs ortofoto drone para validar acurácia), blending de layers com opacidade ajustável cria composições úteis para análise (ortofoto 70% opaca sobreposta a mapa cadastral 30% opaco revela discrepâncias entre geometrias cadastradas e realidade física), e atualização de layer (nova ortofoto substitui antiga) é simples mudando layer_name ou criando nova WmsLayer marcando antiga como visible_by_default false preservando histórico.

**Módulos:** GEOAPI (backend), GEOWEB (renderização mapas)

---

**Última atualização:** 2026-01-10
