# BaseAggregateRoot (Raiz de Agregado Base)

Classe base abstrata conceitual que aggregate roots herdam estendendo BaseEntity e adicionando suporte a domain events permitindo entidades coordenarem agregados e emitirem eventos de negócio significativos. Herda todos campos de BaseEntity (identificador timestamps versão) adicionando coleção privada de domain events acumulados durante execução de métodos de negócio. Comportamentos incluem método protegido AddDomainEvent registrando evento na coleção interna sem disparar imediatamente permitindo agregado acumular múltiplos eventos durante operação complexa, método público GetDomainEvents retornando coleção readonly de eventos para consumo por infraestrutura após persistência, método ClearDomainEvents limpando coleção após events serem despachados evitando redispatch em SaveChanges subsequente, e separação clara entre lógica de negócio que registra eventos e infraestrutura que despacha garantindo domain layer não depende de mecanismo de dispatch. Regras de padrão estabelecem que apenas aggregate roots podem emitir domain events não entities internas do agregado, eventos são registrados durante execução de métodos de negócio como Unit.Approve adicionando UnitApprovedEvent sem disparar, eventos são despachados apenas APÓS commit bem-sucedido de transação garantindo consistência onde handlers executam só se mudanças foram persistidas, falha em handler de evento não reverte transação já commitada evitando rollback por side effect, e eventos carregam dados suficientes para handlers processarem sem necessitar queries adicionais minimizando acoplamento. Eventos típicos incluem EntityCreatedEvent ao criar aggregate root, EntityUpdatedEvent ao modificar, EntityDeletedEvent ao soft delete, StatusChangedEvent em transições de workflow, e eventos específicos de negócio como HolderLinkedEvent UnitApprovedEvent SyncConflictEvent LegitimationCertificateIssuedEvent cada um carregando contexto relevante. Implementação varia onde .NET usa List privado DomainEvents com métodos protegidos/públicos, TypeScript frontend geralmente não usa events pois são conceito backend, React Native pode simular events para sincronização offline registrando ações pendentes, e padrão Observer ou Event Sourcing podem ser aplicados dependendo de arquitetura. Integração com persistência ocorre em UnitOfWork que após DbContext.SaveChangesAsync itera ChangeTracker filtrando BaseAggregateRoot coletando events despachando via dispatcher e limpando coleções, handlers são registrados no DI container como INotificationHandler processando assincronamente, e eventos fornecem extensibilidade onde novos handlers adicionados sem modificar agregados mantendo Open Closed Principle.

**Módulos:** Todos os projetos (classe base fundamental)

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Review
