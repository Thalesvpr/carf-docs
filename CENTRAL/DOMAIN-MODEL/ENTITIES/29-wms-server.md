# WmsServer (Servidor WMS/WMTS de Mapas)

Entidade representando servidor de mapas OGC WMS ou WMTS configurado fornecendo ortofotos de drone/aerofotogrametria e outras camadas raster como base visual para correção de geometrias por analistas. Campos conceituais incluem identificador único global, tenant_id vinculando servidor a instituição cliente (cada tenant pode ter seus próprios servidores de ortofotos ou compartilhar públicos), name nome descritivo identificando propósito do servidor (Ortofoto Drone 2024, Imagem Satélite PlanetScope, Mapa Base OpenStreetMap), base_url URL raiz do serviço OGC sem parâmetros de query (exemplo: https://maps.example.com/wms ou https://tiles.example.com/wmts), version versão do protocolo suportada (1.1.1 ou 1.3.0 para WMS, 1.0.0 para WMTS), service_type enum distinguindo protocolo (WMS serviço Web Map Service raster dinâmico, WMTS Web Map Tile Service tiles pré-renderizados mais performático), capabilities_cache JSON armazenando resposta GetCapabilities cacheada evitando consultas repetidas ao servidor externo listando layers disponíveis formatos suportados e sistemas de coordenadas, username opcional para autenticação HTTP Basic se servidor requer credenciais, password_encrypted senha criptografada para autenticação (nunca armazenada em plaintext), active booleano indicando se servidor está operacional e deve ser usado, last_validated_at timestamp da última validação de conectividade executada pelo sistema, error_message texto opcional contendo último erro de conexão quando last_validated_at falhou facilitando troubleshooting, e metadados de configuração. Relacionamentos incluem pertence a Tenant (N:1), possui múltiplas WmsLayer camadas individuais configuradas para uso (1:N), e indiretamente serve ortofotos consumidas por analistas em ferramenta GIS desktop e frontend web para validação visual de geometrias. Regras de negócio estabelecem que base_url deve responder a requisição GetCapabilities retornando XML válido conforme especificação OGC (validação executada em cadastro e periodicamente para monitoramento), capabilities_cache é atualizado automaticamente via job agendado (diário ou semanal) consultando GetCapabilities e parseando layers disponíveis detectando adição ou remoção de camadas, autenticação via username/password é opcional sendo necessária apenas se servidor é privado (ortofoto proprietária de empresa de topografia, imagem comercial de alta resolução), servidor inativo (active=false) não exibe suas WmsLayers em interfaces mas preserva configuração para possível reativação, e validação periódica testa conectividade tentando GetCapabilities e marcando servidor como problemático em error_message se timeout ou erro HTTP ocorre. Workflow típico inicia com empresa de topografia executando levantamento aerofotogramétrico via drone sobre comunidade gerando ortofoto de alta resolução (GSD 2-5cm por pixel), empresa processa imagens corrigindo distorções e georreferenciando usando pontos de controle GPS, empresa publica ortofoto via servidor WMS/WMTS próprio ou serviço comercial (GeoServer MapServer ArcGIS Server), ADMIN do sistema CARF adiciona WmsServer cadastrando base_URL e executando GetCapabilities para descobrir layers disponíveis, sistema cacheia lista de layers em capabilities_cache, ADMIN seleciona layers relevantes (layer com nome ortofoto_comunidade_X_2024) criando WmsLayer entities vinculadas, configura opacidade z-index e visibilidade por role, e WmsLayer passa a ser exibida como camada base em mapas de frontend e plugin GIS permitindo analistas visualizarem ortofoto como referência ao corrigir polígonos de unidades. Analistas trabalham em ferramenta GIS desktop (plugin QGIS conectado a API) carregando WmsLayer de ortofoto como background, desenham ou ajustam polígonos de Unit snapping vértices a footprints de edificações visíveis na ortofoto, validam que geometria corresponde à realidade física observada na imagem aérea, e salvam correções enviando de volta para backend que atualiza geometrias. Sistema pode proxiar requisições WMS adicionando autenticação transparente (frontend faz request para API backend, backend adiciona credentials e forward para WMS externo retornando tiles) evitando expor credenciais em código client-side, cache de tiles em servidor backend pode reduzir latência e custo de requisições ao WMS externo especialmente se servidor cobra por volume de dados transferidos, e validação de conectividade automatizada alerta administradores se servidor WMS fica offline permitindo ação corretiva antes que analistas encontrem mapas quebrados. Tipos de camadas comuns incluem ortofotos de drone (resolução centimétrica, atualização sob demanda conforme novos levantamentos), imagens de satélite (resolução métrica, atualização periódica conforme disponibilidade comercial), mapas base OpenStreetMap ou similares (referência de contexto com ruas nomes de lugares), e camadas temáticas como zonas de risco, curvas de nível, ou cadastro municipal existente servindo como overlay para comparação.

**Implementações por projeto:**
- Backend .NET: `PROJECTS/GEOAPI/LAYERS/DOMAIN/ENTITIES/29-wms-server.md`
- Frontend React: `PROJECTS/GEOWEB/MODELS/ENTITIES/wms-server.ts`
- Mobile React Native: `PROJECTS/REURBCAD/MODELS/ENTITIES/wms-server.ts` (cache offline não aplicável para WMS)
- Plugin GIS Python: `PROJECTS/GEOGIS/MODELS/wms_server.py`

---

**Última atualização:** 2025-01-05
