# Annotation (Anotação Polimórfica)

Entidade polimórfica representando anotação, comentário, alerta ou issue vinculado a qualquer entidade do sistema permitindo colaboração e rastreamento de problemas sem modificar entidade principal. Campos conceituais incluem identificador único global, entity_type enum indicando tipo da entidade anotada (UNIT HOLDER COMMUNITY LEGITIMATION_REQUEST SURVEY_POINT etc) estabelecendo relacionamento polimórfico, entity_id identificador da entidade específica sendo anotada, annotation_type enum classificando tipo da anotação (NOTE comentário informativo, WARNING alerta que requer atenção, ISSUE problema que bloqueia progresso, REMINDER lembrete de ação futura) definindo severidade e tratamento, content texto longo contendo conteúdo da anotação com formatação markdown permitindo listas links e formatação rica, priority enum opcional (LOW NORMAL HIGH URGENT) indicando urgência de resolução para ISSUE e WARNING, geo_point coordenada geográfica opcional permitindo anotações geolocalizadas (exemplo: "Problema de acesso neste ponto específico" marcado no mapa), created_by_account_id referenciando autor da anotação para responsabilização e histórico, created_at timestamp de criação ordenando timeline de anotações, resolved_at timestamp opcional indicando quando ISSUE ou WARNING foi resolvido (NULL significa ainda aberto), resolved_by_account_id opcional referenciando quem marcou como resolvido, e soft delete para casos onde anotação não é mais relevante mas histórico deve ser preservado. Relacionamentos são polimórficos conectando via entity_type + entity_id a múltiplas entidades (Unit 1:N Annotations, Holder 1:N Annotations, etc), relaciona-se com Account através de created_by e resolved_by rastreando participantes, e opcionalmente pode ter Annotations filhas criando thread de discussão (parent_annotation_id permitindo respostas aninhadas). Regras de negócio estabelecem que annotation_type ISSUE com priority HIGH ou URGENT pode bloquear aprovação de Unit ou LegitimationRequest (validação verifica issues não resolvidos antes de permitir transição de status), WARNING é exibido com destaque visual em interfaces alertando usuários de situações que requerem atenção mas não bloqueiam progresso (exemplo: "CPF duplicado em outro titular, verificar"), NOTE é puramente informativo e não afeta workflows (útil para comunicação entre field agents e analistas), REMINDER pode disparar notificações automáticas na data/hora configurada lembrando usuário de ação pendente, geo_point quando presente é renderizado como marcador no mapa permitindo identificação visual de problemas espaciais (sobreposição, acesso difícil, ponto de interesse), e resolved_at diferente de NULL marca anotação como resolvida ocultando de listas de pendências mas preservando no histórico completo. Workflow típico inicia com field agent criando NOTE em Unit durante coleta offline descrevendo dificuldade de acesso ou informação adicional relevante (conteúdo sincronizado para backend posteriormente), analista revisando Unit cria WARNING se detecta inconsistência nos dados alertando que verificação adicional é necessária, supervisor cria ISSUE com priority HIGH se documentação obrigatória está faltando bloqueando aprovação até resolução, responsável corrige problema e marca ISSUE como resolvido preenchendo resolved_at, e sistema exibe timeline completa de Annotations em tela de detalhes da entidade mostrando histórico de comunicação. Annotations com geo_point são úteis em contexto de topografia onde topógrafo marca pontos específicos que requerem revisita (marco danificado, obstrução visual para GPS, necessidade de piquete adicional), e em validação de geometrias onde analista marca vértice problemático que precisa ajuste. Sistema suporta filtros por annotation_type e resolved_at permitindo visualizar apenas issues abertos ou warnings não resolvidos, busca textual em content facilitando localização de discussões sobre tópicos específicos, e futuramente pode suportar @mentions notificando usuários específicos quando mencionados em Annotation criando fluxo colaborativo de resolução de problemas.

**Módulos:** GEOAPI, GEOWEB, REURBCAD, GEOGIS

---

**Última atualização:** 2026-01-10
**Status do arquivo**: Pronto
