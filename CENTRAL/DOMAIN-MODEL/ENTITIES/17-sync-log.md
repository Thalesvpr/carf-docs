# SyncLog (Registro de Sincronização Offline)

Entidade representando registro de tentativa de sincronização offline entre aplicativo mobile e backend rastreando sucesso, falhas e conflitos para troubleshooting e auditoria de dados móveis. Campos conceituais incluem identificador único global, account_id referenciando usuário que executou sincronização, device_id identificador único do dispositivo mobile (UUID gerado na instalação do app) permitindo rastrear sincronizações por aparelho, direction enum indicando sentido da sincronização (PULL baixando dados do servidor para mobile, PUSH enviando dados do mobile para servidor, BIDIRECTIONAL executando ambas operações sequencialmente), status enum indicando resultado (PENDING sincronização iniciada mas não finalizada, SUCCESS completada sem problemas, PARTIAL_SUCCESS completada com alguns conflitos ou falhas não bloqueantes, FAILED falha completa impedindo sincronização), started_at timestamp de início da tentativa, completed_at timestamp opcional de conclusão (NULL se ainda em progresso ou falhou antes de completar), records_count número de registros processados (units holders documents annotations sincronizados), conflicts_count número de conflitos detectados requerendo resolução manual ou automática, error_message texto opcional contendo descrição de erro quando status=FAILED facilitando diagnóstico, sync_size_bytes tamanho total de dados transferidos em bytes para monitoramento de uso de rede, e metadados técnicos como app_version e platform (Android iOS) para correlação de problemas com versões específicas. Relacionamentos incluem pertence a um Account usuário (N:1), pode ter múltiplos SyncConflict detalhando conflitos específicos encontrados (1:N opcional quando conflicts_count > 0), e referencia Communities sincronizadas através de log auxiliar permitindo rastrear quais comunidades foram baixadas ou atualizadas. Regras de negócio estabelecem que PULL sincronização baixa apenas comunidades para as quais usuário tem CommunityAuthorization ativa reduzindo volume de dados e respeitando permissões, PUSH envia modificações locais (units criados ou editados offline, holders adicionados, documents anexados, annotations criadas) para servidor aplicando lógica de merge ou gerando conflitos se dados foram modificados por outro usuário entre o último PULL e este PUSH, BIDIRECTIONAL executa PULL primeiro para obter dados mais recentes depois PUSH para enviar modificações locais minimizando conflitos, status FAILED registra erro técnico como falta de conexão timeout de rede ou erro de servidor bloqueando sincronização completamente, e PARTIAL_SUCCESS indica que maioria dos dados sincronizou mas alguns itens falharam (exemplo: 95 units sincronizadas com sucesso mas 5 units geraram conflitos pendentes de resolução). Workflow típico inicia quando usuário abre app mobile e sistema automaticamente tenta PULL para atualizar dados locais com mudanças do servidor, cria SyncLog com status PENDING e direction PULL, baixa incrementalmente apenas mudanças desde último sync usando timestamp de última sincronização bem-sucedida, atualiza banco local com dados recebidos, preenche completed_at e status SUCCESS se tudo correu bem ou FAILED com error_message se houve problema de rede ou servidor, e exibe notificação ao usuário informando resultado. PUSH workflow inicia quando usuário modifica dados offline (criou unidade, editou holder) e posteriormente conecta à rede, sistema identifica registros pendentes de envio (flag is_synced=false no banco local), cria SyncLog com direction PUSH, envia registros para servidor via API REST, servidor valida dados aplica lógica de merge detectando conflitos se registro foi modificado por outro usuário após último PULL do mobile, retorna lista de sucessos e conflitos, app processa resposta marcando registros enviados com sucesso como is_synced=true e registros conflitantes para resolução manual, e preenche SyncLog com status e contadores apropriados. Conflitos são exibidos em tela especial de resolução onde usuário vê versão local e versão servidor podendo escolher qual manter ou mesclar manualmente, após resolução app reenvia registro e completa sincronização. Logs são exibidos em tela de settings do mobile mostrando histórico de sincronizações com timestamps status e contadores, botão "Sincronizar Agora" permite forçar sync manual fora do agendamento automático, e botão "Forçar Full Sync" apaga dados locais e redownload completo útil em casos de corrupção de dados. Auditoria via SyncLog permite administradores identificarem usuários com problemas recorrentes de sincronização (dispositivo configurado incorretamente, permissões revogadas, rede instável), analisar padrões de uso (horários de pico de sincronização, volume de dados transferidos por usuário), e diagnosticar bugs de sincronização correlacionando falhas com versões específicas de app ou condições de rede.

**Implementações por projeto:**
- Backend .NET: `PROJECTS/GEOAPI/LAYERS/DOMAIN/ENTITIES/17-sync-log.md`
- Frontend React: `PROJECTS/GEOWEB/MODELS/ENTITIES/sync-log.ts` (não aplicável, web não faz sync offline)
- Mobile React Native: `PROJECTS/REURBCAD/MODELS/ENTITIES/sync-log.ts`
- Plugin GIS Python: `PROJECTS/GEOGIS/MODELS/sync_log.py` (não aplicável, plugin não faz sync offline)

---

**Última atualização:** 2025-01-05
