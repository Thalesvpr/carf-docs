# Legitimation Workflow

Workflow completo de processo de legitimação fundiária conforme Lei 13465/2017 regulamentando REURB (Regularização Fundiária Urbana) nas modalidades REURB-S (interesse social para população de baixa renda) e REURB-E (interesse específico) coordenando múltiplas etapas de análise técnica jurídica publicidade contestação e aprovação culminando em emissão de LegitimationCertificate conferindo título de propriedade ou posse legitimada ao beneficiário com workflow de 11 estados garantindo compliance legal transparência e rastreabilidade completa de decisões. Fluxo inicia quando Unit atinge status APPROVED após validação de analista indicando que cadastro está completo geometria corrigida documentação básica anexada e dados de Holder validados tornando propriedade elegível para início de processo formal de legitimação, MANAGER ou usuário autorizado acessa interface de gestão de legitimação selecionando Unit aprovada e iniciando criação de LegitimationRequest, sistema exibe formulário de início de processo solicitando informações obrigatórias incluindo modality selecionando REURB_S se beneficiários são população de baixa renda com renda familiar até 3 salários mínimos ou REURB_E se renda superior ou finalidade comercial, requester_name e requester_cpf identificando requerente principal (pode ser um dos Holders vinculados à Unit ou representante legal), legal_basis especificando artigos da Lei 13465/2017 aplicáveis ao caso (tipicamente Art. 23 para REURB-S ou Art. 15 para REURB-E), e observações adicionais descrevendo particularidades do caso, sistema valida dados do formulário verificando CPF válido modalidade compatível com renda declarada de Holder e área da Unit dentro de limites legais (≤250m² para REURB-S ≤500m² para REURB-E conforme legislação municipal), gera protocol_number único sequencial do tenant no formato REURB-YYYY-NNNN permitindo rastreamento e referência oficial, cria LegitimationRequest com status inicial DRAFT unit_id vinculando Unit correspondente tenant_id para isolamento multi-tenant submitted_at null inicialmente pois ainda não foi submetido oficialmente e deadline_date null até submissão, e exibe confirmação ao usuário com protocol_number gerado permitindo edição antes de submissão oficial. Durante preparação em status DRAFT responsável pelo processo anexa documentação obrigatória variável conforme modalidade onde REURB-S requer declaração de hipossuficiência econômica comprovantes de residência fotos do imóvel e titular RG e CPF enquanto REURB-E adiciona comprovantes de renda escrituras anteriores se houver certidões negativas de débitos e licenças ambientais se aplicável, faz upload de Documents especificando document_type apropriado (DOC_CPF DOC_RG DOC_RESIDENCE_PROOF PHOTO_FRONT DECLARACAO_HIPOSSUFICIENCIA CERTIDAO_NEGATIVA etc) vinculando a LegitimationRequest via entity_type e entity_id, anexa DescriptiveMemorial e LegitimationPlan elaborados por topógrafo vinculando via foreign keys estabelecendo relação com documentação técnica georreferenciada, verifica completude de documentação usando checklist configurável por modalidade garantindo que todos itens obrigatórios estão presentes antes de permitir submissão, e quando documentação está completa altera status para SUBMITTED disparando início oficial do processo. Ao transicionar para SUBMITTED sistema dispara ações automatizadas incluindo registrar submitted_at com timestamp atual marcando início de contagem de prazo legal, calcular deadline_date adicionando 120 dias corridos a submitted_at conforme Art. 36 da Lei 13465/2017 que estabelece prazo máximo para conclusão de processo REURB, criar primeira LegitimationResponse tipo SUBMISSION_ACKNOWLEDGEMENT com decision APPROVED registrando recebimento de processo e validação preliminar de documentação, notificar pool de analistas disponíveis sobre novo processo pendente de atribuição exibindo alerta em dashboard ou enviando notificação por email, e registrar evento RequestSubmittedEvent em sistema de domain events permitindo integração com outros módulos ou sistemas externos. MANAGER ou sistema automatizado atribui processo a ANALYST específico baseado em carga de trabalho expertise ou critério de distribuição configurável, preenche analyst_id em LegitimationRequest vinculando responsável, altera status para UNDER_ANALYSIS indicando que analista iniciou trabalho, e notifica analista atribuído sobre novo processo sob sua responsabilidade incluindo link direto e resumo de informações relevantes. Analista atribuído executa análise preliminar em status UNDER_ANALYSIS revisando documentação anexada verificando completude e conformidade, valida identidade de requerente conferindo CPF e documentos pessoais contra base de dados oficial, verifica situação fundiária do imóvel consultando certidões de matrícula do cartório de registro de imóveis verificando ausência de gravames ou proprietários anteriores com direitos conflitantes, analisa sobreposição espacial executando query geoespacial verificando que geometria da Unit não sobrepõe áreas públicas (praças ruas equipamentos) propriedades privadas já regularizadas ou áreas de preservação ambiental, identifica irregularidades impeditivas como ocupação em área non aedificandi faixa de domínio de rodovia ou área de risco geológico consultando camadas GIS de restrições, cria LegitimationResponse tipo PRELIMINARY_ANALYSIS documentando achados de análise com justification detalhando verificações realizadas recommendations listando pendências se houver e decision sendo APPROVED se tudo conforme NEEDS_CORRECTION se deficiências sanáveis identificadas ou REJECTED se impedimento legal insuperável detectado, e se decision é NEEDS_CORRECTION altera status de LegitimationRequest para NEEDS_CORRECTION retornando processo ao requerente com lista de correções necessárias. Se análise preliminar resulta em APPROVED processo avança para DOCUMENT_REVIEW onde equipe jurídica ou analista sênior executa revisão aprofundada de documentação legal, valida fundamentação jurídica verificando aplicabilidade de artigos da Lei 13465/2017 citados e requisitos específicos de modalidade escolhida, analisa riscos legais identificando potenciais contestações de terceiros direitos de vizinhos afetados ou questões de ordem pública, verifica conformidade com legislação municipal estadual e federal incluindo plano diretor código de obras e normas ambientais, cria LegitimationResponse tipo LEGAL_REVIEW com decision APPROVED se documentação está em ordem APPROVED_WITH_CONDITIONS se aprovação é condicionada a providências adicionais (exemplo obtenção de anuência de órgão ambiental) ou NEEDS_CORRECTION se documentação legal insuficiente, e se aprovado processo avança para TECHNICAL_REVIEW caso contrário retorna para correções. Em TECHNICAL_REVIEW analista técnico ou topógrafo revisor valida DescriptiveMemorial conferindo consistência entre coordenadas listadas área calculada e perímetro declarado verificando que cálculos estão corretos conforme fórmulas geodésicas, analisa LegitimationPlan verificando que planta técnica está em escala apropriada contém todas informações obrigatórias (confrontações norte coordenadas carimbo profissional ART) e é consistente com memorial descritivo, valida precisão de levantamento topográfico verificando que acurácia declarada em SurveyProcessing atende requisitos técnicos e legais (tipicamente <10cm para áreas urbanas), confere assinatura digital e registro profissional de topógrafo responsável validando que Surveyor tem Crea ativo e ART recolhida, cria LegitimationResponse tipo TECHNICAL_REVIEW com decision APPROVED se documentação técnica está conforme ou NEEDS_CORRECTION se ajustes necessários, e se aprovado processo avança para PUBLIC_NOTICE iniciando fase de publicidade obrigatória. Ao entrar em PUBLIC_NOTICE sistema automaticamente gera texto de edital de convocação conforme modelo legal incluindo protocol_number descrição do imóvel (endereço área confrontações) identificação de beneficiários e prazo para manifestação de interessados ou contestações, publica edital em diário oficial do município ou meio de comunicação oficial do ente promovente conforme exigido por lei registrando publication_date e publication_reference, envia notificação a confrontantes identificados (proprietários de imóveis vizinhos) quando informação está disponível via correio ou pessoalmente conforme procedimento configurável, inicia contagem de prazo de publicidade tipicamente 30 dias corridos conforme legislação local durante o qual terceiros interessados podem apresentar objeções, altera status para CONTESTATION_PERIOD após publicação indicando que processo está aguardando manifestações, e monitora recebimento de Contestations durante período estabelecido. Durante CONTESTATION_PERIOD terceiros interessados podem submeter Contestation entity via interface pública ou protocolo presencial preenchendo fundamentação legal descrevendo interesse no imóvel (exemplo alegação de propriedade anterior direito de passagem ou ocupação prévia) e anexando documentos comprobatórios, sistema registra Contestation vinculando a LegitimationRequest contestado criando notification para analista responsável e MANAGER sobre objeção recebida, e se prazo de contestação expira sem manifestações processo avança automaticamente para RESOLUTION caso contrário permanece em CONTESTATION_PERIOD até resolução de todas contestações pendentes. Para cada Contestation recebida analista ou comissão de análise executa avaliação técnica e jurídica verificando fundamento legal de objeção analisando documentos apresentados por contestador e comparando com documentação do processo de legitimação, pode solicitar informações adicionais ao requerente ou contestador antes de decidir emitindo ofício via sistema e aguardando resposta dentro de prazo estabelecido, realiza audiência de conciliação se configurado registrando ata em Document vinculado a Contestation documentando tentativa de composição amigável entre partes, cria LegitimationResponse específica para Contestation com response_type CONTESTATION_ANALYSIS fundamentando decision que pode ser REJECTED se objeção é improcedente mantendo legitimação UPHELD se objeção é procedente impedindo legitimação ou PARTIALLY_UPHELD se objeção é parcialmente acolhida requerendo ajustes no processo, vincula LegitimationResponse à Contestation via contestation_id permitindo rastreamento de análise de cada objeção individualmente, e se todas contestações foram analisadas e nenhuma foi totalmente acolhida (UPHELD) processo pode avançar para aprovação caso contrário se contestação procedente foi identificada processo é REJECTED. Após resolução de contestações processo entra em RESOLUTION onde comissão ou gestor responsável executa análise final consolidada revisando todos pareceres técnicos jurídicos e de contestações emitidos ao longo do processo, verifica que todas condições impostas em decisões APPROVED_WITH_CONDITIONS foram cumpridas pelo requerente validando apresentação de documentos adicionais ou providências solicitadas, confere que prazo de 120 dias não foi excedido sem justificativa ou se foi há extensão devidamente fundamentada registrada em Annotation ou LegitimationResponse, toma decisão final sobre aprovação ou rejeição do processo de legitimação baseado em conjunto completo de análises, cria LegitimationResponse tipo FINAL_DECISION com decision APPROVED se processo deve ser aprovado conferindo legitimação ou REJECTED se impedimentos insuperáveis foram identificados justificando detalhadamente fundamentação legal e técnica de decisão, e se decision é APPROVED processo transiciona para status APPROVED habilitando emissão de certidão caso contrário transiciona para REJECTED encerrando processo sem direito adquirido. Em status APPROVED sistema habilita geração de LegitimationCertificate documento oficial que confere título de propriedade ou posse legitimada ao beneficiário, MANAGER ou usuário autorizado inicia emissão de certidão clicando em botão Emitir Certidão na interface de gestão de processo, sistema gera certificate_number único e sequencial do tenant seguindo formato configurável (exemplo CERT-REURB-YYYY-NNNN), cria LegitimationCertificate entity vinculando a LegitimationRequest preenchendo issue_date com data atual situation descrevendo imóvel conforme terminologia registral (COVERED se com benfeitorias CONFRONTING se terreno nu BOTH se misto), beneficiaries listando nomes completos e CPFs de todos Holders vinculados à Unit que receberão título, area_sqm copiando área oficial do DescriptiveMemorial, perimeter_description transcrevendo descrição de limites e confrontações do memorial, restrictions listando eventuais restrições ou condicionantes impostas durante análise (exemplo necessidade de manter recuo obrigatório respeitar área non aedificandi preservar vegetação nativa), signed_by identificando autoridade competente que assina certidão (prefeito secretário municipal diretor de órgão fundiário conforme competência legal), gera documento PDF da certidão usando template oficial com brasão do município cabeçalho identificando órgão emissor corpo do texto descrevendo imóvel beneficiários área confrontações e fundamentação legal rodapé com assinatura digital QR code para verificação de autenticidade e número de protocolo, faz upload de PDF para sistema de armazenamento criando Document entity vinculando a LegitimationCertificate e armazenando document_id para referência, registra metadados de registro em cartório quando apresentação é realizada preenchendo registry_office (nome do cartório de registro de imóveis competente), registry_book registry_page e registered_at documentando matrícula ou transcrição efetuada formalizando título perante registro público, notifica beneficiários sobre emissão de certidão enviando email ou SMS com link para download de PDF e instruções sobre apresentação em cartório para registro, e registra evento CertificateIssuedEvent disparando integrações com sistemas externos ou workflows subsequentes como atualização de cadastro imobiliário municipal para fins de IPTU. Workflow suporta casos especiais incluindo extensão de prazo quando deadline_date de 120 dias se aproxima sem conclusão MANAGER pode criar LegitimationResponse tipo DEADLINE_EXTENSION justificando motivo de atraso (complexidade do caso pendência de documentação externa contestações múltiplas) e atualizando deadline_date com novo prazo registrando justificativa para auditoria e compliance legal, retorno para correções em qualquer estágio do workflow quando deficiências são identificadas processo pode transicionar para NEEDS_CORRECTION independente de status atual com LegitimationResponse detalhando correções necessárias e processo retorna para DRAFT ou SUBMITTED após requerente sanar pendências, cancelamento administrativo quando requerente desiste ou irregularidade grave é detectada MANAGER pode transicionar processo diretamente para status específico CANCELLED (fora dos 11 estados principais) registrando motivo em LegitimationResponse tipo CANCELLATION preservando histórico completo para auditoria, e aprovação parcial quando imóvel originalmente solicitado precisa ser subdividido ou parte é aprovada e parte rejeitada sistema permite criar múltiplos LegitimationRequests derivados do original mantendo rastreabilidade via campo parent_request_id. Workflow garante compliance com Lei 13465/2017 através de enforcement automático de prazos alertando gestores quando deadline se aproxima ou é ultrapassado, validação de requisitos específicos de modalidade impedindo aprovação de REURB-S se área excede 250m² ou beneficiário não atende critério de renda, rastreabilidade completa de decisões preservando todas LegitimationResponses criadas ao longo do processo formando audit trail imutável, geração de relatórios consolidados de processos em andamento concluídos e prazos permitindo gestão eficiente de carteira de trabalho e compliance com metas estabelecidas, e integração com sistemas externos possibilitando consulta de certidões emitidas via API pública com autenticação validando autenticidade de documento apresentado por terceiro através de QR code ou número de protocolo.

**Tecnologias envolvidas (implementação específica em PROJECTS/):**
- Backend: API REST com state machine de workflow, validações de negócio, geração de PDFs
- Frontend: Interface de gestão de processos, dashboards de acompanhamento, formulários de análise
- Integrações: Consulta a cartórios via APIs externas, publicação em diários oficiais, notificações email/SMS
- Formatos: JSON para API, PDF para certidões e documentos oficiais, QR code para verificação

**Relacionado:**
- Entities: LegitimationRequest, LegitimationResponse, LegitimationCertificate, DescriptiveMemorial, LegitimationPlan, Contestation, Unit, Holder, Document, Annotation
- Value Objects: LegitimationStatus, Decision, CertificateSituation, Cpf
- Aggregates: LegitimationRequest Aggregate
- Workflows: topography-workflow.md (passo anterior fornecendo memorial e planta)

---

**Última atualização:** 2025-01-05
