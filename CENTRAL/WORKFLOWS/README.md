# Workflows - Fluxos de Trabalho do Sistema

Workflows descrevem sequências de atividades coordenadas entre atores humanos e sistema atravessando múltiplos aggregates e bounded contexts para completar processos de negócio end-to-end garantindo orquestração correta de operações e transições de estado conforme regras estabelecidas. Documentação segue princípio technology-agnostic usando termos genéricos como "banco de dados relacional" "ferramenta GIS desktop com plugin" "motor de sincronização bidirecional" sem mencionar PostgreSQL WatermelonDB QGIS React Native ou bibliotecas específicas. Detalhes de implementação com tecnologias concretas pertencem a PROJECTS/[PROJECT_NAME]/DOCS/ conforme arquitetura polyrepo. Ordem lógica reflete sequência temporal do processo real desde configuração inicial até certificação final seguindo fluxo configuração preparação coleta sincronização validação refinamento legitimação garantindo compreensão progressiva do sistema.

## Workflows Principais (6 documentados)

### 01-wms-integration-workflow.md
Workflow de configuração e consumo de ortofotos via servidores WMS WMTS OGC onde empresa drone levantamento aéreo produz ortofoto de voo aerofotogrametria publica imagem via servidor OGC WMS WMTS externo NÃO armazenado no sistema ADMIN adiciona WmsServer ao sistema com base URL sistema executa GetCapabilities cacheia layers disponíveis ADMIN seleciona layers relevantes como ortofoto_comunidade_x_2024 cria WmsLayers configura opacity z-index visibilidade por role atribui WmsLayer a Community específica field agents e analysts visualizam ortofoto como background ao trabalhar na Community sistema proxeia requisições WMS se necessário para autenticação ou caching realiza re-validação periódica conectividade WmsServer e emite alertas se indisponível. Aggregates envolvidos Community Aggregate. Tecnologias serviço de mapas compatível OGC protocolo WMS WMTS padrão biblioteca cliente de mapas.

### 02-field-data-collection-workflow.md
Workflow de coleta de dados em campo usando aplicativo mobile offline-first onde FIELD_AGENT baixa comunidades autorizadas via sync pull navega offline com mapa base e ortofoto WMS cached cria Units desenhando polígonos ou importando GPS points captura dados Holder com CPF nome fotos anexa fotos da propriedade como Documents coleta opcional de pontos GPS perímetro com SurveyPoints handheld accuracy marca como completo alterando status DRAFT para PENDING_ANALYSIS e sincroniza quando online com resolução de conflitos. Aggregates envolvidos Unit Aggregate e Community Aggregate. Tecnologias banco de dados local embarcado motor de sincronização bidirecional GPS device.

### 03-offline-sync-workflow.md
Workflow completo de sincronização bidirecional entre banco de dados local no aplicativo mobile e banco de dados central no backend permitindo field agents trabalharem completamente offline coletando dados de Units Holders Documents em campo sem conexão retornando para área com WiFi e sincronizando automaticamente resolvendo conflitos via estratégias configuráveis por tipo de entidade. Arquitetura implementa sync engine baseado em timestamps e version vectors onde cada registro tem created_at updated_at deleted_at soft delete e _synced_at marcando última sincronização bem-sucedida backend expõe endpoint de pull incremental retornando changesets de todas entidades modificadas após timestamp fornecido e endpoint de push recebendo array de mudanças locais aplicando no servidor e retornando conflicts detectados para resolução no cliente. Pull inicial consulta timestamp última sincronização local requisita changesets desde aquele momento recebendo estrutura contendo arrays de units holders documents communities modificados e IDs de registros deletados cliente aplica changesets via operações batch atualizando registros existentes inserindo novos deletando removidos marcando todos com timestamp atual interface exibe progress bar com contadores. Edições offline são tracked localmente via status enum SYNCED LOCAL_CREATED LOCAL_UPDATED LOCAL_DELETED onde badge visual mostra contador de pendentes incentivando usuário a conectar. Push de mudanças detecta conectividade agrupa mudanças locais por status monta payload estruturado envia com retry exponential backoff até 5 tentativas backend processa batch dentro de transação validando permissões verificando conflicts comparando timestamps aplicando changes retornando IDs sincronizados e lista de conflitos. Conflict detection compara version vectors onde conflict ocorre se servidor foi editado após último pull do cliente tipos incluem UPDATE_UPDATE DELETE_UPDATE CREATE_DUPLICATE SCHEMA_MISMATCH cada conflict retornado com dados completos de ambas versões permitindo resolução informada. Resolution strategies são configuráveis Units usa MANUAL_REVIEW exibindo tela de merge Holders usa SERVER_WINS Documents usa CLIENT_WINS pois fotos são únicas Communities usa SERVER_WINS Annotations usa MERGE_BOTH preservando ambas. Edge cases tratados incluem criação offline com identificadores temporários substituídos por IDs definitivos após push mantendo foreign keys via tabela mapeamento falha upload fotos enfileiradas separadamente interrupção parcial via transações atomicas diferença relógio normalizada via header tempo servidor edições concorrentes resolvidas via last-write-wins per-field granular merge. Performance otimizations incluem delta sync apenas campos modificados compressão payloads batching até 100 registros background sync automático. Auditoria completa registra em SyncLog local contendo identificador timestamp direção PULL PUSH status SUCCESS PARTIAL FAILED contagem registros contagem conflitos mensagem erro permitindo troubleshooting e histórico em tela configurações com botão forçar sincronização completa resetando timestamps. Aggregates envolvidos Unit Aggregate Community Aggregate. Tecnologias banco de dados local embarcado motor de sincronização bidirecional API REST.

### 04-analyst-validation-workflow.md
Workflow de validação e correção em massa de geometrias usando ferramenta GIS desktop onde ANALYST filtra Units status PENDING_ANALYSIS de Community atribuída abre ferramenta GIS desktop com plugin conectado API carrega camada WMS orthophoto de drone aerofotogrametria como referência carrega Units como layer vetorial editável compara visualmente polígonos versus footprints na ortofoto corrige geometria em massa snapping vértices a edificações valida completude dados Holder adiciona Annotations para issues requerindo reverificação aprova em massa alterando PENDING_ANALYSIS para APPROVED ou solicita correções alterando para REQUIRES_CHANGES e sistema notifica field agents sobre units requerendo correção. Aggregates envolvidos Unit Aggregate e Community Aggregate. Tecnologias ferramenta GIS desktop com plugin serviço de camadas WMS WMTS API REST.

### 05-topography-workflow.md
Workflow de levantamento topográfico profissional com GNSS e pós-processamento RBMC onde Surveyor topógrafo licenciado é atribuído a Community ou Units específicas requerendo acurácia survey-grade coleta campo com receptor GNSS profissional RTK ou post-processed captura SurveyPoints perímetro com acurácia menor que 5cm usando PointType MARCO para monumentos baixa observações GNSS raw mais dados estação RBMC mais próxima pós-processa GPS usando correção diferencial via SurveyProcessing gera coordenadas corrigidas com relatório precisão cria Monograph para marcos permanentes com fotos sketch descrição acesso elabora DescriptiveMemorial listando vértices com coordenadas azimutes distâncias conforme NBR produz LegitimationPlan técnico DWG ou PDF escala 1:500 e submete pacote técnico completo vinculado a Unit ou LegitimationRequest aprovado por MANAGER. Aggregates envolvidos Unit Aggregate e LegitimationRequest Aggregate. Tecnologias receptor GNSS profissional software pós-processamento GPS diferencial biblioteca transformação coordenadas editor CAD.

### 06-legitimation-workflow.md
Workflow completo de processo de legitimação fundiária conforme Lei 13465/2017 com 11 estados onde Unit atinge status APPROVED após validação analista MANAGER inicia LegitimationRequest com status SUBMITTED sistema valida documentos obrigatórios presentes analista realiza análise preliminar alterando para UNDER_ANALYSIS cria LegitimationResponse tipo PRELIMINARY_ANALYSIS segue para estágio revisão técnica TECHNICAL_REVIEW validando compliance Lei 13465/2017 caso deficiências altera para NEEDS_CORRECTION com justificativa caso satisfatório altera para PUBLIC_NOTICE publicando edital 30 dias durante CONTESTATION_PERIOD terceiros submetem Contestations analista revisa contestações cria Responses com Decision se resolvidas favoravelmente altera para RESOLUTION depois APPROVED sistema gera LegitimationCertificate com número único MANAGER assina digitalmente certidão anexa certidão PDF como Document e status final APPROVED com certidão disponível download. Aggregates envolvidos LegitimationRequest Aggregate e Unit Aggregate. Tecnologias motor geração documentos serviço assinatura digital sistema gerenciamento workflow.

## Tecnologias Envolvidas (Implementação Específica em PROJECTS/)

NÃO mencionar neste diretório PostgreSQL WatermelonDB React Native QGIS NetTopologySuite Turf.js Keycloak ou bibliotecas específicas. Usar termos genéricos banco de dados relacional banco de dados local embarcado ferramenta GIS desktop com plugin biblioteca geometria computacional motor de sincronização provedor identidade OAuth2. Detalhes de implementação com tecnologias concretas stacks escolhidas configurações específicas pertencem a PROJECTS/[PROJECT_NAME]/DOCS/ conforme decisão ADR-008 sobre separação entre documentação conceitual agnóstica e documentação técnica específica de implementação.

## Relacionado

Ver também CENTRAL/BUSINESS-RULES/ para regras de negócio aplicadas durante workflows CENTRAL/DOMAIN-MODEL/ENTITIES/ para entidades manipuladas pelos workflows CENTRAL/DOMAIN-MODEL/AGGREGATES/ para fronteiras de consistência atravessadas e CENTRAL/DOMAIN-MODEL/00-INDEX.md para índice completo do modelo de domínio.

---

**Última atualização:** 2025-01-08
