# KEYCLOAK - Documentação Técnica Completa

Documentação técnica aprofundada sobre customização desenvolvimento e operação do Keycloak para projeto CARF organizada em quatro categorias principais seguindo padrões consistentes de escrita formatação e profundidade apropriada para cada tipo de conteúdo sendo ARCHITECTURE diretório contendo documentos extensos com diagramas ASCII tabelas exemplos código e justificativas técnicas detalhadas cobrindo customization-strategy comparando themes vs fork vs SaaS approach escolhendo themes Docker image custom com CI/CD automação deployment, theme-architecture explicando estrutura arquitetural temas CARF build pipeline integração @carf/tscore biblioteca compartilhada CPF CNPJ validators performance optimizations caching strategies, e extension-development guiando desenvolvimento SPIs Service Provider Interfaces Java com Maven setup interfaces Authenticator EventListener ProtocolMapper testing Arquillian framework debugging remoto IntelliJ IDEA Eclipse breakpoints step-through inspection variables. CONCEPTS diretório agrupa documentos ultra-compactos estilo GEOAPI sentença única contendo todos detalhes técnicos necessários sem narrativa excessiva cobrindo keycloak-themes explicando sistema temas FreeMarker templates theme.properties inheritance i18n português brasileiro deployment strategies, keycloak-spis descrevendo Service Provider Interfaces disponíveis Authenticator customizando fluxos autenticação EventListener auditando eventos login logout ProtocolMapper injetando claims customizados JWT tokens testing hot-reload desenvolvimento iterativo rápido, realm-customization configuração realms CARF definindo clients OAuth2 OIDC six applications públicos confidenciais bearer-only service accounts roles RBAC hierarquia super-admin admin manager analyst field-collector user attributes tenant_id allowed_tenants protocol mappers injetando claims JWT realm-export backup disaster recovery, oauth2-oidc-flows grant types Authorization Code PKCE Client Credentials Refresh Token JWT structure header payload signature algorithms RS256 endpoints token introspection revocation lifecycle expiration refresh strategies, e multi-tenancy-strategy isolamento dados município user attributes mapeados JWT claims tenant_id extraídos middleware backend configurando PostgreSQL session SET app.tenant_id ativando RLS Row-Level Security policies automáticas filtrando queries tenant switcher frontend permitindo usuários múltiplos municípios alternar contexto dinamicamente.

HOW-TO diretório provê guias práticos passo-a-passo para desenvolvedores executarem tarefas específicas desenvolvimento deployment troubleshooting incluindo develop-themes setup local environment docker-compose desenvolvimento iterativo hot reload automático file watching alterações themes refletidas imediatamente browser refresh testing múltiplos browsers Chrome Firefox Safari Edge validando compatibilidade CSS JavaScript rendering, deploy-extensions buildando SPIs Maven compilando JARs packaging artifacts copying /opt/keycloak/providers/ directory restart server rollback versões anteriores caso problemas produção rollback procedures documented, setup-dev-environment configurando ambiente desenvolvimento completo Docker Compose PostgreSQL Keycloak PgAdmin MailHog SMTP mock server IDE configuration IntelliJ IDEA Eclipse Java debugger remote debugging attach process port 8787 breakpoints step-through quick iteration cycles maximizing productivity developer experience, build-custom-image construindo Docker image customizada multi-stage Dockerfile primeiro stage compilando extensions Java segundo stage copiando themes terceiro stage finalizando optimizations tagging semantic versioning git commit SHA pushing registry Docker Hub GitHub Container Registry AWS ECR scanning vulnerabilities Trivy Snyk compliance security policies, update-keycloak-version atualizando versão major minor patch releases lendo changelog breaking changes compatibility issues theme fixes required adaptando templates FreeMarker variables removidos adicionados renomeados staged rollout canary deployment blue-green zero-downtime primeiro staging environment depois production gradual rollout monitorando metrics errors logs rollback se problemas detectados, e configure-production setup produção PostgreSQL externo alta disponibilidade replicação master-slave read replicas HTTPS obrigatório TLS certificates Let's Encrypt automated renewal Traefik Nginx reverse proxy edge termination clustering Infinispan distributed cache sessions sincronizados múltiplas instâncias Keycloak horizontal scaling load balancing sticky sessions performance tuning JVM heap size garbage collection G1GC connection pools HikariCP thread pools ajustando conforme load testing results JMeter Gatling stress testing capacity planning backup automático pg_dump realm export scheduling cron jobs retention policies 30 days monitoring Prometheus metrics Grafana dashboards alerting critical events authentication failures latency spikes availability downtime incidents.

REFERENCE diretório concentra referências técnicas APIs configurações schemas códigos erro tabelas specifications sem narrativa descritiva incluindo Admin REST API endpoints criar ler atualizar deletar users realms clients roles groups authenticação via service account token master realm admin user permissions scopes, OIDC discovery endpoint /.well-known/openid-configuration retornando JSON metadata authorization_endpoint token_endpoint userinfo_endpoint jwks_uri issuer supported grant_types response_types scopes claims algorithms, theme.properties reference listando todas propriedades disponíveis parent theme herança styles scripts locales substitutions variables FreeMarker disponíveis templates login.ftl register.ftl error.ftl email templates HTML plain text, environment variables configuração Keycloak KC_DB KC_DB_URL KC_DB_USERNAME KC_DB_PASSWORD KC_HOSTNAME KC_HTTP_ENABLED KC_HTTPS_CERTIFICATE_FILE KC_LOG_LEVEL KC_METRICS_ENABLED influenciando comportamento runtime container Docker Kubernetes ConfigMaps Secrets injection, realm schema export format JSON estrutura completo clients roles users groups authentication flows bindings required actions protocol mappers scopes attributes importação realm-import CLI kcadm.sh automação scripting CI/CD pipelines infrastructure-as-code GitOps ArgoCD Flux, error codes HTTP status troubleshooting 400 Bad Request invalid parameters 401 Unauthorized token expirado inválido 403 Forbidden permissões insuficientes 404 Not Found resource inexistente 500 Internal Server Error logs checking Serilog structured logging ELK stack Elasticsearch Logstash Kibana CloudWatch centralização analysis querying filtering correlation tracing distributed OpenTelemetry spans contexts, e performance tuning parameters cache TTL token lifespan access 5 minutos refresh 30 dias SSO session 8 horas idle timeout absolute timeout connection pool sizes min max idle timeout validation query HikariCP thread pools Undertow worker threads IO threads ajustando load testing profiling VisualVM JProfiler identifying bottlenecks CPU memory network disk I/O optimization strategies.

Documentação relacionada sistema CARF distribui responsabilidades entre CENTRAL integrações cross-project operações runbooks configurações realm clients OAuth2 seis aplicações GEOWEB REURBCAD GEOAPI GEOGIS WEBDOCS ADMIN exemplos código TypeScript Python C# integração cada stack tecnológico específico context providers middleware configuration, decisões arquiteturais ADRs justificando escolha Keycloak comparando alternativas Auth0 SaaS custoso vendor lock-in Okta enterprise pricing AWS Cognito limitações customização Azure AD B2C Microsoft ecosystem lock-in preferindo open-source self-hosted controle total customizações themes SPIs extensions deployment infrastructure Kubernetes on-premise cloud-agnostic multi-cloud evitando dependência single provider, estratégia multi-tenancy RLS PostgreSQL integrando JWT claims session variables Row-Level Security policies automáticas isolamento dados municípios compliance LGPD soberania municipal auditoria rastreabilidade accountability transparency, implementação código-fonte SRC-CODE themes FreeMarker templates CSS JavaScript CPF CNPJ validators client-side UX melhorando antes submissão servidor evitando round-trips desnecessários extensions Java SPIs future implementations custom authenticators two-factor TOTP SMS email magic links passwordless authentication event listeners auditoria avançada logging metrics business intelligence analytics protocol mappers custom claims injetados tokens aplicações consumindo enriching context authorization decisions fine-grained permissions attribute-based access control ABAC future evolution beyond RBAC roles, scripts automação Makefile shell scripts Bash PowerShell cross-platform compatibility Windows Linux macOS WSL developers ambientes diversos quick-start make dev inicializando stack completa único comando abstraindo complexidade Docker Compose networks volumes healthchecks dependencies startup order retry logic resilience, e testes automatizados Playwright E2E simulating browser real user interactions navegando login page preenchendo username password clicando submit aguardando redirect verificando elementos DOM presence accessibility ARIA attributes keyboard navigation tab order focus management screenshot comparisons visual regression detecting UI breaks CSS changes unintended layout shifts API tests Node.js supertest validating OIDC endpoints discovery token introspection revocation user info Admin REST API CRUD operations users realms asserting responses status codes headers body schemas JSON validation ajv json-schema ensuring contracts maintained backward compatibility versioning APIs preventing breaking changes affecting consumers six applications ecosystem.

Stack tecnológico utiliza Keycloak versão 24.0 ou superior consultando official documentation guias server development admin REST API server administration upgrading procedures migration guides breaking changes adaptations required, Java 17 LTS Long Term Support executando runtime JVM HotSpot OpenJDK distributions Adoptium Azul Zulu Amazon Corretto compatibility ensuring consistency behavior production, FreeMarker 2.3.32 template engine rendering HTML páginas login account email register error info customizadas temas CARF identidade visual municipal logo cores tipografia tradução português brasileiro localização pt-BR messages properties substituindo textos default inglês keys values pairs formatação números datas moedas Brazilian Portuguese conventions, Maven 3.9 build tool dependency management repository central artifacts JARs dependencies transitive resolution scopes compile runtime test provided packaging plugins lifecycle phases clean compile test package install deploy automation CI/CD Jenkins GitHub Actions GitLab CI Azure DevOps, Docker 24 containerization build image multi-stage Dockerfile optimizing layers caching reducing size Alpine base images distroless security hardening scanning vulnerabilities runtime execution Kubernetes orchestration scaling replicas horizontal pod autoscaler HPA resource limits requests CPU memory guarantees quality of service QoS classes, e PostgreSQL 16 database persistence realm configuration users sessions events storing transactional ACID guarantees consistency durability replication streaming logical backups point-in-time recovery PITR high availability failover automatic Patroni clustering multi-master eventual consistency trade-offs CAP theorem choosing consistency availability partition-tolerance balancing requirements SLA 99.9% uptime.

---

**Última atualização:** 2026-01-11
