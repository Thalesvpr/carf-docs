# KEYCLOAK - Features

Customizações Keycloak implementadas para atender requisitos específicos CARF sistema regularização fundiária urbana incluindo temas visuais identidade visual municipal validações CPF client-side forms login protocol mappers injetando claims multi-tenancy tenant_id allowed_tenants configuração realm 6 clients OAuth2 diferentes tipos flows Authorization Code PKCE Client Credentials Bearer-Only integração admin proxy GEOAPI gerenciamento usuários roles attributes via 7 camadas segurança garantindo SSO Single Sign-On unificado entre todas aplicações ecossistema GEOWEB REURBCAD GEOAPI GEOGIS WEBDOCS ADMIN com autenticação centralizada tokens JWT RS256 assinados validados refresh automático sessões persistentes 30 minutos idle 10 horas max compliance LGPD auditoria rastreabilidade.

## Features Implementadas

- **[theme-customization.md](./theme-customization.md)** - Tema CARF personalizado login account email FreeMarker templates CSS branding logo cores fontes layout responsivo i18n português deployment Docker volumes
- **[cpf-validation.md](./cpf-validation.md)** - Validação CPF JavaScript client-side algorithm Mod11 dígitos verificadores User Profile Attributes campo obrigatório SPI backend validator migration Required Actions
- **[multi-tenancy-claims.md](./multi-tenancy-claims.md)** - Claims multi-tenancy JWT protocol mappers User Attributes tenant_id allowed_tenants RLS PostgreSQL tenant switcher frontend audit logging security validation
- **[realm-configuration.md](./realm-configuration.md)** - Realm CARF 6 clients configuração roles groups composite SMTP tokens lifespans export import automation Admin API kcadm scripts CI/CD GitOps
- **[admin-integration.md](./admin-integration.md)** - Proxy GEOAPI Admin API 7 camadas segurança controllers wrapping KeycloakAdminClient CRUD users roles attributes audit logging rate limiting permissions super-admin

Customizações principais incluem Theme Customization temas CARF personalizados login account email pages FreeMarker templates .ftl com HTML CSS branding logo cores fontes layout responsivo mobile-friendly, CPF Validation JavaScript validators client-side forms login registration adicionando campo CPF custom validando formato dígitos verificadores algoritmo Mod11 antes submit evitando backend rejections, Multi-Tenancy Claims protocol mappers User Attribute mappers injetando tenant_id current_tenant allowed_tenants array claims JWT access token extraído user attributes propagado todas aplicações facilitando RLS Row-Level Security PostgreSQL filtragem automática, Realm Configuration estrutura completa realm carf com 6 clients geoweb reurbcad geoapi geogis webdocs admin configurados tipos Access Type public confidential bearer-only flows Standard Direct Grant Service Accounts Valid Redirect URIs Web Origins roles realm-wide client-specific field-collector analyst manager admin super-admin hierarquia composite, Admin Integration 7 camadas proxy GEOAPI endpoints /api/admin/users wrapping Keycloak Admin API confidential client admin-client secret Azure Key Vault permitindo ADMIN app gerenciar usuários roles attributes sem acessar Keycloak Admin Console diretamente.

Stack tecnológica Keycloak 23.0 Quarkus distribution Java 17 Maven build PostgreSQL database persistence clustering H2 embedded dev Docker Compose orchestration Kubernetes Helm production deployment Nginx reverse proxy SSL termination SMTP email server templates FreeMarker 2.3 JavaScript ES6 validators CSS3 styling responsive themes admin CLI kcadm.sh automation scripts REST API admin endpoints Client Libraries @keycloak/keycloak-admin-client Node.js python-keycloak Python Microsoft.AspNetCore.Authentication.JwtBearer .NET keycloak-js JavaScript react-native-app-auth React Native integração clients.

Arquitetura customizações implementadas via SPIs Service Provider Interfaces JARs colocados /opt/keycloak/providers/ hot-reloadable dev restart required production, themes diretório /opt/keycloak/themes/carf/ contendo login account email subdirectories cada com theme.properties resources css images messages i18n, realm export JSON /opt/keycloak/data/import/realm-carf.json versionado commitado CENTRAL/INTEGRATION/KEYCLOAK/ import automático startup via --import-realm flag Docker Compose, protocol mappers configurados Client Scopes profile scope adicionando mappers User Attribute tipo extraindo attributes.current_tenant mapeando Token Claim Name tenant_id incluindo access token userinfo, clients configurados via Admin Console ou REST API bulk import JSON definitions clientId redirectUris webOrigins protocol openid-connect publicClient false bearerOnly serviceAccountsEnabled conforme tipo, admin integration backend GEOAPI controllers AdminUsersController endpoints wrapping kcAdmin.users.* methods authentication middleware validando JWT bearer token role super-admin admin antes proxy calls.

Relacionamento requirements implementando autenticação centralizada SSO OAuth2 OIDC JWT tokens multi-tenancy via claims RLS backend PostgreSQL gestão usuários roles RBAC permissions fine-grained client-specific realm-wide compliance LGPD auditoria rastreabilidade logs events LOGIN LOGOUT REGISTER UPDATE_PROFILE armazenados database exportáveis relatórios accountability transparency municipal governance garantindo todas 6 aplicações CARF compartilham sessão autenticação única logout simultâneo tokens válidos propagados claims tenant_id roles permissions sincronizados real-time.

---

**Última atualização:** 2026-01-11
