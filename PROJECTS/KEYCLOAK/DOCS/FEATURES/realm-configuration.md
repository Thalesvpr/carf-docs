# Realm Configuration - Configuração Realm

Configuração realm CARF implementada criando realm dedicado isolando configurações clients users roles do master realm através de Admin Console Realms Add realm Name "carf" Display name "CARF - Sistema de Regularização Fundiária" HTML Display name com logo img tag Enable checkbox marcado Save, configurando 6 clients OAuth2 cada tipo aplicação flow específico geoweb React SPA public Authorization Code PKCE reurbcad React Native mobile public PKCE offline_access geoapi .NET backend bearer-only JWT validation geogis Python desktop confidential Client Credentials admin React SPA proxy confidential secret webdocs VitePress static public, Realm Settings configurando Login tab User registration ON Remember me ON Email as username OFF Login with email ON Verify email ON Forgot password ON, Tokens tab Access Token Lifespan 5 minutes SSO Session Idle 30 minutes SSO Session Max 10 hours Offline Session Idle 30 days Refresh Token Max Reuse 0, Email tab SMTP server host port TLS authentication From address display name testando connection.

Clients configuração geoweb Client ID "geoweb" Enabled ON Client Protocol openid-connect Access Type public Standard Flow Enabled ON Direct Access Grants Enabled OFF Implicit Flow Enabled OFF Service Accounts Enabled OFF Authorization Enabled OFF Valid Redirect URIs "http://localhost:5173/*" "https://geoweb.carf.gov.br/*" Web Origins "+" permitindo CORS automatic mapping Base URL "http://localhost:5173", reurbcad similar public PKCE adicionando Valid Redirect URIs "com.carf.reurbcad://oauth/callback" custom scheme deep links mobile, geoapi Client ID "geoapi" Access Type bearer-only Standard Flow Enabled OFF validação JWT apenas sem redirect login, geogis Client ID "geogis" Access Type confidential Standard Flow Enabled ON Service Accounts Enabled ON Client Credentials grant gerando Client Secret Credentials tab copiando secret armazenando Azure Key Vault AWS Secrets Manager nunca Git hardcoded, admin similar confidential proxy Keycloak Admin API Valid Redirect URIs admin SPA origins, webdocs public static documentation portal.

Roles configuração realm-wide Roles tab Add Role Name "field-collector" Description "Coletor de dados em campo mobile" Save, criando analyst manager admin super-admin, composite roles admin role Composite Roles tab Composite Roles ON Client Roles None Realm Roles selecting analyst adicionando herança hierárquica admin herda analyst permissions, client-specific roles Clients geoapi Roles tab Add Role "geoapi.read" "geoapi.write" scoped client granularidade fine-grained, role mappings Users selecionando user Role Mappings tab Available Roles adicionando field-collector analyst conforme função, default roles Realm Settings Roles tab Default Roles adicionando "user" role básico todos usuários automaticamente após registration.

Groups configuração opcional Groups tab Create group Name "Prefeitura São Paulo" Attributes tenant_id value UUID Members adicionando users pertencentes município, subgroups hierarchy Equipe Norte Equipe Sul organizando structure, role mappings group-level Role Mappings tab permissions herdados members automatic assignment, group claims protocol mapper opcional adicionando groups claim JWT token array group paths hierarchical, User Federation opcional integrando LDAP Active Directory external user stores User Federation tab Add provider LDAP configurando connection URL Bind DN credentials Vendor Active Directory Edit Mode WRITABLE Import Users ON Sync Registrations ON periodic sync full incremental batching, identity brokering opcional integrando Google Facebook Microsoft social login Identity Providers tab Add provider Google Client ID Secret Redirect URI configurando OAuth2 flow linking accounts existing users automatic.

Export import configuração Realm Settings Action dropdown Export selecionando Export clients ON Export groups and roles ON Export users OFF excluindo dados sensíveis LGPD gerando realm-carf.json commitando Git CENTRAL/INTEGRATION/KEYCLOAK/realm-export.json versionamento IaC Infrastructure as Code, import automático Docker Compose volumes mount /opt/keycloak/data/import/realm-carf.json command --import-realm flag startup import se realm não existe skip se existe evitando overwrite production, partial import Admin Console Partial Import selecionando realm-export.json resources específicos clients roles importando apenas necessário evitando full replacement, automation via Admin REST API kcadm.sh CLI scripts Bash PowerShell chamando endpoints GET POST PUT DELETE programmatically gerenciando configuração CI/CD pipelines GitOps workflow mudanças realm triggering validation diff approval apply rollback.

---

**Última atualização:** 2026-01-11
