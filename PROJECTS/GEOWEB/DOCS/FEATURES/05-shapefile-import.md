# Shapefile Import - Importação

Feature de importação shapefiles implementada React SPA permitindo usuários carregarem dados geoespaciais externos formato ESRI Shapefile contendo polígonos unidades ocupações bulk cadastro através de página ShapefileImportPage wizard multi-step upload validation mapping preview import, componentes principais FileUploadZone React Dropzone drag drop file upload accept .zip .shp extensions validation size max 50MB, ValidationResultsPanel mostrando validation checks pass fail geometry type CRS compatibility topology errors attribute completeness counts features válidas inválidas warnings, AttributeMappingTable grid source shapefile DBF columns target CENTRAL Unit fields dropdowns mapping name address area holder_name holder_cpf community_id preview values first 5 rows, PreviewMapWidget React Leaflet renderizando shapefile polygons overlay base map styling diferenciado valid green invalid red zoom fit bounds, ImportProgressBar showing upload processing insert percentage real-time updates, ResultsSummaryDialog success count failures list feature IDs error messages retry options.

Validações implementadas verificando file format extension .zip ou .shp accepted rejeitando outros CSV GeoJSON KML, shapefile completeness dentro ZIP verificando presence companion files shp shx dbf prj required sem os quais corrupto incomplete, geometry type validation reading shapefile via shpjs library parsing geometries verificando Polygon MultiPolygon rejeitando Point LineString incompatible Unit entity, CRS validation reading prj file parsing WKT coordinate system checking compatible EPSG 4326 WGS84 31983 SIRGAS2000 oferecendo reproject transformation via proj4js library client-side ou backend server-side, topology validation basic checks self-intersections via turfjs kinks function invalid rings alertando errors permitindo skip ou abort, attribute validation verificando required fields mapped name area community_id não null values valid formats area number positive CPF 11 digits format se holder_cpf mapped, duplicate detection comparing geometries existing backend units via spatial query POST /api/units/spatial-check body geometries array retornando candidates duplicates alertando oferecendo skip merge options, file size limit 50MB preventing browser memory overflow upload timeout large shapefiles requiring split external tool QGIS ArcGIS.

API integration via upload multipart POST /api/units/import endpoint FormData file zipfile attribute_mapping JSON field mappings source target import_options skip_duplicates overwrite_existing Authorization header, backend async job processing extracting ZIP via SharpZipLib reading shapefile NetTopologySuite parsing geometries DBF attributes validating converting PostGIS Geography SRID 4326 inserting Units table batch transaction rollback se failures returning job_id, polling GET /api/jobs/:jobId checking status PENDING PROCESSING COMPLETED FAILED progress percentage records_total records_processed successes failures errors array, client updating progress bar percentage setInterval 1000ms polling até completed failed, results summary dialog mostrando successes count failures detailed list feature_id original_name error_message allowing download error report CSV Excel, imported units appearing UnitsListPage immediately após import cache invalidation queryClient.invalidateQueries units automatic refresh, rollback support partial import failures backend transaction ensuring consistency client offering retry correcting source shapefile re-importing failed subset, error handling 400 Bad Request validation errors mostrando inline messages form, 413 Payload Too Large file size exceeded alertando split files, 409 Conflict duplicates detected oferecendo resolution strategies dialog.

Domain model shapefile features mapped CENTRAL Unit entity parsing DBF attributes via shpjs library field values converting types string number Date appropriate name string trim address composed multiple fields concatenating street number neighborhood city, area calculated geometry via turfjs area function square meters polygon bounds, geolocation centroid via turfjs centroid function latitude longitude ou user-specified columns lat lon DBF, holder information extracted se columns holder_name holder_cpf present creating Holder records inline linking via unit_holders junction relationship_type default PROPRIETARIO, community assignment via attribute mapping dropdown user selects community_id target field source field containing identifier string UUID foreign key lookup matching, implementação UC-008 requirements incluindo selecionar shapefile upload drag drop validation formato presence components, validar geometrias topology CRS attributes antes import mostrando validation report warnings errors counts, mapear atributos source DBF target Unit Holder fields interactive table dropdown preview, preview features map canvas styling diferenciado valid invalid inspection visual, executar import progress tracking successes failures summary retry, tratar duplicates oferecendo skip overwrite merge strategies spatial comparison, relacionamento requirements rastreando RF-012 RF-013 importação bulk dados geoespaciais shapefile polygon validation attribute mapping facilitando cadastro massivo unidades pré-existentes levantamentos externos.

---

**Última atualização:** 2026-01-11
**Status do arquivo**: Pronto
