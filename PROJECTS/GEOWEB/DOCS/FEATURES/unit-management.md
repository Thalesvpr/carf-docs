# Unit Management - Gestão de Unidades

Feature de gestão unidades habitacionais implementada como CRUD completo React SPA permitindo usuários autorizados ADMIN MANAGER ANALYST cadastrarem visualizarem editarem aprovarem unidades durante processo regularização fundiária através de páginas UnitsListPage exibindo grid paginado com TanStack Table filtros search por nome endereço CPF titular status aprovação caracterização sorting columns, UnitFormPage formulário wizard multi-step com steps BasicInfo Address Area Geolocation Holders Photos cada step componente separado navegação botões Next Previous validações impedindo avanço se erros, UnitDetailsPage tabs Info Holders History Approval exibindo dados completos unidade com actions edit approve reject conforme role permissions, componentes principais UnitCard exibindo foto thumbnail nome endereço área status badge caracterização CONSOLIDADA PRECARIA RISCO actions view edit delete approve, UnitTable Tanstack Table com columns sortable filterable pagination server-side row selection bulk actions, UnitMap React Leaflet exibindo markers unidades clicáveis opening popup com summary link details, ApprovalDialog modal form com textarea comments justification radio buttons approve reject status transitions validações obrigatórias.

Validações implementadas via Zod schema unitSchema validando name obrigatório string trim min 3 max 200, address obrigatório nested object com street number neighborhood city state CEP validando formato patterns regex, area obrigatório number min 10 max 10000 reasonable bounds evitando typos absurdos, geolocation obrigatório object latitude longitude validando decimal degrees range accuracy meters, caracterizacao obrigatório enum CONSOLIDADA PRECARIA RISCO typed literal Zod, community_id obrigatório UUID validando existência via async validator debounced chamando GET /api/communities/:id verificando ID válido, holders array validando min 1 holder vinculado cada holder_id UUID existência via GET /api/holders/:id, photos opcional array URI strings max 10 limit, approval_status enum PENDING APPROVED REJECTED com validation rules ANALYST pode aprovar apenas PRECARIA RISCO MANAGER pode aprovar CONSOLIDADA ADMIN pode all, approval_comments obrigatório se status REJECTED min 10 chars justificativa, validação client-side onChange mostrando inline errors FormErrorMessage components, validação server-side repetindo checks GEOAPI antes persist garantindo security.

API integration via custom hooks useUnits encapsulando TanStack Query useQuery key units filters sort page retornando data isLoading error refetch paginated response total pages, useCreateUnit mutation POST /api/units body unit object onSuccess invalidating cache queryClient.invalidateQueries units mostrando toast success, useUpdateUnit PATCH /api/units/:id partial fields, useDeleteUnit DELETE soft delete setando deleted_at, useApproveUnit PATCH /api/units/:id/approve body status comments validando permissions server-side checking user role claims JWT token, optimistic updates configurados mutations options optimisticUpdate modificando cache antes request para UX responsiva rollback automático se fail, error handling onError callbacks parseando backend response errors array exibindo validation messages toast notifications, retry logic configurado TanStack Query retry 3 retryDelay exponential backoff para network transient errors, pagination server-side params page pageSize passados query GET /api/units?page=1&pageSize=20 backend retornando data array total totalPages metadata, filtering client-side via search input debounced filtering cached data ou server-side via query params filters status caracterizacao community_id backend applying WHERE clauses PostgreSQL.

Domain model mapeando CENTRAL Unit entity para React types TypeScript interface Unit com properties id UUID name string address Address nested type area number geolocation Geolocation object caracterizacao CaracterizacaoOcupacao enum status ApprovalStatus enum community Community relation holders Holder array many-to-many photos string array URIs created_by updated_by User relations timestamps Date, implementação UC-001 requirements incluindo cadastrar unidade formulário wizard multi-step validações inline campos obrigatórios endereço área geolocation holders vinculação photos captura, persistência GEOAPI POST endpoint retornando server ID, visualização listagem grid table map diferentes views, edição preservando relações existentes holders photos, implementação UC-002 incluindo aprovar unidade workflow ANALYST MANAGER permissions diferentes conforme caracterização, status transitions PENDING → APPROVED ou REJECTED validações comments obrigatórios rejection, notificações email push para titular e team lead após approval, auditoria logging approval_history table tracking actor timestamp status comments, relacionamento requirements rastreando RF-005 RF-006 RF-009 cadastro aprovação unidades habitacionais workflow compliance.

---

**Última atualização:** 2026-01-11
