Implementar login/logout no GEOWEB usa keycloak-js que gerencia fluxo OAuth2 automaticamente onde login é iniciado de duas formas sendo primeira via keycloak.init({ onLoad: 'login-required' }) que redireciona automaticamente para Keycloak se usuário não autenticado ideal para SPA onde toda aplicação requer autenticação, segunda via botão manual Login que chama keycloak.login() ideal para landing pages públicas com área restrita.

Login flow consiste em usuário clica Login ou tenta acessar rota protegida, keycloak.login() redireciona para http://localhost:8080/realms/carf/protocol/openid-connect/auth com query params client_id=geoweb, redirect_uri=http://localhost:5173, response_type=code, scope=openid profile email, code_challenge (PKCE hash gerado do code_verifier), code_challenge_method=S256, usuário vê tela de login Keycloak, insere username e password, Keycloak valida credenciais, gera authorization code, redirect de volta para app com code na URL como http://localhost:5173/?code=abc123, keycloak-js detecta code na URL, automaticamente faz POST ao token endpoint com grant_type=authorization_code, client_id=geoweb, code=abc123, code_verifier (PKCE original verifier), redirect_uri=http://localhost:5173, Keycloak valida code_verifier hash matches code_challenge enviado na authorization, retorna JSON com access_token, id_token, refresh_token, expires_in, keycloak-js armazena tokens em memória, popula keycloak.authenticated=true, keycloak.token, keycloak.tokenParsed, AuthContext detecta authentication e seta user state, usuário é redirecionado para rota original que tentava acessar armazenada em sessionStorage antes do redirect.

Logout implementado com botão Logout que chama handleLogout async function executando `await keycloak.logout({ redirectUri: window.location.origin })` que faz GET ao http://localhost:8080/realms/carf/protocol/openid-connect/logout com query params post_logout_redirect_uri=http://localhost:5173, id_token_hint (keycloak.idToken), Keycloak invalida sessão SSO deletando cookie, faz logout de todas as 6 aplicações CARF com SSO ativo (GEOWEB, REURBCAD, GEOAPI, GEOGIS, WEBDOCS, ADMIN), redirect de volta para redirectUri especificado, keycloak-js limpa tokens da memória, AuthContext seta isAuthenticated=false, user=null, usuário vê landing page pública ou login screen.

Session timeout handling implementado no token refresh interceptor onde se keycloak.updateToken() falha significa sessão SSO expirou (30min idle ou 10h max) então automaticamente chama keycloak.login() redirecionando para re-autenticação, Remember Me feature habilitado no Keycloak realm settings permite sessão SSO estendida de 24h idle e 7 dias max se user marca checkbox Remember Me no login screen.

---

**Última atualização:** 2026-01-15
**Status do arquivo**: Incompleto
Descrição: Falta título H1 na primeira linha.
