# ITenantProvider


Interface fornecendo TenantId do contexto atual da requisição extraído de JWT token ou header permitindo isolamento de dados por cliente através de Row-Level Security sem passar TenantId manualmente em cada operação mantendo multi-tenancy transparente. Propriedade GetTenantId() retornando Guid do tenant atual lançando exception se chamado fora de contexto autenticado indicando falha de configuração. Método adicional HasTenant() retornando bool verificando se contexto tem tenant disponível útil para operações públicas ou administrativas que operam sem tenant específico. Implementada por HttpTenantProvider em aplicações web extraindo tenant_id de claim no JWT token do usuário autenticado através de IHttpContextAccessor.HttpContext.User.FindFirst("tenant_id") garantindo que cada request carrega identificador do cliente, e por BackgroundJobTenantProvider em jobs agendados onde tenant é passado explicitamente como parâmetro do job permitindo operações em background mantendo isolamento. Usada em repositories onde queries automáticas incluem filter .Where(x => x.TenantId == _tenantProvider.GetTenantId()) através de global query filter configurado no DbContext impedindo acesso cross-tenant, em command handlers ao criar entidades populando TenantId automaticamente tipo new Unit { TenantId = _tenantProvider.GetTenantId() } eliminando possibilidade de esquecer campo, em validações verificando que entidades referenciadas pertencem ao mesmo tenant evitando vinculação acidental entre clientes, e em audit logs rastreando TenantId de cada operação para compliance e debugging. Registrada como scoped em DI container garantindo mesmo valor durante toda requisição mas diferente entre requests concorrentes, integra com RLS do PostgreSQL onde application_name ou session variable pode ser configurado com TenantId antes de queries aplicando políticas de segurança nível banco, e suporta tenant switching em cenários admin onde super usuário pode temporariamente assumir contexto de outro tenant para suporte ou investigação usando TenantSwitchMiddleware que sobrescreve provider.

---

**Última atualização:** 2026-01-12
