# ConflictException


Exception indicando conflito de estado ou unicidade onde operação não pode ser executada porque viola constraint de negócio como duplicação de CPF código já existente ou tentativa de modificar recurso em estado inconsistente mapeando para HTTP 409 Conflict permitindo frontend tratar retentativas ou resolução manual. Herda de 00-domain-exception sobrescrevendo HttpStatusCode para 409. Propriedades específicas incluem ConflictType (string tipo de conflito "DUPLICATE_CPF" "DUPLICATE_CODE" "CONCURRENT_MODIFICATION" "INVALID_STATE_TRANSITION"), ConflictingValue (string valor que causou conflito tipo CPF duplicado código existente), ExistingResourceId (Guid nullable ID do recurso conflitante tipo ID do Holder com mesmo CPF), Field (string campo que causou conflito), e Resolution (string sugestão de resolução tipo "Use CPF diferente" "Atualize a página e tente novamente" "Cancele a solicitação antes de deletar"). Construtores incluem ConflictException(string conflictType string message) básico, ConflictException(string conflictType string field string conflictingValue) para duplicação, ConflictException(string message Guid existingResourceId) quando conflito com recurso específico, e factory methods ForDuplicateCpf(cpf existingHolderId) ForDuplicateCode(code existingId) ForConcurrentModification() ForInvalidStateTransition(from to) convenientes. Métodos GetConflictDetails() retornando objeto estruturado com tipo valor campo ID do conflitante facilitando exibição em UI, e CanRetry() indicando se operação pode ser retentada com ajustes tipo duplicação não pode State transition pode após refresh. Lançada em repositories quando constraint de unicidade viola tipo ao criar Holder verificar if await _holderRepository.ExistsByCpfAsync(cpf) throw ConflictException.ForDuplicateCpf(cpf existingId) antes de insert, ao criar Community com código duplicado, ao criar ApiKey com prefixo já usado, e em unique indexes do banco capturando DbUpdateException verificando se é violação de constraint convertendo em ConflictException com detalhes apropriados. Também lançada em concurrency scenarios quando RowVersion difere tipo ao atualizar Unit verificar BaseVersion contra CurrentVersion se diferentes throw ConflictException.ForConcurrentModification() indicando outro usuário modificou entre read e write, em state transitions inválidas tipo Unit em APPROVED não pode voltar para DRAFT lançar ConflictException.ForInvalidStateTransition(current target) detalhando transição ilegal, e em regras de integridade tipo não pode deletar Community que tem Units vinculadas lançar ConflictException com reason "Comunidade possui unidades vinculadas" suggerindo deletar unidades primeiro ou usar soft delete. Capturada por middleware retornando ProblemDetails com status 409 title "Conflict" detail explicando conflito incluindo conflictType field conflictingValue existingResourceId em extensions permitindo frontend exibir mensagem contextual tipo "CPF 123.456.789-00 já cadastrado no sistema. Ver titular existente?" com link, logada como Information pois conflito é cenário esperado em concorrência ou duplicação acidental não indica bug, diferenciada de ValidationException onde dado é inválido enquanto ConflictException indica dado válido mas conflitante com estado existente, integra com retry policies onde algumas ConflictException como ConcurrentModification podem ser retentadas automaticamente com exponential backoff enquanto DuplicateCpf requer intervenção, fornece dados para optimistic locking onde frontend detecta 409 ConcurrentModification recarrega entidade mostra diff ao usuário permite merge manual ou force overwrite, e suporta resolução automática em alguns casos tipo duplicate code pode auto-incrementar sufixo gerando novo código automaticamente se configurado.

---

**Última atualização:** 2026-01-12
**Status do arquivo**: Pronto
