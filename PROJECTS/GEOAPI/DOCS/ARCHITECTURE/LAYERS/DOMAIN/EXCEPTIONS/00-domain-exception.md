# DomainException


Exception base abstrata para todas exceções de domínio representando violação de regra de negócio permitindo tratamento centralizado diferenciado de exceptions técnicas do sistema mapeando para HTTP 400 Bad Request indicando erro do cliente não do servidor. Herda de Exception fornecendo Message e InnerException padrão. Propriedades adicionais incluem ErrorCode (string código único identificando tipo de erro tipo "UNIT_INVALID_AREA" "CPF_ALREADY_EXISTS" permitindo frontend exibir mensagens customizadas ou tomar ações específicas), Details (Dictionary metadados adicionais sobre erro tipo campo que falhou valor inválido constraint violada facilitando debugging e exibição de feedback detalhado), e HttpStatusCode (int código HTTP apropriado default 400 podendo ser sobrescrito por subclasses como 404 para NotFoundException 403 para AccessDeniedException). Construtores incluem DomainException(string message) básico, DomainException(string message string errorCode) com código, DomainException(string message string errorCode Dictionary details) completo com metadados, e DomainException(string message Exception innerException) wrapping exception técnica. Métodos úteis ToJson() serializando exception para resposta API incluindo message errorCode details sem stack trace evitando vazamento de informações sensíveis, e AddDetail(key value) fluent method adicionando metadado facilitando construção de exception rica. Subclasses específicas incluem ValidationException para dados inválidos formato tipo CPF inválido email malformado área negativa, NotFoundException para entidade não encontrada por ID, ConflictException para violação de unicidade tipo CPF duplicado código já existente, AccessDeniedException para permissão negada usuário sem role adequado, BusinessRuleException para regras complexas tipo Unit não pode ser aprovada sem Holder vinculado, e InvalidStateException para transições inválidas tipo Unit em status REJECTED não pode ser aprovada diretamente. Lançada em métodos de domínio quando validação falha tipo Cpf constructor lança ValidationException se dígitos verificadores inválidos, Unit.Approve() lança BusinessRuleException se não tem Holders, LegitimationRequest.Cancel() lança InvalidStateException se Status já é CERTIFICATE_ISSUED, e repository.GetByIdAsync lança NotFoundException se ID não existe. Capturada por exception handling middleware global que intercepta DomainException mapeando para ProblemDetails RFC 7807 retornando JSON estruturado com title status detail errorCode extensions populados de Details facilitando consumo por frontend, logando exception em nível Warning ao invés de Error pois representa uso incorreto não falha do sistema, e diferenciando de exceptions não tratadas SystemException que são logadas como Error indicando bug. Permite mensagens localizadas onde message pode ser resource key tipo "errors.unit.invalid_area" resolvido por localization service baseado em Accept-Language header retornando texto apropriado pt-BR en-US, fornece base para validações declarativas através de atributos ou fluent validation capturando erros e lançando ValidationException com todos campos inválidos agregados em Details, e integra com testes unitários facilitando assert de regras de negócio verificando que método específico lança exception esperada com errorCode correto.

---

**Última atualização:** 2026-01-12
**Status do arquivo**: Pronto
