# SyncConflictEvent


Domain event emitido quando conflito de sincronização offline é detectado durante processamento de 15-sync-log indicando que mobile tentou modificar entidade alterada por outro usuário entre download e upload exigindo resolução manual ou automática do conflito. Implementa 00-i-domain-event fornecendo contrato comum. Propriedades principais incluem SyncLogId (Guid identificador do log de sync conflitante), EntityType (18-entity-type value object tipo da entidade UNIT HOLDER COMMUNITY), EntityId (Guid ID da entidade conflitante), DeviceId (string identificador do dispositivo mobile que enviou mudança), AccountId (Guid usuário do app que fez alteração), BaseVersion (byte array RowVersion que dispositivo tinha ao modificar), CurrentVersion (byte array RowVersion atual no servidor indicando versão mais recente), ConflictData (string JSON detalhando campos conflitantes mostrando versão mobile vs servidor tipo {"area_mobile": 100.5, "area_server": 105.2, "status_mobile": "DRAFT", "status_server": "APPROVED"}), Operation (string CREATE UPDATE DELETE tipo de operação conflitante), TenantId (Guid tenant do contexto), e OccurredAt (DateTime quando conflito foi detectado). Métodos GetConflictDetails() parseando ConflictData JSON retornando objeto tipado facilitando análise, RequiresManualResolution() verificando se conflito é crítico baseado em campos afetados tipo mudança de status requer decisão humana enquanto atualização de observações pode ser merge automático. Adicionado em SyncLog.DetectConflict() quando BaseVersion difere de RowVersion atual da entidade comparando byte arrays indicando modificação concorrente, registrado através de AddDomainEvent no aggregate que contém SyncLog ou diretamente em application layer handler de sync. Processado por handlers como SyncConflictNotificationHandler criando notificação push para app mobile alertando técnico de campo sobre conflito pendente mostrando detalhes e opções de resolução, SyncConflictEmailHandler enviando email para usuário e supervisor com link para interface de resolução web, SyncConflictQueueHandler enfileirando conflito em fila prioritária para revisão manual aparecendo em dashboard de pending conflicts, e SyncConflictAutoResolveHandler tentando merge automático de campos não conflitantes aplicando estratégia last-write-wins em campos independentes mantendo conflitos reais para decisão humana. Permite rastreamento de conflitos frequentes identificando padrões tipo mesma unidade sendo editada simultaneamente por múltiplos técnicos sugerindo melhor coordenação de equipes, fornece dados para métricas de qualidade de sincronização contando taxa de conflitos sobre total de syncs, e integra com mobile app que escuta notificações push exibindo modal de resolução permitindo usuário escolher manter versão local descartar ou mesclar manualmente.

---

**Última atualização:** 2026-01-12
**Status do arquivo**: Pronto
