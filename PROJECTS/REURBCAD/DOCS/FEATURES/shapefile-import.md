# Shapefile Import - Importação

Feature de importação shapefiles implementada mobile permitindo field collectors carregarem dados geoespaciais externos formato ESRI Shapefile contendo polígonos unidades ocupações para integração bulk cadastro facilitando levantamentos técnicos com dados pré-existentes cartográficos através de tela ShapefileImportScreen com botão Select Shapefile abrindo Expo Document Picker filtrando extensões zip shp permitindo user selecionar arquivo device storage downloads, componentes principais FilePickerButton usando DocumentPicker.getDocumentAsync com type application/zip application/octet-stream copyToCacheDirectory true obtendo local URI cache, ShapefileValidator service verificando file integrity completeness presence companion files shp shx dbf prj dentro zip extracting via expo-file-system unzip reading contents validando structure, AttributeMappingTable exibindo shapefile DBF attributes columns com dropdown selectors permitindo mapear source fields para target CENTRAL Unit fields name address area holder_name community_id, PreviewMap React Native Maps renderizando shapefile polygons geometries overlay base map com styling diferenciado valid green invalid red permitindo inspeção visual antes import, ImportProgressModal showing upload progress percentage records processed successes failures real-time updates.

Validações implementadas verificando file format via extension mime type checking zip ou shp accepted rejeitando outros formatos CSV GeoJSON KML incompatible, shapefile completeness validando presence required components shp shx dbf prj dentro zip sem os quais shapefile corrupto incomplete, geometry type validation parsing shp file reading geometry types via shp.js library ou similar verificando Polygon MultiPolygon geometries rejeitando Point LineString incompatible Unit entity requirements, CRS validation reading prj file parsing WKT coordinate system definition checking compatible EPSG codes 4326 31983 SIRGAS2000 WGS84 oferecendo reproject se divergente via proj4 library transformation, topology validation basic checks self-intersections via turf.js kinks function invalid rings via isValid checking cada feature geometry alertando errors permitindo user corrigir external GIS tool QGIS ArcGIS antes re-import, attribute validation verificando required fields mapped name area community_id não null values valid formats area number positive CPF format 11 digits se holder_cpf mapped, duplicate detection comparing geometries existing local units via spatial query turf.js intersect ou contains functions alertando potential duplicates oferecendo skip merge options, file size limit max 50MB preventing memory overflow device crash large shapefiles requiring split múltiplos smaller files external tool.

API integration via upload multipart quando online enviando shapefile ZIP POST /api/units/import endpoint multipart/form-data file parameter attribute mapping JSON config field mappings source target import options skip_duplicates overwrite_existing tenant_id Authorization Bearer header, backend GEOAPI processa async job extracting ZIP reading shapefile via NetTopologySuite SharpZipLib converting geometries PostGIS format validating inserting Units table returning job_id, client polling GET /api/jobs/:jobId checking status processing completed failed progress percentage records_total records_processed errors array, se offline queueing import operation sync_queue storing shapefile file URI cache attribute mapping config postponing até conexão disponível sync manager detecting network pushing queued import, import results showing summary dialog successes count failures list com feature IDs error messages detailed offering retry correcting source shapefile re-importing failed subset apenas, imported units appearing UnitsList screen immediately após import local WatermelonDB persistence synced server background quando online, rollback support se import fails midway backend transaction rollback garantindo consistency client deletando partially imported local records via batch delete operation.

Domain model shapefile features mapped CENTRAL Unit entity extracting DBF attributes via dbf.js library reading field values converting types string number Date apropriados name string address composed multiple fields street number neighborhood city, area extracted geometry via turf.js area function calculating square meters polygon bounds, geolocation centroid via turf.js centroid function ou user-specified lat lon columns DBF, holder information extracted se columns holder_name holder_cpf present creating Holder records inline linking via unit_holders junction, community assignment via attribute mapping dropdown user selects community_id target field source field containing community identifier string ou foreign key, implementação UC-008 requirements incluindo selecionar shapefile device storage via file picker validation formato presence components, validar geometrias topology CRS attributes antes import mostrando validation report warnings errors, mapear atributos source DBF fields para target Unit Holder fields via interactive table dropdown matching, preview features map canvas styling diferenciado valid invalid inspeção visual, executar import progress tracking mostrando successes failures summary retry options, tratar duplicates oferecendo skip overwrite merge strategies, offline queue import postponing até online sync automático, relacionamento requirements implementando RF-012 RF-013 importação bulk dados geoespaciais shapefile polygon validation attribute mapping mobile facilitando levantamentos técnicos pré-existentes cadastro massivo unidades.

---

**Última atualização:** 2026-01-11
