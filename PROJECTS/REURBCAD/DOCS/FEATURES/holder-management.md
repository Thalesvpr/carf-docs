# Holder Management - Gestão de Titulares

Feature de gestão titulares implementada como CRUD completo mobile permitindo field collectors cadastrarem visualizarem editarem removerem titulares pessoas físicas vinculadas unidades habitacionais durante levantamento campo através de telas HoldersListScreen FlatList exibindo titulares cadastrados localmente WatermelonDB com search filter por nome CPF status, HolderFormScreen formulário inputs nome completo CPF RG data nascimento telefone email documentos upload via camera ou galeria persistindo localmente offline, HolderDetailsScreen mostrando informações completas titular com tabs Info Documentos Unidades Vinculadas permitindo navegação entre titulares unidades relacionadas, componentes principais HolderCard exibindo avatar nome CPF badge status ativo inativo actions view edit delete, HolderSearchBar input text com debounce filtering query localmente WatermelonDB Q.where name Q.like %query% ou cpf Q.eq query, VincularHolderModal bottom sheet listando holders disponíveis com checkboxes permitindo vincular múltiplos titulares single unit ou vice versa supporting one-to-many many-to-many relationships conforme business rules, DocumentUploadWidget capturando photos documentos RG CPF comprovante residência via Expo Camera ou Image Picker compressing storing local filesystem references WatermelonDB.

Validações implementadas via Zod schema holderSchema validando name obrigatório string trim min 3 max 200 sem números regex pattern apenas letras espaços acentos, cpf obrigatório string validando formato 11 dígitos com validateCPF helper checking dígitos verificadores algoritmo Mod11 rejeitando CPFs known invalid 000.000.000-00 111.111.111-11 sequential, rg opcional string validando formato state-specific patterns ou generic alphanumeric, data_nascimento obrigatório Date validando age min 18 anos max 120 anos reasonable bounds evitando typos 01/01/1900 future dates, telefone obrigatório string validando formato brasileiro (XX) XXXXX-XXXX ou (XX) XXXX-XXXX allowing landline mobile, email opcional validando formato RFC 5322 regex pattern, documents opcional array objects validando cada document type enum RG CPF COMPROVANTE_RESIDENCIA file_uri string format, vinculacao validando unit_id UUID existência via WatermelonDB units collection lookup holder_id existência impedindo orphan references, uniqueness CPF validando via async validator querying WatermelonDB holders collection WHERE cpf = $cpf excluindo current holder se editing retornando boolean exists impedindo duplicate CPFs mesmo tenant.

API integration via offline-first persistindo holders localmente WatermelonDB holders collection criando Holder model instance fields nome cpf rg data_nascimento telefone email _status pending_create queueing sync operation sync_queue, vinculação unidades via junction table unit_holders many-to-many relationship inserting records unit_id holder_id relationship_type PROPRIETARIO COMODATARIO LOCATARIO OCUPANTE irregular, quando online sync pushing POST /api/holders payload holder data Authorization header, backend valida CPF uniqueness tenant-wide insere holders table retorna holderId, client atualiza local record server ID marca synced, se conflict 409 detectando duplicate CPF oferecendo merge keep local keep server, documents upload separado via POST /api/holders/:id/documents multipart form data file photo compressed JPEG base64 encoded ou binary stream, backend armazena blob storage Azure Blob AWS S3 retorna document_url persistindo holders_documents table holder_id document_type document_url, client atualiza local reference URL permitindo download posterior quando online, vinculação sync via POST /api/unit-holders body unit_id holder_id relationship_type backend valida both IDs exist same tenant inserts junction table retorna success, desvinculação DELETE /api/unit-holders/:id soft delete setando deleted_at preservando histórico auditoria.

Domain model mapeando CENTRAL Holder entity para WatermelonDB @model class Holder com @field nome string, @field cpf string unique index, @field rg string nullable, @field data_nascimento number timestamp, @field telefone string, @field email string nullable, @children documents via @children('holder_documents') relation one-to-many, @relation units via many-to-many through unit_holders junction writable false, @field _status enum tracking sync, implementação UC-003 requirements incluindo cadastrar titular formulário mobile validações CPF nome telefone, vincular titular a unidade selecionando holder existente ou creating new inline modal, desvinc ular titular mantendo holder record apenas removendo relationship junction, visualizar titulares vinculados a unidade listando holders com relationship type badge, editar informações titular preservando vinculações existentes, remover titular soft delete checando vinculações impedindo delete se holder vinculado unidades ativas oferecendo desvinculação automática, documentação upload captura câmera galeria storage local sync quando online, relacionamento requirements implementando RF-007 RF-008 gestão titulares vinculação unidades CPF validation documentos.

---

**Última atualização:** 2026-01-11
