Offline authentication no REURBCAD permite field collectors trabalhar semanas sem internet mantendo autenticação válida via offline refresh tokens com duração estendida (30 dias idle, 60 dias max) obtidos incluindo offline_access scope no OAuth2 authorization request, quando usuário faz login online pela primeira vez app obtém access_token (5 min), id_token (5 min), refresh_token offline (30 dias) armazenado em SecureStore encrypted via Keychain/Keystore, access_token cached em memória dura apenas 5 minutos mas refresh_token permite renovação sem internet porque Keycloak permite refresh offline se sessão ainda válida.

Workflow típico field collector faz login segunda-feira com conexão WiFi obtendo tokens incluindo offline refresh, vai para campo terça sem internet mas app já tem refresh_token válido em SecureStore, durante semana app usa cached access_token para assinar requests locais (não enviados ainda porque offline), quando access_token expira após 5 min app tenta refresh que falha porque offline mas não problema porque requests são queued localmente mesmo sem token válido, sexta volta para escritório com WiFi, app detecta conexão via NetInfo, chama getAccessToken() que tenta refresh usando offline refresh_token armazenado, POST /protocol/openid-connect/token com grant_type=refresh_token, refresh_token, client_id=reurbcad, Keycloak valida refresh_token checa que sessão offline ainda válida (não passou 30 dias idle), retorna novo access_token fresco com exp renovado, app atualiza cached token, processa sync queue enviando occupations coletadas durante semana com Authorization header atualizado, se refresh falha porque passou 30 dias idle então offline token expirou, app mostra login screen forçando re-autenticação antes de sync.

Token storage seguro crítico porque se device perdido/roubado token poderia ser extraído, SecureStore usa hardware-backed encryption Keychain (iOS with Secure Enclave) e Keystore (Android with TEE - Trusted Execution Environment) prevenindo acesso mesmo com device rooted/jailbroken, nunca AsyncStorage porque plain text JSON visível em backups ou com root access, session expiration configurada no Keycloak realm settings com Offline Session Idle = 30 days significa 30 dias sem nenhum refresh attempt, Offline Session Max = 60 days significa 60 dias desde login inicial mesmo se refresh frequency regular, best practice field collectors devem fazer login semanal quando tem conexão para renovar sessão offline evitando expiração.

Multi-device consideration se user loga mesmo account em tablet + phone cada device tem próprio refresh_token independente com sessões offline separadas não compartilhadas, security trade-off offline tokens mais longos aumentam convenience mas também attack window se device comprometido, mitigação via device PIN/biometric required para abrir app e auto-lock após inatividade.
