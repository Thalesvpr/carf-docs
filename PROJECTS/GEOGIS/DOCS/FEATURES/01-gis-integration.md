# GIS Integration - Integração SIG

Feature de integração com serviços GIS externos implementada no plugin QGIS Python permitindo usuários adicionarem visualizarem e gerenciarem camadas WMS WMTS WFS de fontes externas como IBGE MapBiomas Google Earth Engine para sobrepor com dados municipais de regularização fundiária através de classe LayerManager singleton gerenciando layer registry e connections usando PyQGIS API classes QgsVectorLayer para WFS vector features QgsRasterLayer para WMS WMTS raster tiles QgsProject.instance() para adicionar remover layers do map canvas, dialog LayerConfigDialog PyQt5 QDialog permitindo usuário configurar connection parameters URL endpoint service type WMS WMTS WFS version 1.1.0 1.3.0 2.0.0 CRS EPSG4326 EPSG31983 authentication basic token ou none, components principais incluem LayersPanel QDockWidget listando configured layers com checkboxes para visibility toggle ícones refresh remove properties, AddLayerDialog wizard multi-step para selecionar service type input URL test connection choose layers preview extent configure styling, LayerPropertiesDialog exibindo metadata extent CRS attributes table se WFS symbology ramp editor para rasters, WMS configuration construindo URI string via QgsDataSourceUri com url layers styles format image/png crs dpiMode 7 contextualInfo 1 parsing capabilities XML via QgsOwsConnection detectando available layers extraindo titles abstracts bounding boxes.

Validações implementadas verificando URL format via regex pattern validating http https schemes, testing connection availability fazendo GET request ao capabilities endpoint GetCapabilities parsing XML response verificando valid service metadata, CRS compatibility checking se layer nativeEpsg compatível com project CRS QGIS oferecendo reproject on-the-fly via QgsCoordinateTransform se divergente, layer extent validation verificando bbox não empty intersects com current map extent mostrando warning se layer fora da área visualização, authentication credentials validando username password não vazios se basic auth selected testando credentials via authenticated request antes de salvar, service version compatibility verificando QGIS suporta version especificada pelo usuário mostrando supported versions dropdown, WFS geometry type validation checando se layer contém geometries válidas Point LineString Polygon MultiPolygon rejeitando layers sem geometry, attribute schema validation para WFS verificando field names types compatible com QGIS data model evitando import failures, validação ocorre em dialog preview step antes de adicionar layer definitivamente permitindo usuário ajustar parameters se validation warnings.

API integration via custom ApiClient class chamando GEOAPI endpoints GET /api/layers retornando array de pre-configured municipal layers metadata name url type authentication parameters para facilitar discovery de layers relevantes municipais evitando usuário precisar conhecer URLs WMS externas, POST /api/layers/validate endpoint validando URL capabilities authentication server-side antes de client adicionar layer prevenindo credentials exposure no client Python code, GET /api/map-context retornando saved map contexts contendo collections de layers com styling extent filters permitindo restaurar workspace sessions anteriores, layer credentials armazenados encrypted via QSettings com QgsAuthManager que usa sistema operacional keychain macOS KWallet Linux DPAPI Windows garantindo client_secret API keys nunca plain text em config files, WFS feature fetching paginado usando maxFeatures startIndex parameters para layers grandes com milhares de features evitando memory overflow QGIS, caching tile requests para WMTS usando QgsNetworkAccessManager built-in cache reduzindo bandwidth e latency quando usuário zoom pan repetidamente mesma área, network timeout configurado 30 segundos para capabilities requests 60 segundos para tile requests com retry logic 3 attempts exponential backoff.

Domain model mapeando Layer entity do CENTRAL para PyQGIS QgsMapLayer subclasses com properties layer_id UUID name title abstract serviceType enum WMS WMTS WFS url endpoint version CRS EPSG code extent QgsRectangle bbox authentication authcfg ID referencing QgsAuthManager config styling QgsSymbol renderer para vectors ramp ColorRamp para rasters, implementação UC-010 requirements incluindo adicionar layer via wizard dialog com service type selection URL input connection test layer picker, configurar authentication via QgsAuthManager config dialog suportando basic OAuth2 API key, preview layer extent e features antes de adicionar definitivamente, salvar layer configuration para reuso futuro via saved connections, gerenciar layers adicionadas via panel com visibility toggle refresh remove, exportar layer data localmente via processing algorithm saveFeatures para WFS, integração com QGIS map canvas sincronizando visibility extent styling com UI changes, relacionamento requirements implementando UC-010 fluxo principal camadas WMS WMTS municipais overlay analysis rastreando RF-018 RF-019 visualização geoespacial.

---

**Última atualização:** 2026-01-11
**Status do arquivo**: Pronto
